# les regex  sont testées dans l'ordre
# un même groupe (ldap) peut matcher  plusieurs regex
#   si il match une regex et sa definition contient "last: ifMatch" il ne sera pas representé aux autres regex 
# une 'regex' définit un ensemble de 'group' NC, fonction des groupes Grouper qui match.
# a chaque 'group' on peut associer:
#   un 'quotaG' qui definit le quota des membres du groupe, sans quota un utilisateur ne sera pas créé (il peut l'être avec un autre groupe).
#   un groupFolder 'folder' si on a un 'quotaF' le groupfolder sera créé/modifié sinon le groupe sera associé au groupfolder ssi il existe.
#   permF definit les droits du groupe sur le groupefolder
# pour le moment les utilisateurs ne sont pas crééer avce loadGroupFolder mais avec loadEtab (du coup quotaG par exemple ne sert a rien)


---
etabs:
  - nom: CD18-CHER
    siren: 22180001400013
    ldapFilterList:
      - ldapFilterGroups: '(cn=coll:Collectivites:CONSEIL DEPARTEMENTAL DU CHER:groupes_locaux:Evaluations professionelles:Managers)'
        regexs:  
          - regex: '^coll:Collectivites:(CONSEIL DEPARTEMENTAL DU CHER):groupes_locaux:Evaluations professionelles:Managers$'
            last: ifMatch
            groups:
              - group: &group18 'Evaluations professionelles.%1$s' # création du groupe NC: 'Evaluations professionelles.CONSEIL DEPARTEMENTAL DU CHER'
                folders:
                  - folder: &folder18 'Évaluations pro ATTE18' # création du folder 'Évaluations pro ATTE18'
                    permF: # droit du groupe 'Evaluations professionelles.CONSEIL DEPARTEMENTAL DU CHER' sur le folder 'Évaluations pro ATTE18'
                      - write
                      - share
                      - delete
                    quotaF: 50
      - ldapFilterGroups: '(|  (cn=clg18:Etablissements:*:Administratifs:_DIRECTION:CHEF D ETABLISSEMENT)
                               (cn=clg18:Etablissements:*:Administratifs:_PERSONNELS ADMINISTRATIFS:GESTIONNAIRE)
                           )'
        regexs:
          - regex: '^clg18:Etablissements:([^_:]+\_(\d{7}\w)):Administratifs:\_DIRECTION:(CHEF D ETABLISSEMENT)$'
            last: ifMatch
            uai: '%2$s'
            groups: &groupsEtab18
              - group: '%3$s.%1$s' # création des groupes NC: 'CHEF D ETABLISSEMENT.nomEtab_uai'
                folders:
                  - folder: *folder18
                    permF: []
                  - folder: &folderEtab18 # création des folders: 'Évaluations pro ATTE18/nomEtab_uai'
                      - *folder18
                      - '%1$s'
                    quotaF: 50
                    permF:  # droits des groupes 'CHEF D ETABLISSEMENT.nomEtab_uai' sur les folders 'Évaluations pro ATTE18/nomEtab_uai'
                      - write
                      - delete
              - group: *group18 # donne au groupe 'Evaluations professionelles.CONSEIL DEPARTEMENTAL DU CHER'
                folder: *folderEtab18 # les droits sur les folders 'Évaluations pro ATTE18/nomEtab_uai'
                permF: 
                  - write
                  - delete
          - regex: '^clg18:Etablissements:([^_:]+\_(\d{7}\w)):Administratifs:\_PERSONNELS ADMINISTRATIFS:(GESTIONNAIRE)$'
            last: ifMatch
            uai: '%2$s'
            groups: *groupsEtab18 # même traitement pour les groupes NC: 'GESTIONNAIRE.nomEtab_uai' que celui des groupes 'CHEF D ETABLISSEMENT.nomEtab_uai'
...
