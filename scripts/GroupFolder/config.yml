# les regex  sont testées dans l'ordre
# un même groupe (ldap) peut matcher  plusieurs regex
#   si il match une regex et sa definition contient "last: ifMatch" il ne sera pas representé aux autres regex 
# une 'regex' définit un ensemble de 'group' NC, fonction des groupes Grouper qui match.
# a chaque 'group' on peut associer:
#   un 'quotaG' qui definit le quota des membres du groupe, sans quota un utilisateur ne sera pas créé (il peut l'être avec un autre groupe).
#   un groupFolder 'folder' si on a un 'quotaF' le groupfolder sera créé/modifié sinon le groupe sera associé au groupfolder ssi il existe.
#   permF definit les droits du groupe sur le groupefolder
# pour le moment les utilisateurs ne sont pas crééer avce loadGroupFolder mais avec loadEtab (du coup quotaG par exemple ne sert a rien)


---
etabs:
  - nom: CD18-CHER
    siren: 22180001400013
    ldapFilterList:
      - ldapFilterGroups: '(cn=coll:Collectivites:CONSEIL DEPARTEMENTAL DU CHER:groupes_locaux:Echanges etablissements:Managers)'  
        regex: '^coll:Collectivites:(CONSEIL DEPARTEMENTAL DU CHER):groupes_locaux:Echanges etablissements:Managers$'
        last: ifMatch
        group: &group18 'Echanges etablissements.CONSEIL DEPARTEMENTAL DU CHER' # création du groupe NC: 'Echanges etablissements.CONSEIL DEPARTEMENTAL DU CHER'
        folder: &folder18 'Échanges CD18-établissements' # création du folder 'Échanges CD18-établissements'
        permF: # droit du groupe 'Echanges etablissements.CONSEIL DEPARTEMENTAL DU CHER' sur le folder 'Échanges CD18-établissements'
          - write
          - share
          - delete
        quotaF: 50
      - ldapFilterGroups: '(|  (cn=clg18:Etablissements:*:Administratifs:_DIRECTION:CHEF D ETABLISSEMENT)
                               (cn=clg18:Etablissements:*:Administratifs:_PERSONNELS ADMINISTRATIFS:GESTIONNAIRE)
                               (cn=clg18:Etablissements:*:Administratifs:_PERSONNELS ADMINISTRATIFS:SECRETAIRE GENERAL)
                           )'
        regexes:
          - regex: '^clg18:Etablissements:([^_:]+\_(\d{7}\w)):Administratifs:\_DIRECTION:(CHEF D ETABLISSEMENT)$'
            last: ifMatch
            uai: '%2$s'
            groups: &groupsEtab18
              - group: '%3$s.%1$s' # création des groupes NC: 'CHEF D ETABLISSEMENT.nomEtab_uai'
                folders:
                  - folder: *folder18 # droit du groupe est lecture sur Échanges CD18-établissements
                    permF: []
                  - folder: &folderEtab18 # création des folders: 'Échanges CD18-établissements/nomEtab_uai'
                      - *folder18
                      - '%1$s'
                    quotaF: 50
                    permF:  # droits des groupes 'CHEF D ETABLISSEMENT.nomEtab_uai' sur les folders 'Échanges CD18-établissements/nomEtab_uai'
                      - write
                      - delete
              - group: *group18 # donne au groupe 'Echanges etablissements.CONSEIL DEPARTEMENTAL DU CHER'
                folder: *folderEtab18 # les droits sur les folders 'changes CD18-établissements/nomEtab_uai'
                permF:
                  - write
                  - delete
          - regex: '^clg18:Etablissements:([^_:]+\_(\d{7}\w)):Administratifs:\_PERSONNELS ADMINISTRATIFS:(GESTIONNAIRE|SECRETAIRE GENERAL)$'
            last: ifMatch
            uai: '%2$s'
            groups: *groupsEtab18 # même traitement pour les groupes NC: 'GESTIONNAIRE.nomEtab_uai' que celui des groupes 'CHEF D ETABLISSEMENT.nomEtab_uai'

  - nom: CD45-LOIRET
    siren: 22450001700013
    ldapFilterList:
      - ldapFilterGroups: '(coll:Collectivites:CONSEIL DEPARTEMENTAL DU LOIRET:groupes_locaux:Echanges etablissements:Managers)'
        regex: '^coll:Collectivites:(CONSEIL DEPARTEMENTAL DU LOIRET):groupes_locaux:Echanges etablissements:Managers$'
        last: ifMatch
        group: &group45 'Echanges etablissements.CONSEIL DEPARTEMENTAL DU LOIRET' # création du groupe NC: 'Echanges etablissements.CONSEIL DEPARTEMENTAL DU LOIRET'
        folder: &folder45 'Échanges CD45-établissements' # création du folder 'Échanges CD45-établissements'
        permF: # droit du groupe 'Echanges etablissements.CONSEIL DEPARTEMENTAL DU LOIRET' sur le folder 'Échanges CD45-établissements'
          - write
          - share
          - delete
        quotaF: 50
      - ldapFilterGroups: '(|  (cn=clg45:Etablissements:*:Administratifs:_DIRECTION:CHEF D ETABLISSEMENT)
                               (cn=clg45:Etablissements:*:Administratifs:_PERSONNELS ADMINISTRATIFS:GESTIONNAIRE)
                               (cn=clg45:Etablissements:*:Administratifs:_PERSONNELS ADMINISTRATIFS:SECRETAIRE GENERAL)
                           )'
        regexes:
          - regex: '^clg45:Etablissements:([^_:]+\_(\d{7}\w)):Administratifs:\_DIRECTION:(CHEF D ETABLISSEMENT)$'
            last: ifMatch
            uai: '%2$s'
            groups: &groupsEtab45
              - group: '%3$s.%1$s' # création des groupes NC: 'CHEF D ETABLISSEMENT.nomEtab_uai'
                folders:
                  - folder: *folder45 # droit du groupe est lecture sur Échanges CD45-établissements
                    permF: []
                  - folder: &folderEtab45 # création des folders: 'Échanges CD45-établissements/nomEtab_uai'
                      - *folder45
                      - '%1$s'
                    quotaF: 50
                    permF:  # droits des groupes 'CHEF D ETABLISSEMENT.nomEtab_uai' sur les folders 'Échanges CD45-établissements/nomEtab_uai'
                      - write
                      - delete
              - group: *group45 # donne au groupe 'Echanges etablissements.CONSEIL DEPARTEMENTAL DU LOIRET'
                folder: *folderEtab45 # les droits sur les folders 'changes CD45-établissements/nomEtab_uai'
                permF:
                  - write
                  - delete
          - regex: '^clg45:Etablissements:([^_:]+\_(\d{7}\w)):Administratifs:\_PERSONNELS ADMINISTRATIFS:(GESTIONNAIRE|SECRETAIRE GENERAL)$'
            last: ifMatch
            uai: '%2$s'
            groups: *groupsEtab45 # même traitement pour les groupes NC: 'GESTIONNAIRE.nomEtab_uai' que celui des groupes 'CHEF D ETABLISSEMENT.nomEtab_uai'
...
