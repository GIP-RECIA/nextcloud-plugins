# les regex  sont testées dans l'ordre
# un même groupe (ldap) peut matcher  plusieurs regex
#   si il match une regex et sa definition contient "last: ifMatch" il ne sera pas representé aux autres regex 
# une 'regex' définit un ensemble de 'group' NC, fonction des groupes Grouper qui match.
# a chaque 'group' on peut associer:
#   un 'quotaG' qui definit le quota des membres du groupe, sans quota un utilisateur ne sera pas créé (il peut l'être avec un autre groupe).
#   un groupFolder 'folder' si on a un 'quotaF' le groupfolder sera créé/modifié sinon le groupe sera associé au groupfolder ssi il existe.
#   permF definit les droits du groupe sur le groupefolder  


---
etabs:
  - nom: GIP-RECIA
    siren: 18450311800020
    ldapFilterGroups: '(|(cn=coll:Collectivites:GIP-RECIA:Services:*)(cn=coll:admin:central)(cn=coll:Collectivites:GIP-RECIA:groupes_locaux:ASC:*))'
    regexs:  
      - regex: '^coll:Collectivites:(GIP-RECIA):Services:([^:]+):(?:Tous_)(\2)$'
        last: ifMatch
        groups:
          - group: 'GIP-RECIA'
              - folders:
                folder: 'GIP-RECIA'
                permF: []
                quotaF: 1
              - folder: 'GIP-RECIA/Commun'
                permF:
                  - write
                  - delete
                  - share
                quotaF: 100
          - group: '%2$s.%1$s'
            folder: '%1$s/%2$s'
            quotaF: 100
            permF:
              - write
              - share
              - delete

      - regex: '^coll:Collectivites:(GIP-RECIA):Services:([^:]+):([^:]+)$'
        last: ifMatch
        groups:
          - group: 'GIP-RECIA'
          - group: '%2$s.%1$s'
          - group: '%3$s.%1$s'
            folder: '%1$s/%2$s/%3$s'
            quotaF: 100
            permF:
              - write
              - share
              - delete

#      - regex: '^coll:admin:central$'
#        group: 'admin.central'
#        folder: 'GIP-RECIA'
#        permF:
#          - write
#          - delete
#        admin: '^GIP-RECIA((/.+)(/.+)?)?'

    # les regles pour l'asc:
      - regex: '^coll:Collectivites:(GIP-RECIA):groupes_locaux:(ASC):(ASC_[^:]+)$'
        groups:
          - group: '%2$s.%1$s'
            folder: 'ASC'
            permF: []
            quotaF: 1
          - group: '%3$s.%1$s'
            folder: 'ASC/%3$s'
            permF:
              - write
              - share
              - delete
            quotaF: 100
             
      - regex: '^coll:Collectivites:(GIP-RECIA):groupes_locaux:(ASC):(ASC_Bureau)$'
        groups:
          - group: '%3$s.%1$s'
            admin: '^ASC(/.*)?$'
...
