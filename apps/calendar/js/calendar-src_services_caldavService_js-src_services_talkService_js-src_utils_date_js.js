/*! For license information please see calendar-src_services_caldavService_js-src_services_talkService_js-src_utils_date_js.js.LICENSE.txt */
"use strict";(self.webpackChunkcalendar=self.webpackChunkcalendar||[]).push([["src_services_caldavService_js-src_services_talkService_js-src_utils_date_js"],{41788:(e,t,a)=>{a.d(t,{Ck:()=>f,Cy:()=>s,Ix:()=>m,Ky:()=>l,O6:()=>n,aC:()=>o,cj:()=>g,eE:()=>r,ik:()=>u,qJ:()=>i,s3:()=>c,uU:()=>p,yS:()=>d});const n="VEVENT",o="VJOURNAL",r="VTODO",i="principal:principals/users/",c="principal:principals/groups/",s="principal:principals/circles/",l="principal:principals/calendar-resources/",d="principal:principals/calendar-rooms/",p="contact_birthdays",u="default",m="importing",f="awaitingUserSelect",g="processing"},62531:(e,t,a)=>{a.d(t,{AX:()=>g,GM:()=>O,Gm:()=>v,Iz:()=>m,M7:()=>d,Un:()=>k,Xx:()=>C,Yh:()=>f,ak:()=>p,aq:()=>y,au:()=>w,ee:()=>N,yo:()=>h});var n=a(35781),o=a.n(n),r=a(78296),i=a(38580),c=a(41788);const s={},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(e=>JSON.stringify(e))(e);return s[t]||(s[t]=new(o())({rootUrl:(0,r.o0)("dav")},(()=>{const t={"X-Requested-With":"XMLHttpRequest",requesttoken:(0,i.SI)(),"X-NC-CalDAV-Webcal-Caching":"On",...e},a=new XMLHttpRequest,n=a.open;return a.open=function(){const e=n.apply(this,arguments);for(const e in t)a.setRequestHeader(e,t[e]);return e},OC.registerXHRForErrorProcessing(a),a}))),s[t]},d=async()=>{await l().connect({enableCalDAV:!0})},p=async()=>{await l()._createPublicCalendarHome()},u=e=>l(e).calendarHomes[0],m=()=>u().findAllCalDAVCollectionsGrouped(),f=async()=>{const e={"X-NC-CalDAV-Webcal-Caching":"Off"};return await l(e).connect({enableCalDAV:!0}),u(e).findAllSubscriptions()},g=()=>u().findAllDeletedCalendars(),y=async e=>{const t=[];for(const a of e){const e=l().publicCalendarHome.find(a).catch((()=>null));t.push(e)}return(await Promise.all(t)).filter((e=>null!==e))},h=async()=>(await u().findAllScheduleOutboxes())[0],w=async(e,t,a,n,o)=>u().createCalendarCollection(e,t,a,n,o),v=async(e,t,a,n)=>u().createSubscribedCollection(e,t,a,n),C=async()=>(await u().enableBirthdayCalendar(),b()),b=async()=>u().find(c.uU),k=()=>l().currentUserPrincipal,O=async e=>l().principalPropertySearchByDisplaynameOrEmail(e),N=async e=>l().findPrincipal(e)},51736:(e,t,a)=>{a.d(t,{Si:()=>u,jO:()=>d,uK:()=>p});var n=a(52448),o=a(59620),r=a(78296),i=a(1828),c=a(38580),s=a(70536),l=a(88936);async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=(0,i.i)("calendar","talk_api_version");try{const i=await n.c.post((0,r.QP)("apps/spreed/api/"+a+"/",2)+"room",{roomType:3,roomName:e||(0,o.translate)("calendar","Chat room for event")}),c=i.data.ocs.data.token;return t&&await n.c.put((0,r.QP)("apps/spreed/api/"+a+"/",2)+"room/"+c+"/description",{description:t}),m(c)}catch(e){throw console.debug(e),e}}async function p(e){var t,a;const o=(0,i.i)("calendar","talk_api_version"),d=null!==(t=null===(a=e.getConferenceList()[0])||void 0===a?void 0:a.uri)&&void 0!==t?t:e.location;if(!d||!d.startsWith(window.location.protocol+"//"+window.location.host))return void s.cp.debug("Event's conference/location is from another host",d);const p=null!==(u=null===(m=d.match(/\/call\/([a-z0-9]*)(\/|#.*)?$/))||void 0===m?void 0:m[1])&&void 0!==u?u:void 0;var u,m;if(p)try{const{data:{ocs:{data:t}}}=await n.c.get((0,r.QP)("apps/spreed/api/"+o+"/",2)+"room/"+p),a=await n.c.get((0,r.QP)("apps/spreed/api/"+o+"/",2)+"room/"+p+"/participants");if(!a.data.ocs.data.some((e=>e.actorId===(0,c.eo)().uid&&e.participantType<=2)))return void s.cp.debug("Current user is not a moderator or owner",{currentUser:(0,c.eo)().uid,conversation:a.data.ocs.data});console.info("room",t);for(const a of e.getAttendeeIterator()){if(s.cp.debug("Processing attendee",{attendee:a}),["GROUP","RESOURCE","ROOM"].includes(a.userType))continue;const e=(0,l.yS)(a.email);try{var f;const a=await n.c.get((0,r.QP)("core/autocomplete/",2)+"get?search="+encodeURIComponent(e)+"&itemType=&itemId=%20&shareTypes[]=0&limit=2");1===a.data.ocs.data.length&&a.data.ocs.data[0].id!==(0,c.eo)().uid?await n.c.post((0,r.QP)("apps/spreed/api/"+o+"/",2)+"room/"+p+"/participants",{newParticipant:a.data.ocs.data[0].id,source:"users"}):(null===(f=a.data.ocs.data[0])||void 0===f?void 0:f.id)===(0,c.eo)().uid?s.cp.debug("Skipping organizer "+a.data.ocs.data[0].id):3===t.type?await n.c.post((0,r.QP)("apps/spreed/api/"+o+"/",2)+"room/"+p+"/participants",{newParticipant:e,source:"emails"}):s.cp.debug("Attendee "+e+" ignored as Talk participant")}catch(t){s.cp.info("Could not add attendee "+e+" as Talk participant",{error:t})}}}catch(e){s.cp.warn("Could not update Talk room attendees",{error:e})}else s.cp.debug("URL "+d+" contains no call token")}function u(e){if(!e)return!1;const t=m();return e.includes(t)}function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return window.location.protocol+"//"+window.location.host+(0,r.AF)("/call/"+e)}},88936:(e,t,a)=>{function n(e){return"string"!=typeof e?"":e.startsWith("mailto:")?e.slice(7):e}function o(e){return e?e.commonName?e.commonName:n(e.uri):""}a.d(t,{I_:()=>o,yS:()=>n})},96752:(e,t,a)=>{a.d(t,{OU:()=>o,Y9:()=>d,_m:()=>l,hj:()=>i,oX:()=>r,sV:()=>s,u:()=>c});var n=a(70536);function o(){return new Date}function r(e){return new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0]}function i(e){return Math.floor(e.getTime()/1e3)}function c(e){if("now"===e)return o();const[t,a,r]=e.split("-").map((e=>parseInt(e,10)));if(Number.isNaN(t)||Number.isNaN(a)||Number.isNaN(r))return n.cp.error("First day parameter contains non-numerical components, falling back to today"),o();const i=o();return i.setFullYear(t,a-1,r),i.setHours(0,0,0,0),i}function s(e){return"now"===e?r(o()):e}function l(e){return new Date(e.year,e.month-1,e.day,e.hour,e.minute,0,0)}function d(e,t){let{day:a=0,week:n=0,month:o=0,year:r=0}=t;return(e=new Date(e.getTime())).setDate(e.getDate()+a),e.setDate(e.getDate()+7*n),e.setMonth(e.getMonth()+o),e.setFullYear(e.getFullYear()+r),e}}}]);
//# sourceMappingURL=calendar-src_services_caldavService_js-src_services_talkService_js-src_utils_date_js.js.map?v=180443dee34fcadc7094