{"version":3,"file":"calendar-src_store_index_js.js?v=4988033f8a438bf8d345","mappings":"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","sources":["webpack:///calendar/src/models/alarm.js","webpack:///calendar/src/models/attachment.js","webpack:///calendar/src/models/attendee.js","webpack:///calendar/src/models/calendar.js","webpack:///calendar/src/models/calendarObject.js","webpack:///calendar/src/models/calendarShare.js","webpack:///calendar/src/models/event.js","webpack:///calendar/src/models/principal.js","webpack:///calendar/src/models/recurrenceRule.js","webpack:///calendar/src/services/attachmentService.js","webpack:///calendar/src/services/settings.js","webpack:///calendar/src/store/calendarObjectInstance.js","webpack:///calendar/src/store/calendarObjects.js","webpack:///calendar/src/store/calendars.js","webpack:///calendar/src/store/contacts.js","webpack:///calendar/src/store/davRestrictions.js","webpack:///calendar/src/store/fetchedTimeRanges.js","webpack:///calendar/src/store/importFiles.js","webpack:///calendar/src/store/importState.js","webpack:///calendar/src/store/index.js","webpack:///calendar/src/store/principals.js","webpack:///calendar/src/store/settings.js","webpack:///calendar/src/utils/alarms.js","webpack:///calendar/src/utils/recurrence.js","webpack:///calendar/src/utils/settings.js"],"sourcesContent":["/**\n * @copyright Copyright (c) 2020 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport {\n\tgetAmountAndUnitForTimedEvents,\n\tgetAmountHoursMinutesAndUnitForAllDayEvents,\n} from '../utils/alarms.js'\nimport { getDateFromDateTimeValue } from '../utils/date.js'\n\n/**\n * Creates a complete alarm object based on given props\n *\n * @param {object} props The alarm properties already provided\n * @return {object}\n */\nconst getDefaultAlarmObject = (props = {}) => Object.assign({}, {\n\t// The calendar-js alarm component\n\talarmComponent: null,\n\t// Type of alarm: DISPLAY, EMAIL, AUDIO\n\ttype: null,\n\t// Whether or not the alarm is relative\n\tisRelative: false,\n\t// Date object of an absolute alarm (if it's absolute, it must be DATE-TIME)\n\tabsoluteDate: null,\n\t// The time zone id of for absolute alarms\n\tabsoluteTimezoneId: null,\n\t// Whether or not the relative alarm is before the event,\n\trelativeIsBefore: null,\n\t// Whether or not the alarm is relative to the event's start\n\trelativeIsRelatedToStart: null,\n\t// TIMED EVENTS:\n\t// Unit (seconds, minutes, hours, ...) if this alarm is inside a timed event\n\trelativeUnitTimed: null,\n\t// The amount of unit if this alarm is inside a timed event\n\trelativeAmountTimed: null,\n\t// ALL-DAY EVENTS:\n\t// Unit (seconds, minutes, hours, ...) if this alarm is inside an all-day event\n\trelativeUnitAllDay: null,\n\t// The amount of unit if this alarm is inside a all-day event\n\trelativeAmountAllDay: null,\n\t// The hours to display alarm for in an all-day event (e.g. 1 day before at 9:00 am)\n\trelativeHoursAllDay: null,\n\t// The minutes to display alarm for in an all-day event (e.g. 1 day before at 9:30 am)\n\trelativeMinutesAllDay: null,\n\t// The total amount of seconds for a relative alarm\n\trelativeTrigger: null,\n}, props)\n\n/**\n * Map an alarm component to our alarm object\n *\n * @param {AlarmComponent} alarmComponent The calendar-js alarm-component to turn into an alarm object\n * @return {object}\n */\nconst mapAlarmComponentToAlarmObject = (alarmComponent) => {\n\tif (alarmComponent.trigger.isRelative()) {\n\t\tconst relativeIsBefore = alarmComponent.trigger.value.isNegative\n\t\tconst relativeIsRelatedToStart = alarmComponent.trigger.related === 'START'\n\n\t\tconst {\n\t\t\tamount: relativeAmountTimed,\n\t\t\tunit: relativeUnitTimed,\n\t\t} = getAmountAndUnitForTimedEvents(alarmComponent.trigger.value.totalSeconds)\n\n\t\tconst {\n\t\t\tunit: relativeUnitAllDay,\n\t\t\tamount: relativeAmountAllDay,\n\t\t\thours: relativeHoursAllDay,\n\t\t\tminutes: relativeMinutesAllDay,\n\t\t} = getAmountHoursMinutesAndUnitForAllDayEvents(alarmComponent.trigger.value.totalSeconds)\n\n\t\tconst relativeTrigger = alarmComponent.trigger.value.totalSeconds\n\n\t\treturn getDefaultAlarmObject({\n\t\t\talarmComponent,\n\t\t\ttype: alarmComponent.action,\n\t\t\tisRelative: alarmComponent.trigger.isRelative(),\n\t\t\trelativeIsBefore,\n\t\t\trelativeIsRelatedToStart,\n\t\t\trelativeUnitTimed,\n\t\t\trelativeAmountTimed,\n\t\t\trelativeUnitAllDay,\n\t\t\trelativeAmountAllDay,\n\t\t\trelativeHoursAllDay,\n\t\t\trelativeMinutesAllDay,\n\t\t\trelativeTrigger,\n\t\t})\n\t} else {\n\t\tconst absoluteDate = getDateFromDateTimeValue(alarmComponent.trigger.value)\n\n\t\treturn getDefaultAlarmObject({\n\t\t\talarmComponent,\n\t\t\ttype: alarmComponent.action,\n\t\t\tisRelative: alarmComponent.trigger.isRelative(),\n\t\t\tabsoluteDate,\n\t\t\tabsoluteTimezoneId: alarmComponent.trigger.value.timezoneId,\n\t\t})\n\t}\n}\n\nexport {\n\tgetDefaultAlarmObject,\n\tmapAlarmComponentToAlarmObject,\n}\n","/**\n * @copyright Copyright (c) 2022 Mikhail Sazanov\n *\n * @author Mikhail Sazanov <m@sazanof.ru>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\n/**\n * Creates a complete attachment object based on given props\n *\n * @param {object} props The attachment properties already provided\n * @return {object}\n */\nconst getDefaultAttachmentObject = (props = {}) => Object.assign({}, {\n\t// The calendar-js attachment property\n\tattachmentProperty: null,\n\t// The file name of the attachment\n\tfileName: null,\n\t// The attachment mime type\n\tformatType: null,\n\t// The uri of the attachment\n\turi: null,\n\t// The value from calendar object\n\tvalue: null,\n\t// Preview of file\n\txNcHasPreview: null,\n\t// File id in NC\n\txNcFileId: null,\n}, props)\n\n/**\n * Maps a calendar-js attachment property to our attachment object\n *\n * @param {attachmentProperty} attachmentProperty The calendar-js attachmentProperty to turn into a attachment object\n * @return {object}\n */\nconst mapAttachmentPropertyToAttchmentObject = (attachmentProperty) => {\n\treturn getDefaultAttachmentObject({\n\t\tattachmentProperty,\n\t\tfileName: attachmentProperty.getParameterFirstValue('FILENAME'),\n\t\tformatType: attachmentProperty.formatType,\n\t\turi: attachmentProperty.uri,\n\t\tvalue: attachmentProperty.value,\n\t\txNcHasPreview: attachmentProperty.getParameterFirstValue('X-NC-HAS-PREVIEW') === 'true',\n\t\txNcFileId: attachmentProperty.getParameterFirstValue('X-NC-FILE-ID'),\n\t})\n}\n\nexport {\n\tgetDefaultAttachmentObject,\n\tmapAttachmentPropertyToAttchmentObject,\n}\n","/**\n * @copyright Copyright (c) 2020 Georg Ehrke\n * @copyright Copyright (c) 2023 Jonas Heinrich\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n * @author Jonas Heinrich <heinrich@synyx.net>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\n/**\n * Creates a complete attendee object based on given props\n *\n * TODO:\n *  - we should eventually support delegatedFrom and delegatedTo\n *\n * @param {object} props The attendee properties already provided\n * @return {object}\n */\nconst getDefaultAttendeeObject = (props = {}) => Object.assign({}, {\n\t// The calendar-js attendee property\n\tattendeeProperty: null,\n\t// The display-name of the attendee\n\tcommonName: null,\n\t// The calendar-user-type of the attendee\n\tcalendarUserType: 'INDIVIDUAL',\n\t// The participation status of the attendee\n\tparticipationStatus: 'NEEDS-ACTION',\n\t// The role of the attendee\n\trole: 'REQ-PARTICIPANT',\n\t// The RSVP for the attendee\n\trsvp: false,\n\t// The uri of the attendee\n\turi: null,\n\t// Member address of the attendee\n\tmember: null,\n}, props)\n\n/**\n * Maps a calendar-js attendee property to our attendee object\n *\n * @param {AttendeeProperty} attendeeProperty The calendar-js attendeeProperty to turn into a attendee object\n * @return {object}\n */\nconst mapAttendeePropertyToAttendeeObject = (attendeeProperty) => {\n\treturn getDefaultAttendeeObject({\n\t\tattendeeProperty,\n\t\tcommonName: attendeeProperty.commonName,\n\t\tcalendarUserType: attendeeProperty.userType,\n\t\tparticipationStatus: attendeeProperty.participationStatus,\n\t\trole: attendeeProperty.role,\n\t\trsvp: attendeeProperty.rsvp,\n\t\turi: attendeeProperty.email,\n\t\tmember: attendeeProperty.member,\n\t})\n}\n\nexport {\n\tgetDefaultAttendeeObject,\n\tmapAttendeePropertyToAttendeeObject,\n}\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { detectColor, uidToHexColor } from '../utils/color.js'\nimport { mapDavShareeToCalendarShareObject } from './calendarShare.js'\n\n/**\n * Creates a complete calendar-object based on given props\n *\n * @param {object} props Calendar-props already provided\n * @return {object}\n */\nconst getDefaultCalendarObject = (props = {}) => Object.assign({}, {\n\t// Id of the calendar\n\tid: '',\n\t// Visible display name\n\tdisplayName: '',\n\t// Color of the calendar\n\tcolor: uidToHexColor(''),\n\t// Whether or not the calendar is visible in the grid\n\tenabled: true,\n\t// Whether or not the calendar is loading events at the moment\n\tloading: false,\n\t// Whether this calendar supports VEvents\n\tsupportsEvents: true,\n\t// Whether this calendar supports VJournals\n\tsupportsJournals: false,\n\t// Whether this calendar supports VTodos\n\tsupportsTasks: false,\n\t// The principal uri of the owner\n\towner: '',\n\t// Timezone set for this calendar\n\ttimezone: null,\n\t// List of shares\n\tshares: [],\n\t// Published url\n\tpublishURL: null,\n\t// Internal CalDAV url of this calendar\n\turl: '',\n\t// Whether this calendar is read-only\n\treadOnly: false,\n\t// The order of this calendar in the calendar-list\n\torder: 0,\n\t// Whether or not the calendar is shared with me\n\tisSharedWithMe: false,\n\t// Whether or not the calendar can be shared by me\n\tcanBeShared: false,\n\t// Whether or not the calendar can be published by me\n\tcanBePublished: false,\n\t// Reference to cdav-lib object\n\tdav: false,\n\t// All calendar-objects from this calendar that have already been fetched\n\tcalendarObjects: [],\n\t// Time-ranges that have already been fetched for this calendar\n\tfetchedTimeRanges: [],\n}, props)\n\n/**\n * Map a dav collection to our calendar object model\n *\n * @param {object} calendar The calendar object from the cdav library\n * @param {object=} currentUserPrincipal The principal model of the current user principal\n * @return {object}\n */\nconst mapDavCollectionToCalendar = (calendar, currentUserPrincipal) => {\n\tconst id = btoa(calendar.url)\n\tconst displayName = calendar.displayname || getCalendarUriFromUrl(calendar.url)\n\n\t// calendar.color can be set to anything on the server,\n\t// so make sure it's something that remotely looks like a color\n\tlet color = detectColor(calendar.color)\n\tif (!color) {\n\t\t// As fallback if we don't know what color that is supposed to be\n\t\tcolor = uidToHexColor(displayName)\n\t}\n\n\tconst supportsEvents = calendar.components.includes('VEVENT')\n\tconst supportsJournals = calendar.components.includes('VJOURNAL')\n\tconst supportsTasks = calendar.components.includes('VTODO')\n\tconst owner = calendar.owner\n\tconst readOnly = !calendar.isWriteable()\n\tconst canBeShared = calendar.isShareable()\n\tconst canBePublished = calendar.isPublishable()\n\tconst order = calendar.order || 0\n\tconst url = calendar.url\n\tconst publishURL = calendar.publishURL || null\n\tconst timezone = calendar.timezone || null\n\n\tlet isSharedWithMe = false\n\tif (!currentUserPrincipal) {\n\t\t// If the user is not authenticated, the calendar\n\t\t// will always be marked as shared with them\n\t\tisSharedWithMe = true\n\t} else {\n\t\tisSharedWithMe = (owner !== currentUserPrincipal.url)\n\t}\n\n\tlet enabled\n\tif (!currentUserPrincipal) {\n\t\t// If the user is not authenticated,\n\t\t// always enable the calendar\n\t\tenabled = true\n\t} else if (typeof calendar.enabled === 'boolean') {\n\t\t// If calendar-enabled is set, we will just take that\n\t\tenabled = calendar.enabled\n\t} else {\n\t\t// If there is no calendar-enabled,\n\t\t// we will display the calendar by default and set enabled\n\t\tenabled = true\n\t\tcalendar.enabled = true\n\t}\n\n\tconst shares = []\n\tif (!!currentUserPrincipal && Array.isArray(calendar.shares)) {\n\t\tfor (const share of calendar.shares) {\n\t\t\tif (share.href === currentUserPrincipal.principalScheme) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tshares.push(mapDavShareeToCalendarShareObject(share))\n\t\t}\n\t}\n\n\treturn getDefaultCalendarObject({\n\t\tid,\n\t\tdisplayName,\n\t\tcolor,\n\t\torder,\n\t\turl,\n\t\tenabled,\n\t\tsupportsEvents,\n\t\tsupportsJournals,\n\t\tsupportsTasks,\n\t\tisSharedWithMe,\n\t\towner,\n\t\treadOnly,\n\t\tpublishURL,\n\t\tcanBeShared,\n\t\tcanBePublished,\n\t\tshares,\n\t\ttimezone,\n\t\tdav: calendar,\n\t})\n}\n\n/**\n * Gets the calendar uri from the url\n *\n * @param {string} url The url to get calendar uri from\n * @return {string}\n */\nfunction getCalendarUriFromUrl(url) {\n\tif (url.endsWith('/')) {\n\t\turl = url.substring(0, url.length - 1)\n\t}\n\n\treturn url.substring(url.lastIndexOf('/') + 1)\n}\n\nexport {\n\tgetDefaultCalendarObject,\n\tmapDavCollectionToCalendar,\n}\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { getParserManager } from '@nextcloud/calendar-js'\nimport {\n\tCOMPONENT_NAME_EVENT,\n\tCOMPONENT_NAME_JOURNAL,\n\tCOMPONENT_NAME_VTODO,\n} from './consts.js'\n\n/**\n * Creates a complete calendar-object-object based on given props\n *\n * @param {object} props Calendar-object-props already provided\n * @return {object}\n */\nconst getDefaultCalendarObjectObject = (props = {}) => Object.assign({}, {\n\t// Id of this calendar-object\n\tid: null,\n\t// Id of the associated calendar\n\tcalendarId: null,\n\t// The cdav-library object storing the calendar-object\n\tdav: null,\n\t// The parsed calendar-js object\n\tcalendarComponent: null,\n\t// The uid of the calendar-object\n\tuid: null,\n\t// The uri of the calendar-object\n\turi: null,\n\t// The type of calendar-object\n\tobjectType: null,\n\t// Whether or not the calendar-object is an event\n\tisEvent: false,\n\t// Whether or not the calendar-object is a journal\n\tisJournal: false,\n\t// Whether or not the calendar-object is a task\n\tisTodo: false,\n\t// Whether or not the calendar-object exists on the server\n\texistsOnServer: false,\n}, props)\n\n/**\n * Maps a calendar-object from c-dav to our calendar-object object\n *\n * @param {VObject} dav The c-dav VObject\n * @param {string} calendarId The calendar-id this object is associated with\n * @return {object}\n */\nconst mapCDavObjectToCalendarObject = (dav, calendarId) => {\n\tconst parserManager = getParserManager()\n\tconst parser = parserManager.getParserForFileType('text/calendar')\n\n\t// This should not be the case, but let's just be on the safe side\n\tif (typeof dav.data !== 'string' || dav.data.trim() === '') {\n\t\tthrow new Error('Empty calendar object')\n\t}\n\n\tparser.parse(dav.data)\n\tconst calendarComponentIterator = parser.getItemIterator()\n\tconst calendarComponent = calendarComponentIterator.next().value\n\tif (!calendarComponent) {\n\t\tthrow new Error('Empty calendar object')\n\t}\n\n\tconst vObjectIterator = calendarComponent.getVObjectIterator()\n\tconst firstVObject = vObjectIterator.next().value\n\n\treturn getDefaultCalendarObjectObject({\n\t\tid: btoa(dav.url),\n\t\tcalendarId,\n\t\tdav,\n\t\tcalendarComponent,\n\t\tuid: firstVObject.uid,\n\t\turi: dav.url,\n\t\tobjectType: firstVObject.name,\n\t\tisEvent: firstVObject.name === COMPONENT_NAME_EVENT,\n\t\tisJournal: firstVObject.name === COMPONENT_NAME_JOURNAL,\n\t\tisTodo: firstVObject.name === COMPONENT_NAME_VTODO,\n\t\texistsOnServer: true,\n\t})\n}\n\n/**\n * Maps a calendar-component from calendar-js to our calendar-object object\n *\n * @param {CalendarComponent} calendarComponent The calendarComponent to create the calendarObject from\n * @param {string=} calendarId The associated calendar if applicable\n * @return {object}\n */\nconst mapCalendarJsToCalendarObject = (calendarComponent, calendarId = null) => {\n\tconst vObjectIterator = calendarComponent.getVObjectIterator()\n\tconst firstVObject = vObjectIterator.next().value\n\tif (!firstVObject) {\n\t\tthrow new Error('Calendar object without vobjects')\n\t}\n\n\treturn getDefaultCalendarObjectObject({\n\t\tcalendarId,\n\t\tcalendarComponent,\n\t\tuid: firstVObject.uid,\n\t\tobjectType: firstVObject.name,\n\t\tisEvent: firstVObject.name === COMPONENT_NAME_EVENT,\n\t\tisJournal: firstVObject.name === COMPONENT_NAME_JOURNAL,\n\t\tisTodo: firstVObject.name === COMPONENT_NAME_VTODO,\n\t})\n}\n\nexport {\n\tgetDefaultCalendarObjectObject,\n\tmapCDavObjectToCalendarObject,\n\tmapCalendarJsToCalendarObject,\n}\n","/**\n * @copyright Copyright (c) 2020 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport {\n\tPRINCIPAL_PREFIX_CIRCLE,\n\tPRINCIPAL_PREFIX_GROUP,\n\tPRINCIPAL_PREFIX_USER,\n} from './consts.js'\n\n/**\n * Creates a complete calendar-share-object based on given props\n *\n * @param {object} props Calendar-share-props already provided\n * @return {object}\n */\nconst getDefaultCalendarShareObject = (props = {}) => Object.assign({}, {\n\t// Unique identifier\n\tid: null,\n\t// Displayname of the sharee\n\tdisplayName: null,\n\t// Whether or not share is writable\n\twriteable: false,\n\t// Whether or not sharee is an individual user\n\tisUser: false,\n\t// Whether or not sharee is an admin-defined group\n\tisGroup: false,\n\t// Whether or not sharee is a user-defined group\n\tisCircle: false,\n\t// Uri necessary for deleting / updating share\n\turi: null,\n}, props)\n\n/**\n * Map a dav collection to our calendar object model\n *\n * @param {object} sharee The sharee object from the cdav library shares\n * @return {object}\n */\nconst mapDavShareeToCalendarShareObject = (sharee) => {\n\t// sharee.href might contain non-latin characters, so let's uri encode it first\n\tconst id = btoa(encodeURI(sharee.href))\n\n\tlet displayName\n\tif (sharee['common-name'] && sharee['common-name'].trim() !== '') {\n\t\tdisplayName = sharee['common-name']\n\t} else if (sharee.href.startsWith(PRINCIPAL_PREFIX_GROUP)) {\n\t\tdisplayName = decodeURIComponent(sharee.href.slice(28))\n\t} else if (sharee.href.startsWith(PRINCIPAL_PREFIX_USER)) {\n\t\tdisplayName = decodeURIComponent(sharee.href.slice(27))\n\t} else {\n\t\tdisplayName = sharee.href\n\t}\n\n\tconst writeable = sharee.access[0].endsWith('read-write')\n\tconst isUser = sharee.href.startsWith(PRINCIPAL_PREFIX_USER)\n\tconst isGroup = sharee.href.startsWith(PRINCIPAL_PREFIX_GROUP)\n\tconst isCircle = sharee.href.startsWith(PRINCIPAL_PREFIX_CIRCLE)\n\tconst uri = sharee.href\n\n\treturn getDefaultCalendarShareObject({\n\t\tid,\n\t\tdisplayName,\n\t\twriteable,\n\t\tisUser,\n\t\tisGroup,\n\t\tisCircle,\n\t\turi,\n\t})\n}\n\nexport {\n\tgetDefaultCalendarShareObject,\n\tmapDavShareeToCalendarShareObject,\n}\n","/**\n * @copyright Copyright (c) 2020 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { getDateFromDateTimeValue } from '../utils/date.js'\nimport { DurationValue, DateTimeValue } from '@nextcloud/calendar-js'\nimport { getHexForColorName, getClosestCSS3ColorNameForHex } from '../utils/color.js'\nimport { mapAlarmComponentToAlarmObject } from './alarm.js'\nimport { mapAttendeePropertyToAttendeeObject } from './attendee.js'\nimport { mapAttachmentPropertyToAttchmentObject } from './attachment.js'\nimport {\n\tgetDefaultRecurrenceRuleObject,\n\tmapRecurrenceRuleValueToRecurrenceRuleObject,\n} from './recurrenceRule.js'\n\n/**\n * Creates a complete calendar-object-instance-object based on given props\n *\n * @param {object} props The props already provided\n * @return {object}\n */\nconst getDefaultEventObject = (props = {}) => Object.assign({}, {\n\t// The real event-component coming from calendar-js\n\teventComponent: null,\n\t// Title of the event\n\ttitle: null,\n\t// Start date of the event\n\tstartDate: null,\n\t// Timezone of the start date\n\tstartTimezoneId: null,\n\t// End date of the event\n\tendDate: null,\n\t// Timezone of the end date\n\tendTimezoneId: null,\n\t// Indicator whether or not event is all-day\n\tisAllDay: false,\n\t// Whether or not the user is allowed to toggle the all-day checkbox\n\tcanModifyAllDay: true,\n\t// Location that the event takes places in\n\tlocation: null,\n\t// description of the event\n\tdescription: null,\n\t// Access class of the event (PUBLIC, PRIVATE, CONFIDENTIAL)\n\taccessClass: null,\n\t// Status of the event (CONFIRMED, TENTATIVE, CANCELLED)\n\tstatus: null,\n\t// Whether or not to block this event in Free-Busy reports (TRANSPARENT, OPAQUE)\n\ttimeTransparency: null,\n\t// The recurrence rule of this event. We only support one recurrence-rule\n\trecurrenceRule: getDefaultRecurrenceRuleObject(),\n\t// Whether or not this event has multiple recurrence-rules\n\thasMultipleRRules: false,\n\t// Whether or not this is the master item\n\tisMasterItem: false,\n\t// Whether or not this is a recurrence-exception\n\tisRecurrenceException: false,\n\t// Whether or not the applied modifications require to update this and all future\n\tforceThisAndAllFuture: false,\n\t// Whether or not it's possible to create a recurrence-exception for this event\n\tcanCreateRecurrenceException: false,\n\t// Attendees of this event\n\tattendees: [],\n\t// Organizer of the event\n\torganizer: null,\n\t// Alarm of the event\n\talarms: [],\n\t// Custom color of the event\n\tcustomColor: null,\n\t// Categories\n\tcategories: [],\n\t// Attachments of this event\n\tattachments: [],\n}, props)\n\n/**\n *\n * @param {EventComponent} eventComponent The calendar-js eventComponent\n * @return {object}\n */\nconst mapEventComponentToEventObject = (eventComponent) => {\n\tconst eventObject = getDefaultEventObject({\n\t\teventComponent,\n\t\ttitle: eventComponent.title,\n\t\tisAllDay: eventComponent.isAllDay(),\n\t\tcanModifyAllDay: eventComponent.canModifyAllDay(),\n\t\tlocation: eventComponent.location,\n\t\tdescription: eventComponent.description,\n\t\taccessClass: eventComponent.accessClass,\n\t\tstatus: eventComponent.status,\n\t\ttimeTransparency: eventComponent.timeTransparency,\n\t\tcategories: Array.from(eventComponent.getCategoryIterator()),\n\t\tisMasterItem: eventComponent.isMasterItem(),\n\t\tisRecurrenceException: eventComponent.isRecurrenceException(),\n\t\tcanCreateRecurrenceException: eventComponent.canCreateRecurrenceExceptions(),\n\t})\n\n\t/**\n\t * According to RFC5545, DTEND is exclusive. This is rather intuitive for timed-events\n\t * but rather unintuitive for all-day events\n\t *\n\t * That's why, when an event is all-day from 2019-10-03 to 2019-10-04,\n\t * it will be displayed as 2019-10-03 to 2019-10-03 in the editor.\n\t */\n\teventObject.startDate = getDateFromDateTimeValue(eventComponent.startDate)\n\teventObject.startTimezoneId = eventComponent.startDate.timezoneId\n\n\tif (eventComponent.isAllDay()) {\n\t\tconst endDate = eventComponent.endDate.clone()\n\t\tendDate.addDuration(DurationValue.fromSeconds(-1 * 60 * 60 * 24))\n\t\teventObject.endDate = getDateFromDateTimeValue(endDate)\n\t} else {\n\t\teventObject.endDate = getDateFromDateTimeValue(eventComponent.endDate)\n\t}\n\teventObject.endTimezoneId = eventComponent.endDate.timezoneId\n\n\t/**\n\t * Extract organizer if there is any\n\t */\n\tif (eventComponent.organizer) {\n\t\tconst organizerProperty = eventComponent.getFirstProperty('ORGANIZER')\n\t\teventObject.organizer = {\n\t\t\tcommonName: organizerProperty.commonName,\n\t\t\turi: organizerProperty.email,\n\t\t\tattendeeProperty: organizerProperty,\n\t\t}\n\t}\n\n\t/**\n\t * Extract alarms\n\t */\n\tfor (const alarm of eventComponent.getAlarmIterator()) {\n\t\teventObject.alarms.push(mapAlarmComponentToAlarmObject(alarm))\n\t}\n\n\t/**\n\t * Extract attendees\n\t */\n\tfor (const attendee of eventComponent.getAttendeeIterator()) {\n\t\teventObject.attendees.push(mapAttendeePropertyToAttendeeObject(attendee))\n\t}\n\n\t/**\n\t * Extract attachments\n\t */\n\n\tfor (const attachment of eventComponent.getPropertyIterator('ATTACH')) {\n\t\teventObject.attachments.push(mapAttachmentPropertyToAttchmentObject(attachment))\n\t}\n\n\t/**\n\t * Extract recurrence-rule\n\t */\n\tconst recurrenceRuleIterator = eventComponent.getPropertyIterator('RRULE')\n\tconst recurrenceRuleFirstIteration = recurrenceRuleIterator.next()\n\n\tconst firstRecurrenceRule = recurrenceRuleFirstIteration.value\n\tif (firstRecurrenceRule) {\n\t\teventObject.recurrenceRule = mapRecurrenceRuleValueToRecurrenceRuleObject(firstRecurrenceRule.getFirstValue(), eventComponent.startDate)\n\t\teventObject.hasMultipleRRules = !recurrenceRuleIterator.next().done\n\t}\n\n\t/**\n\t * Convert the CSS 3 color name to a hex color\n\t */\n\tif (eventComponent.hasProperty('COLOR')) {\n\t\tconst hexColor = getHexForColorName(eventComponent.getFirstPropertyFirstValue('COLOR'))\n\t\tif (hexColor !== null) {\n\t\t\teventObject.customColor = hexColor\n\t\t}\n\t}\n\n\treturn eventObject\n}\n\n/**\n * Copy data from a calendar-object-instance into a calendar-js event-component\n *\n * @param {object} eventObject The calendar-object-instance object\n * @param {EventComponent} eventComponent The calendar-js EventComponent object\n */\nconst copyCalendarObjectInstanceIntoEventComponent = (eventObject, eventComponent) => {\n\teventComponent.title = eventObject.title\n\teventComponent.location = eventObject.location\n\teventComponent.description = eventObject.description\n\teventComponent.accessClass = eventObject.accessClass\n\teventComponent.status = eventObject.status\n\teventComponent.timeTransparency = eventObject.timeTransparency\n\n\tfor (const category of eventObject.categories) {\n\t\teventComponent.addCategory(category)\n\t}\n\n\tif (eventObject.organizer) {\n\t\teventComponent.setOrganizerFromNameAndEMail(eventObject.organizer.commonName, eventObject.organizer.uri)\n\t}\n\n\tfor (const alarm of eventObject.alarms) {\n\t\tif (alarm.isRelative) {\n\t\t\tconst duration = DurationValue.fromSeconds(alarm.relativeTrigger)\n\t\t\teventComponent.addRelativeAlarm(alarm.type, duration, alarm.relativeIsRelatedToStart)\n\t\t} else {\n\t\t\tconst date = DateTimeValue.fromJSDate(alarm.absoluteDate)\n\t\t\teventComponent.addAbsoluteAlarm(alarm.type, date)\n\t\t}\n\t}\n\n\tfor (const attendee of eventObject.attendees) {\n\t\teventComponent.addProperty(attendee.attendeeProperty)\n\t}\n\n\tfor (const rule of eventObject.eventComponent.getPropertyIterator('RRULE')) {\n\t\teventComponent.addProperty(rule)\n\t}\n\n\tif (eventObject.customColor) {\n\t\teventComponent.color = getClosestCSS3ColorNameForHex(eventObject.customColor)\n\t}\n}\n\nexport {\n\tgetDefaultEventObject,\n\tmapEventComponentToEventObject,\n\tcopyCalendarObjectInstanceIntoEventComponent,\n}\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport {\n\tPRINCIPAL_PREFIX_CALENDAR_RESOURCE,\n\tPRINCIPAL_PREFIX_CALENDAR_ROOM,\n\tPRINCIPAL_PREFIX_CIRCLE,\n\tPRINCIPAL_PREFIX_GROUP,\n\tPRINCIPAL_PREFIX_USER,\n} from './consts.js'\n\n/**\n * Creates a complete principal-object based on given props\n *\n * @param {object} props Principal-props already provided\n * @return {any}\n */\nconst getDefaultPrincipalObject = (props) => Object.assign({}, {\n\t// Id of the principal\n\tid: null,\n\t// Calendar-user-type. This can be INDIVIDUAL, GROUP, RESOURCE or ROOM\n\tcalendarUserType: 'INDIVIDUAL',\n\t// E-Mail address of principal used for scheduling\n\temailAddress: null,\n\t// The principals display-name\n\t// TODO: this should be renamed to displayName\n\tdisplayname: null,\n\t// principalScheme\n\tprincipalScheme: null,\n\t// The internal user-id in case it is of type INDIVIDUAL and a user\n\t// TODO: userId is deprecrated, use principalId instead\n\tuserId: null,\n\t// url to the DAV-principal-resource\n\turl: null,\n\t// The cdav-library object\n\tdav: null,\n\t// Whether or not this principal represents a circle\n\tisCircle: false,\n\t// Whether or not this principal represents a user\n\tisUser: false,\n\t// Whether or not this principal represents a group\n\tisGroup: false,\n\t// Whether or not this principal represents a calendar-resource\n\tisCalendarResource: false,\n\t// Whether or not this principal represents a calendar-room\n\tisCalendarRoom: false,\n\t// The id of the principal without prefix. e.g. userId / groupId / etc.\n\tprincipalId: null,\n\t// The url of the default calendar for invitations\n\tscheduleDefaultCalendarUrl: null,\n}, props)\n\n/**\n * converts a dav principal into a vuex object\n *\n * @param {object} dav cdav-library Principal object\n * @return {object}\n */\nconst mapDavToPrincipal = (dav) => {\n\tconst id = btoa(encodeURI(dav.url))\n\tconst calendarUserType = dav.calendarUserType\n\tconst principalScheme = dav.principalScheme\n\tconst emailAddress = dav.email\n\n\tconst displayname = dav.displayname\n\tconst scheduleDefaultCalendarUrl = dav.scheduleDefaultCalendarUrl\n\n\tconst isUser = dav.principalScheme.startsWith(PRINCIPAL_PREFIX_USER)\n\tconst isGroup = dav.principalScheme.startsWith(PRINCIPAL_PREFIX_GROUP)\n\tconst isCircle = dav.principalScheme.startsWith(PRINCIPAL_PREFIX_CIRCLE)\n\tconst isCalendarResource = dav.principalScheme.startsWith(PRINCIPAL_PREFIX_CALENDAR_RESOURCE)\n\tconst isCalendarRoom = dav.principalScheme.startsWith(PRINCIPAL_PREFIX_CALENDAR_ROOM)\n\n\tlet principalId = null\n\tif (isUser) {\n\t\tprincipalId = dav.principalScheme.substring(PRINCIPAL_PREFIX_USER.length)\n\t} else if (isGroup) {\n\t\tprincipalId = dav.principalScheme.substring(PRINCIPAL_PREFIX_GROUP.length)\n\t} else if (isCircle) {\n\t\tprincipalId = dav.principalScheme.substring(PRINCIPAL_PREFIX_CIRCLE.length)\n\t} else if (isCalendarResource) {\n\t\tprincipalId = dav.principalScheme.substring(PRINCIPAL_PREFIX_CALENDAR_RESOURCE.length)\n\t} else if (isCalendarRoom) {\n\t\tprincipalId = dav.principalScheme.substring(PRINCIPAL_PREFIX_CALENDAR_ROOM.length)\n\t}\n\n\tconst url = dav.principalUrl\n\tconst userId = dav.userId\n\n\treturn getDefaultPrincipalObject({\n\t\tid,\n\t\tcalendarUserType,\n\t\tprincipalScheme,\n\t\temailAddress,\n\t\tdisplayname,\n\t\turl,\n\t\tdav,\n\t\tisUser,\n\t\tisGroup,\n\t\tisCircle,\n\t\tisCalendarResource,\n\t\tisCalendarRoom,\n\t\tprincipalId,\n\t\tuserId,\n\t\tscheduleDefaultCalendarUrl,\n\t})\n}\n\nexport {\n\tgetDefaultPrincipalObject,\n\tmapDavToPrincipal,\n}\n","/**\n * @copyright Copyright (c) 2020 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { getWeekDayFromDate } from '../utils/recurrence.js'\nimport { getDateFromDateTimeValue } from '../utils/date.js'\n\n/**\n * Creates a complete recurrence-rule-object based on given props\n *\n * @param {object} props Recurrence-rule-object-props already provided\n * @return {object}\n */\nconst getDefaultRecurrenceRuleObject = (props = {}) => Object.assign({}, {\n\t// The calendar-js recurrence-rule value\n\trecurrenceRuleValue: null,\n\t// The frequency of the recurrence-rule (DAILY, WEEKLY, ...)\n\tfrequency: 'NONE',\n\t// The interval of the recurrence-rule, must be a positive integer\n\tinterval: 1,\n\t// Positive integer if recurrence-rule limited by count, null otherwise\n\tcount: null,\n\t// Date if recurrence-rule limited by date, null otherwise\n\t// We do not store a timezone here, since we only care about the date part\n\tuntil: null,\n\t// List of byDay components to limit/expand the recurrence-rule\n\tbyDay: [],\n\t// List of byMonth components to limit/expand the recurrence-rule\n\tbyMonth: [],\n\t// List of byMonthDay components to limit/expand the recurrence-rule\n\tbyMonthDay: [],\n\t// A position to limit the recurrence-rule (e.g. -1 for last Friday)\n\tbySetPosition: null,\n\t// Whether or not the rule is not supported for editing\n\tisUnsupported: false,\n}, props)\n\n/**\n * Maps a calendar-js recurrence-rule-value to an recurrence-rule-object\n *\n * @param {RecurValue} recurrenceRuleValue The calendar-js recurrence rule value\n * @param {DateTimeValue} baseDate The base-date used to fill unset values\n * @return {object}\n */\nconst mapRecurrenceRuleValueToRecurrenceRuleObject = (recurrenceRuleValue, baseDate) => {\n\tswitch (recurrenceRuleValue.frequency) {\n\tcase 'DAILY':\n\t\treturn mapDailyRuleValueToRecurrenceRuleObject(recurrenceRuleValue)\n\n\tcase 'WEEKLY':\n\t\treturn mapWeeklyRuleValueToRecurrenceRuleObject(recurrenceRuleValue, baseDate)\n\n\tcase 'MONTHLY':\n\t\treturn mapMonthlyRuleValueToRecurrenceRuleObject(recurrenceRuleValue, baseDate)\n\n\tcase 'YEARLY':\n\t\treturn mapYearlyRuleValueToRecurrenceRuleObject(recurrenceRuleValue, baseDate)\n\n\tdefault: // SECONDLY, MINUTELY, HOURLY\n\t\treturn getDefaultRecurrenceRuleObjectForRecurrenceValue(recurrenceRuleValue, {\n\t\t\tisUnsupported: true,\n\t\t})\n\t}\n}\n\nconst FORBIDDEN_BY_PARTS_DAILY = [\n\t'BYSECOND',\n\t'BYMINUTE',\n\t'BYHOUR',\n\t'BYDAY',\n\t'BYMONTHDAY',\n\t'BYYEARDAY',\n\t'BYWEEKNO',\n\t'BYMONTH',\n\t'BYSETPOS',\n]\nconst FORBIDDEN_BY_PARTS_WEEKLY = [\n\t'BYSECOND',\n\t'BYMINUTE',\n\t'BYHOUR',\n\t'BYMONTHDAY',\n\t'BYYEARDAY',\n\t'BYWEEKNO',\n\t'BYMONTH',\n\t'BYSETPOS',\n]\nconst FORBIDDEN_BY_PARTS_MONTHLY = [\n\t'BYSECOND',\n\t'BYMINUTE',\n\t'BYHOUR',\n\t'BYYEARDAY',\n\t'BYWEEKNO',\n\t'BYMONTH',\n]\nconst FORBIDDEN_BY_PARTS_YEARLY = [\n\t'BYSECOND',\n\t'BYMINUTE',\n\t'BYHOUR',\n\t'BYMONTHDAY',\n\t'BYYEARDAY',\n\t'BYWEEKNO',\n]\n\nconst SUPPORTED_BY_DAY_WEEKLY = [\n\t'SU',\n\t'MO',\n\t'TU',\n\t'WE',\n\t'TH',\n\t'FR',\n\t'SA',\n]\n\n/**\n * Get all numbers between start and end as strings\n *\n * @param {number} start Lower end of range\n * @param {number} end Upper end of range\n * @return {string[]}\n */\nconst getRangeAsStrings = (start, end) => {\n\treturn Array\n\t\t.apply(null, Array((end - start) + 1))\n\t\t.map((_, n) => n + start)\n\t\t.map((s) => s.toString())\n}\n\nconst SUPPORTED_BY_MONTHDAY_MONTHLY = getRangeAsStrings(1, 31)\n\nconst SUPPORTED_BY_MONTH_YEARLY = getRangeAsStrings(1, 12)\n\n/**\n * Maps a daily calendar-js recurrence-rule-value to an recurrence-rule-object\n *\n * @param {RecurValue} recurrenceRuleValue The calendar-js recurrence rule value\n * @return {object}\n */\nconst mapDailyRuleValueToRecurrenceRuleObject = (recurrenceRuleValue) => {\n\t/**\n\t * We only support DAILY rules without any by-parts in the editor.\n\t * If the recurrence-rule contains any by-parts, mark it as unsupported.\n\t */\n\tconst isUnsupported = containsRecurrenceComponent(recurrenceRuleValue, FORBIDDEN_BY_PARTS_DAILY)\n\n\treturn getDefaultRecurrenceRuleObjectForRecurrenceValue(recurrenceRuleValue, {\n\t\tisUnsupported,\n\t})\n}\n\n/**\n * Maps a weekly calendar-js recurrence-rule-value to an recurrence-rule-object\n *\n * @param {RecurValue} recurrenceRuleValue The calendar-js recurrence rule value\n * @param {DateTimeValue} baseDate The base-date used to fill unset values\n * @return {object}\n */\nconst mapWeeklyRuleValueToRecurrenceRuleObject = (recurrenceRuleValue, baseDate) => {\n\t/**\n\t * For WEEKLY recurrences, our editor only allows BYDAY\n\t *\n\t * As defined in RFC5545 3.3.10. Recurrence Rule:\n\t * > Each BYDAY value can also be preceded by a positive (+n) or\n\t * > negative (-n) integer.  If present, this indicates the nth\n\t * > occurrence of a specific day within the MONTHLY or YEARLY \"RRULE\".\n\t *\n\t * RFC 5545 specifies other components, which can be used along WEEKLY.\n\t * Among them are BYMONTH and BYSETPOS. We don't support those.\n\t */\n\tconst containsUnsupportedByParts = containsRecurrenceComponent(recurrenceRuleValue, FORBIDDEN_BY_PARTS_WEEKLY)\n\tconst containsInvalidByDayPart = recurrenceRuleValue.getComponent('BYDAY')\n\t\t.some((weekday) => !SUPPORTED_BY_DAY_WEEKLY.includes(weekday))\n\n\tconst isUnsupported = containsUnsupportedByParts || containsInvalidByDayPart\n\n\tconst byDay = recurrenceRuleValue.getComponent('BYDAY')\n\t\t.filter((weekday) => SUPPORTED_BY_DAY_WEEKLY.includes(weekday))\n\n\t// If the BYDAY is empty, add the day that the event occurs in\n\t// E.g. if the event is on a Wednesday, automatically set BYDAY:WE\n\tif (byDay.length === 0) {\n\t\tbyDay.push(getWeekDayFromDate(baseDate.jsDate))\n\t}\n\n\treturn getDefaultRecurrenceRuleObjectForRecurrenceValue(recurrenceRuleValue, {\n\t\tbyDay,\n\t\tisUnsupported,\n\t})\n}\n\n/**\n * Maps a monthly calendar-js recurrence-rule-value to an recurrence-rule-object\n *\n * @param {RecurValue} recurrenceRuleValue The calendar-js recurrence rule value\n * @param {DateTimeValue} baseDate The base-date used to fill unset values\n * @return {object}\n */\nconst mapMonthlyRuleValueToRecurrenceRuleObject = (recurrenceRuleValue, baseDate) => {\n\t/**\n\t * We only supports BYMONTHDAY, BYDAY, BYSETPOS in order to expand the monthly rule.\n\t * It supports either BYMONTHDAY or the combination of BYDAY and BYSETPOS. They have to be used exclusively\n\t * and cannot be combined.\n\t *\n\t * We do not support other BY-parts like BYMONTH\n\t *\n\t * For monthly recurrence-rules, BYDAY components are allowed to be preceded by positive or negative integers.\n\t * The Nextcloud-editor supports at most one BYDAY component with an integer.\n\t * If it's presented with such a BYDAY component, it will internally be converted to BYDAY without integer and BYSETPOS.\n\t * e.g.\n\t * BYDAY=3WE => BYDAY=WE,BYSETPOS=3\n\t *\n\t * BYSETPOS is limited to -2, -1, 1, 2, 3, 4, 5\n\t * Other values are not supported\n\t *\n\t * BYDAY is limited to \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\",\n\t * \"MO,TU,WE,TH,FR,SA,SU\", \"MO,TU,WE,TH,FR\", \"SA,SU\"\n\t *\n\t * BYMONTHDAY is limited to \"1\", \"2\", ..., \"31\"\n\t */\n\tlet isUnsupported = containsRecurrenceComponent(recurrenceRuleValue, FORBIDDEN_BY_PARTS_MONTHLY)\n\n\tlet byDay = []\n\tlet bySetPosition = null\n\tlet byMonthDay = []\n\n\t// This handles the first case, where we have a BYMONTHDAY rule\n\tif (containsRecurrenceComponent(recurrenceRuleValue, ['BYMONTHDAY'])) {\n\t\t// verify there is no BYDAY or BYSETPOS at the same time\n\t\tif (containsRecurrenceComponent(recurrenceRuleValue, ['BYDAY', 'BYSETPOS'])) {\n\t\t\tisUnsupported = true\n\t\t}\n\n\t\tconst containsInvalidByMonthDay = recurrenceRuleValue.getComponent('BYMONTHDAY')\n\t\t\t.some((monthDay) => !SUPPORTED_BY_MONTHDAY_MONTHLY.includes(monthDay.toString()))\n\t\tisUnsupported = isUnsupported || containsInvalidByMonthDay\n\n\t\tbyMonthDay = recurrenceRuleValue.getComponent('BYMONTHDAY')\n\t\t\t.filter((monthDay) => SUPPORTED_BY_MONTHDAY_MONTHLY.includes(monthDay.toString()))\n\t\t\t.map((monthDay) => monthDay.toString())\n\n\t\t// This handles cases where we have both BYDAY and BYSETPOS\n\t} else if (containsRecurrenceComponent(recurrenceRuleValue, ['BYDAY']) && containsRecurrenceComponent(recurrenceRuleValue, ['BYSETPOS'])) {\n\n\t\tif (isAllowedByDay(recurrenceRuleValue.getComponent('BYDAY'))) {\n\t\t\tbyDay = recurrenceRuleValue.getComponent('BYDAY')\n\t\t} else {\n\t\t\tbyDay = ['MO', 'TU', 'WE', 'TH', 'FR', 'SA', 'SU']\n\t\t\tisUnsupported = true\n\t\t}\n\n\t\tconst setPositionArray = recurrenceRuleValue.getComponent('BYSETPOS')\n\t\tif (setPositionArray.length === 1 && isAllowedBySetPos(setPositionArray[0])) {\n\t\t\tbySetPosition = setPositionArray[0]\n\t\t} else {\n\t\t\tbySetPosition = 1\n\t\t\tisUnsupported = true\n\t\t}\n\n\t\t// This handles cases where we only have a BYDAY\n\t} else if (containsRecurrenceComponent(recurrenceRuleValue, ['BYDAY'])) {\n\n\t\tconst byDayArray = recurrenceRuleValue.getComponent('BYDAY')\n\n\t\tif (byDayArray.length > 1) {\n\t\t\tbyMonthDay.push(baseDate.day.toString())\n\t\t\tisUnsupported = true\n\t\t} else {\n\t\t\tconst firstElement = byDayArray[0]\n\n\t\t\tconst match = /^(-?\\d)([A-Z]{2})$/.exec(firstElement)\n\t\t\tif (match) {\n\t\t\t\tconst matchedBySetPosition = match[1]\n\t\t\t\tconst matchedByDay = match[2]\n\n\t\t\t\tif (isAllowedBySetPos(matchedBySetPosition)) {\n\t\t\t\t\tbyDay = [matchedByDay]\n\t\t\t\t\tbySetPosition = parseInt(matchedBySetPosition, 10)\n\t\t\t\t} else {\n\t\t\t\t\tbyDay = [matchedByDay]\n\t\t\t\t\tbySetPosition = 1\n\t\t\t\t\tisUnsupported = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbyMonthDay.push(baseDate.day.toString())\n\t\t\t\tisUnsupported = true\n\t\t\t}\n\t\t}\n\n\t\t// This is a fallback where we just default BYMONTHDAY to the start date of the event\n\t} else {\n\t\tbyMonthDay.push(baseDate.day.toString())\n\t}\n\n\treturn getDefaultRecurrenceRuleObjectForRecurrenceValue(recurrenceRuleValue, {\n\t\tbyDay,\n\t\tbySetPosition,\n\t\tbyMonthDay,\n\t\tisUnsupported,\n\t})\n}\n\n/**\n * Maps a yearly calendar-js recurrence-rule-value to an recurrence-rule-object\n *\n * @param {RecurValue} recurrenceRuleValue The calendar-js recurrence rule value\n * @param {DateTimeValue} baseDate The base-date used to fill unset values\n * @return {object}\n */\nconst mapYearlyRuleValueToRecurrenceRuleObject = (recurrenceRuleValue, baseDate) => {\n\t/**\n\t * We only supports BYMONTH, BYDAY, BYSETPOS in order to expand the yearly rule.\n\t * It supports a combination of them.\n\t *\n\t * We do not support other BY-parts.\n\t *\n\t * For yearly recurrence-rules, BYDAY components are allowed to be preceded by positive or negative integers.\n\t * The Nextcloud-editor supports at most one BYDAY component with an integer.\n\t * If it's presented with such a BYDAY component, it will internally be converted to BYDAY without integer and BYSETPOS.\n\t * e.g.\n\t * BYDAY=3WE => BYDAY=WE,BYSETPOS=3\n\t *\n\t * BYSETPOS is limited to -2, -1, 1, 2, 3, 4, 5\n\t * Other values are not supported\n\t *\n\t * BYDAY is limited to \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\",\n\t * \"MO,TU,WE,TH,FR,SA,SU\", \"MO,TU,WE,TH,FR\", \"SA,SU\"\n\t */\n\tlet isUnsupported = containsRecurrenceComponent(recurrenceRuleValue, FORBIDDEN_BY_PARTS_YEARLY)\n\n\tlet byDay = []\n\tlet bySetPosition = null\n\tlet byMonth = []\n\n\tif (containsRecurrenceComponent(recurrenceRuleValue, ['BYMONTH'])) {\n\t\tconst containsInvalidByMonthDay = recurrenceRuleValue.getComponent('BYMONTH')\n\t\t\t.some((month) => !SUPPORTED_BY_MONTH_YEARLY.includes(month.toString()))\n\t\tisUnsupported = isUnsupported || containsInvalidByMonthDay\n\n\t\tbyMonth = recurrenceRuleValue.getComponent('BYMONTH')\n\t\t\t.filter((monthDay) => SUPPORTED_BY_MONTH_YEARLY.includes(monthDay.toString()))\n\t\t\t.map((month) => month.toString())\n\t} else {\n\t\tbyMonth.push(baseDate.month.toString())\n\t}\n\n\tif (containsRecurrenceComponent(recurrenceRuleValue, ['BYDAY']) && containsRecurrenceComponent(recurrenceRuleValue, ['BYSETPOS'])) {\n\n\t\tif (isAllowedByDay(recurrenceRuleValue.getComponent('BYDAY'))) {\n\t\t\tbyDay = recurrenceRuleValue.getComponent('BYDAY')\n\t\t} else {\n\t\t\tbyDay = ['MO', 'TU', 'WE', 'TH', 'FR', 'SA', 'SU']\n\t\t\tisUnsupported = true\n\t\t}\n\n\t\tconst setPositionArray = recurrenceRuleValue.getComponent('BYSETPOS')\n\t\tif (setPositionArray.length === 1 && isAllowedBySetPos(setPositionArray[0])) {\n\t\t\tbySetPosition = setPositionArray[0]\n\t\t} else {\n\t\t\tbySetPosition = 1\n\t\t\tisUnsupported = true\n\t\t}\n\n\t} else if (containsRecurrenceComponent(recurrenceRuleValue, ['BYDAY'])) {\n\n\t\tconst byDayArray = recurrenceRuleValue.getComponent('BYDAY')\n\t\tif (byDayArray.length > 1) {\n\t\t\tisUnsupported = true\n\t\t} else {\n\t\t\tconst firstElement = byDayArray[0]\n\n\t\t\tconst match = /^(-?\\d)([A-Z]{2})$/.exec(firstElement)\n\t\t\tif (match) {\n\t\t\t\tconst matchedBySetPosition = match[1]\n\t\t\t\tconst matchedByDay = match[2]\n\n\t\t\t\tif (isAllowedBySetPos(matchedBySetPosition)) {\n\t\t\t\t\tbyDay = [matchedByDay]\n\t\t\t\t\tbySetPosition = parseInt(matchedBySetPosition, 10)\n\t\t\t\t} else {\n\t\t\t\t\tbyDay = [matchedByDay]\n\t\t\t\t\tbySetPosition = 1\n\t\t\t\t\tisUnsupported = true\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tisUnsupported = true\n\t\t\t}\n\t\t}\n\t}\n\n\treturn getDefaultRecurrenceRuleObjectForRecurrenceValue(recurrenceRuleValue, {\n\t\tbyDay,\n\t\tbySetPosition,\n\t\tbyMonth,\n\t\tisUnsupported,\n\t})\n}\n\n/**\n * Checks if the given parameter is a supported BYDAY value\n *\n * @param {string[]} byDay The byDay component to check\n * @return {boolean}\n */\nconst isAllowedByDay = (byDay) => {\n\treturn [\n\t\t'MO',\n\t\t'TU',\n\t\t'WE',\n\t\t'TH',\n\t\t'FR',\n\t\t'SA',\n\t\t'SU',\n\t\t'FR,MO,SA,SU,TH,TU,WE',\n\t\t'FR,MO,TH,TU,WE',\n\t\t'SA,SU',\n\t].includes(byDay.slice().sort().join(','))\n}\n\n/**\n * Checks if the given parameter is a supported BYSETPOS value\n *\n * @param {string} bySetPos The bySetPos component to check\n * @return {boolean}\n */\nconst isAllowedBySetPos = (bySetPos) => {\n\treturn [\n\t\t'-2',\n\t\t'-1',\n\t\t'1',\n\t\t'2',\n\t\t'3',\n\t\t'4',\n\t\t'5',\n\t].includes(bySetPos.toString())\n}\n\n/**\n * Checks if the recurrence-rule contains any of the given components\n *\n * @param {RecurValue} recurrenceRule The recurrence-rule value to check for the given components\n * @param {string[]} components List of components to check for\n * @return {boolean}\n */\nconst containsRecurrenceComponent = (recurrenceRule, components) => {\n\tfor (const component of components) {\n\t\tconst componentValue = recurrenceRule.getComponent(component)\n\t\tif (componentValue.length > 0) {\n\t\t\treturn true\n\t\t}\n\t}\n\n\treturn false\n}\n\n/**\n * Returns a full recurrence-rule-object with default values derived from recurrenceRuleValue\n * and additional props\n *\n * @param {RecurValue} recurrenceRuleValue The recurrence-rule value to get default values from\n * @param {object} props The properties to provide on top of default one\n * @return {object}\n */\nconst getDefaultRecurrenceRuleObjectForRecurrenceValue = (recurrenceRuleValue, props) => {\n\tconst isUnsupported = recurrenceRuleValue.count !== null && recurrenceRuleValue.until !== null\n\tlet isUnsupportedProps = {}\n\n\tif (isUnsupported) {\n\t\tisUnsupportedProps = {\n\t\t\tisUnsupported,\n\t\t}\n\t}\n\n\treturn getDefaultRecurrenceRuleObject(Object.assign({}, {\n\t\trecurrenceRuleValue,\n\t\tfrequency: recurrenceRuleValue.frequency,\n\t\tinterval: parseInt(recurrenceRuleValue.interval, 10) || 1,\n\t\tcount: recurrenceRuleValue.count,\n\t\tuntil: recurrenceRuleValue.until\n\t\t\t? getDateFromDateTimeValue(recurrenceRuleValue.until)\n\t\t\t: null,\n\t}, props, isUnsupportedProps))\n}\n\nexport {\n\tgetDefaultRecurrenceRuleObject,\n\tmapRecurrenceRuleValueToRecurrenceRuleObject,\n}\n","/**\n * @copyright 2022 Mikhail Sazanov <m@sazanof.ru>\n *\n * @author 2022 Mikhail Sazanov <m@sazanof.ru>\n * @author Richard Steinmetz <richard@steinmetz.cloud>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport axios from '@nextcloud/axios'\nimport { generateOcsUrl, generateRemoteUrl } from '@nextcloud/router'\nimport { showError, showSuccess } from '@nextcloud/dialogs'\nimport { translate as t } from '@nextcloud/l10n'\nimport { parseXML } from 'webdav'\n\n/**\n * Makes a share link for a given file or directory.\n *\n * @param {string} path The file path from the user's root directory. e.g. `/myfile.txt`\n * @return {string} url share link\n */\nconst shareFile = async function(path) {\n\ttry {\n\t\tconst res = await axios.post(generateOcsUrl('apps/files_sharing/api/v1/', 2) + 'shares', {\n\t\t\tshareType: OC.Share.SHARE_TYPE_LINK,\n\t\t\tpath,\n\t\t})\n\t\treturn res.data.ocs.data\n\t} catch (error) {\n\t\tif (error?.response?.data?.ocs?.meta?.message) {\n\t\t\tconsole.error(`Error while sharing file: ${error.response.data.ocs.meta.message}`)\n\t\t\tshowError(error.response.data.ocs.meta.message)\n\t\t\tthrow error\n\t\t} else {\n\t\t\tconsole.error('Error while sharing file: Unknown error')\n\t\t\tshowError(t('calendar', 'Error while sharing file'))\n\t\t\tthrow error\n\t\t}\n\t}\n}\n\n/**\n * Share file with a user with permissions\n *\n * @param path\n * @param sharedWith\n * @param permissions\n * @return {Promise<[{path: string, permissions, scope: string, name: string, backend: string, type: string},{path: string, permissions: *, scope: string, name: string, backend: string, type: string}]>}\n */\nconst shareFileWith = async function(path, sharedWith, permissions = 17) {\n\ttry {\n\t\tconst url = generateOcsUrl('apps/files_sharing/api/v1/', 2)\n\t\tconst res = await axios.post(`${url}shares`, {\n\t\t\tpassword: null,\n\t\t\tshareType: OC.Share.SHARE_TYPE_USER, // WITH USERS,\n\t\t\tpermissions, // 14 - edit, 17 - view\n\t\t\tpath,\n\t\t\tshareWith: sharedWith,\n\t\t})\n\t\treturn res.data.ocs.data\n\t} catch (error) {\n\t\tif (error?.response?.data?.ocs?.meta?.message) {\n\t\t\tconsole.error(`Error while sharing file with user: ${error.response.data.ocs.meta.message}`)\n\t\t\tshowError(error.response.data.ocs.meta.message)\n\t\t\tthrow error\n\t\t} else {\n\t\t\tconsole.error('Error while sharing file with user: Unknown error')\n\t\t\tshowError(t('calendar', 'Error while sharing file with user'))\n\t\t\tthrow error\n\t\t}\n\t}\n}\n\nconst createFolder = async function(folderName, userId) {\n\tconst url = generateRemoteUrl(`dav/files/${userId}/${folderName}`)\n\ttry {\n\t\tawait axios({\n\t\t\tmethod: 'MKCOL',\n\t\t\turl,\n\t\t})\n\t} catch (e) {\n\t\tif (e?.response?.status !== 405) {\n\t\t\tshowError(t('calendar', 'Error creating a folder {folder}', {\n\t\t\t\tfolder: folderName,\n\t\t\t}))\n\t\t\t// Maybe the actual upload succeeds -> keep going\n\t\t\treturn folderName\n\t\t}\n\n\t\t// Folder already exists\n\t\tif (folderName !== '/') {\n\t\t\tfolderName = await findFirstOwnedFolder(folderName, userId)\n\t\t}\n\t}\n\n\treturn folderName\n}\n\nconst findFirstOwnedFolder = async function(path, userId) {\n\tconst infoXml = await getFileInfo(path, userId)\n\tconst info = await parseXML(infoXml)\n\tconst mountType = info?.multistatus?.response[0]?.propstat?.prop?.['mount-type']\n\tif (mountType !== 'shared') {\n\t\treturn path\n\t}\n\n\tconst hierarchy = path.split('/')\n\thierarchy.pop()\n\tif (hierarchy.length === 1) {\n\t\treturn '/'\n\t}\n\n\treturn findFirstOwnedFolder(hierarchy.join('/'), userId)\n}\n\nconst uploadLocalAttachment = async function(folder, files, dav, componentAttachments) {\n\tconst attachments = []\n\tconst promises = []\n\n\tfiles.forEach(file => {\n\t\t// temp fix, until we decide where to save the attachments\n\t\tif (componentAttachments.map(attachment => attachment.fileName.split('/').pop()).indexOf(file.name) !== -1) {\n\t\t\t// TODO may be show user confirmation dialog to create a file named Existing_File_(2) ?\n\t\t\tshowError(t('calendar', 'Attachment {fileName} already exists!', {\n\t\t\t\tfileName: file.name,\n\t\t\t}))\n\t\t} else {\n\t\t\tconst url = generateRemoteUrl(`dav/files/${dav.userId}/${folder}/${file.name}`)\n\t\t\tconst res = axios.put(url, file).then(resp => {\n\t\t\t\tconst data = {\n\t\t\t\t\tfileName: file.name,\n\t\t\t\t\tformatType: file.type,\n\t\t\t\t\turi: url,\n\t\t\t\t\tvalue: url,\n\t\t\t\t\tpath: `/${file.name}`,\n\t\t\t\t}\n\t\t\t\tif (resp.status === 204 || resp.status === 201) {\n\t\t\t\t\tshowSuccess(t('calendar', 'Attachment {fileName} added!', {\n\t\t\t\t\t\tfileName: file.name,\n\t\t\t\t\t}))\n\t\t\t\t\tattachments.push(data)\n\t\t\t\t}\n\t\t\t}).catch(() => {\n\t\t\t\tshowError(t('calendar', 'An error occurred during uploading file {fileName}', {\n\t\t\t\t\tfileName: file.name,\n\t\t\t\t}))\n\t\t\t})\n\t\t\tpromises.push(res)\n\t\t}\n\n\t})\n\tawait Promise.all(promises)\n\treturn attachments\n\n}\n\n// TODO is shared or not @share-types@\nconst getFileInfo = async function(path, userId) {\n\tconst url = generateRemoteUrl(`dav/files/${userId}/${path}`)\n\tconst res = await axios({\n\t\tmethod: 'PROPFIND',\n\t\turl,\n\t\tdata: `<?xml version=\"1.0\"?>\n\t\t\t<d:propfind\n\t\t\txmlns:d=\"DAV:\"\n\t\t\txmlns:oc=\"http://owncloud.org/ns\"\n\t\t\txmlns:nc=\"http://nextcloud.org/ns\">\n\t\t\t\t<d:prop>\n\t\t\t\t\t<d:getcontenttype />\n\t\t\t\t\t<oc:size />\n\t\t\t\t\t<oc:fileid />\n\t\t\t\t\t<oc:share-types />\n\t\t\t\t\t<nc:has-preview />\n\t\t\t\t\t<nc:mount-type />\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>`,\n\t}).catch(() => {\n\t\tshowError(t('calendar', 'An error occurred during getting file information'))\n\t})\n\treturn res.data\n}\n\nexport {\n\tgetFileInfo,\n\tshareFile,\n\tshareFileWith,\n\tuploadLocalAttachment,\n\tcreateFolder,\n}\n","/**\n * @copyright Copyright (c) 2020 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport HttpClient from '@nextcloud/axios'\nimport { getLinkToConfig } from '../utils/settings.js'\n\n/**\n *\n * @param {string} key Config-key to set\n * @param {string | number | boolean} value Config-value to set\n * @return {Promise<void>}\n */\nconst setConfig = async (key, value) => {\n\tawait HttpClient.post(getLinkToConfig(key), { value })\n}\n\nexport {\n\tsetConfig,\n}\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n * @copyright Copyright (c) 2023 Jonas Heinrich\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n * @author Jonas Heinrich <heinrich@synyx.net>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport Vue from 'vue'\nimport getTimezoneManager from '../services/timezoneDataProviderService.js'\nimport {\n\tgetDateFromDateTimeValue,\n} from '../utils/date.js'\nimport { AttendeeProperty, Property, DateTimeValue, DurationValue, RecurValue, AttachmentProperty, Parameter } from '@nextcloud/calendar-js'\nimport { getBySetPositionAndBySetFromDate, getWeekDayFromDate } from '../utils/recurrence.js'\nimport {\n\tcopyCalendarObjectInstanceIntoEventComponent,\n\tgetDefaultEventObject,\n\tmapEventComponentToEventObject,\n} from '../models/event.js'\nimport {\n\tgetAmountAndUnitForTimedEvents,\n\tgetAmountHoursMinutesAndUnitForAllDayEvents,\n\tgetTotalSecondsFromAmountAndUnitForTimedEvents,\n\tgetTotalSecondsFromAmountHourMinutesAndUnitForAllDayEvents,\n\tupdateAlarms,\n} from '../utils/alarms.js'\nimport {\n\tgetClosestCSS3ColorNameForHex,\n\tgetHexForColorName,\n} from '../utils/color.js'\nimport { mapAlarmComponentToAlarmObject } from '../models/alarm.js'\nimport { getObjectAtRecurrenceId } from '../utils/calendarObject.js'\nimport logger from '../utils/logger.js'\nimport settings from './settings.js'\nimport { getRFCProperties } from '../models/rfcProps.js'\nimport { generateUrl } from '@nextcloud/router'\nimport { updateTalkParticipants } from '../services/talkService.js'\n\nconst state = {\n\tisNew: null,\n\tcalendarObject: null,\n\tcalendarObjectInstance: null,\n\texistingEvent: {\n\t\tobjectId: null,\n\t\trecurrenceId: null,\n\t},\n}\n\nconst mutations = {\n\n\t/**\n\t * Set a calendar-object-instance that will be opened in the editor (existing event)\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObject The calendar-object currently being edited\n\t * @param {object} data.calendarObjectInstance The calendar-object-instance currently being edited\n\t * @param {string} data.objectId The objectId of the calendar-object\n\t * @param {number} data.recurrenceId The recurrence-id of the calendar-object-instance\n\t */\n\tsetCalendarObjectInstanceForExistingEvent(state, { calendarObject, calendarObjectInstance, objectId, recurrenceId }) {\n\t\tstate.isNew = false\n\t\tstate.calendarObject = calendarObject\n\t\tstate.calendarObjectInstance = calendarObjectInstance\n\t\tstate.existingEvent.objectId = objectId\n\t\tstate.existingEvent.recurrenceId = recurrenceId\n\t},\n\n\t/**\n\t * Set a calendar-object-instance that will be opened in the editor (new event)\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObject The calendar-object currently being created\n\t * @param {object} data.calendarObjectInstance The calendar-object-instance currently being crated\n\t */\n\tsetCalendarObjectInstanceForNewEvent(state, { calendarObject, calendarObjectInstance }) {\n\t\tstate.isNew = true\n\t\tstate.calendarObject = calendarObject\n\t\tstate.calendarObjectInstance = calendarObjectInstance\n\t\tstate.existingEvent.objectId = null\n\t\tstate.existingEvent.recurrenceId = null\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t */\n\tresetCalendarObjectInstanceObjectIdAndRecurrenceId(state) {\n\t\tstate.isNew = false\n\t\tstate.calendarObject = null\n\t\tstate.calendarObjectInstance = null\n\t\tstate.existingEvent.objectId = null\n\t\tstate.existingEvent.recurrenceId = null\n\t},\n\n\t/**\n\t * Change the title of the event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.title The new Title\n\t */\n\tchangeTitle(state, { calendarObjectInstance, title }) {\n\t\tcalendarObjectInstance.eventComponent.title = title\n\t\tcalendarObjectInstance.title = title\n\t},\n\n\t/**\n\t * Change the event's start\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {Date} data.startDate New start date to set\n\t */\n\tchangeStartDate(state, { calendarObjectInstance, startDate }) {\n\t\tcalendarObjectInstance.eventComponent.startDate.year = startDate.getFullYear()\n\t\tcalendarObjectInstance.eventComponent.startDate.month = startDate.getMonth() + 1\n\t\tcalendarObjectInstance.eventComponent.startDate.day = startDate.getDate()\n\t\tcalendarObjectInstance.eventComponent.startDate.hour = startDate.getHours()\n\t\tcalendarObjectInstance.eventComponent.startDate.minute = startDate.getMinutes()\n\t\tcalendarObjectInstance.eventComponent.startDate.second = 0\n\n\t\tconst isAllDay = calendarObjectInstance.eventComponent.isAllDay()\n\t\tconst endDateObj = calendarObjectInstance.eventComponent.endDate.clone()\n\t\tconst startDateObj = calendarObjectInstance.eventComponent.startDate.clone()\n\n\t\tif (isAllDay) {\n\t\t\tendDateObj.addDuration(DurationValue.fromSeconds(-1 * 60 * 60 * 24))\n\n\t\t\tif (endDateObj.compare(startDateObj) === -1) {\n\t\t\t\tconst timezone = getTimezoneManager().getTimezoneForId(endDateObj.timezoneId)\n\t\t\t\tcalendarObjectInstance.eventComponent.endDate\n\t\t\t\t\t= calendarObjectInstance.eventComponent.startDate.getInTimezone(timezone)\n\t\t\t\tcalendarObjectInstance.endDate = getDateFromDateTimeValue(calendarObjectInstance.eventComponent.endDate)\n\t\t\t\tcalendarObjectInstance.eventComponent.endDate.addDuration(DurationValue.fromSeconds(60 * 60 * 24))\n\t\t\t}\n\t\t} else {\n\t\t\tif (endDateObj.compare(startDateObj) === -1) {\n\t\t\t\tconst timezone = getTimezoneManager().getTimezoneForId(endDateObj.timezoneId)\n\t\t\t\tcalendarObjectInstance.eventComponent.endDate\n\t\t\t\t\t= calendarObjectInstance.eventComponent.startDate.getInTimezone(timezone)\n\t\t\t\tcalendarObjectInstance.endDate = getDateFromDateTimeValue(calendarObjectInstance.eventComponent.endDate)\n\t\t\t}\n\t\t}\n\n\t\tcalendarObjectInstance.startDate = startDate\n\t},\n\n\t/**\n\t * Change the timezone of the event's start\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.startTimezone New timezone to set for start\n\t */\n\tchangeStartTimezone(state, { calendarObjectInstance, startTimezone }) {\n\t\tconst timezone = getTimezoneManager().getTimezoneForId(startTimezone)\n\t\tcalendarObjectInstance.eventComponent.startDate.replaceTimezone(timezone)\n\t\tcalendarObjectInstance.startTimezoneId = startTimezone\n\n\t\t// Either both are floating or both have a timezone, but it can't be mixed\n\t\tif (startTimezone === 'floating' || calendarObjectInstance.endTimezoneId === 'floating') {\n\t\t\tcalendarObjectInstance.eventComponent.endDate.replaceTimezone(timezone)\n\t\t\tcalendarObjectInstance.endTimezoneId = startTimezone\n\t\t}\n\t},\n\n\t/**\n\t * Change the event's end\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {Date} data.endDate New end date to set\n\t */\n\tchangeEndDate(state, { calendarObjectInstance, endDate }) {\n\t\t// If the event is using DURATION, endDate is dynamically generated.\n\t\t// In order to alter it, we need to explicitly set DTEND\n\t\tconst endDateObject = calendarObjectInstance.eventComponent.endDate\n\t\tcalendarObjectInstance.eventComponent.endDate = endDateObject\n\n\t\tcalendarObjectInstance.eventComponent.endDate.year = endDate.getFullYear()\n\t\tcalendarObjectInstance.eventComponent.endDate.month = endDate.getMonth() + 1\n\t\tcalendarObjectInstance.eventComponent.endDate.day = endDate.getDate()\n\t\tcalendarObjectInstance.eventComponent.endDate.hour = endDate.getHours()\n\t\tcalendarObjectInstance.eventComponent.endDate.minute = endDate.getMinutes()\n\t\tcalendarObjectInstance.eventComponent.endDate.second = 0\n\n\t\tconst isAllDay = calendarObjectInstance.eventComponent.isAllDay()\n\t\tconst endDateObj = calendarObjectInstance.eventComponent.endDate.clone()\n\t\tconst startDateObj = calendarObjectInstance.eventComponent.startDate.clone()\n\n\t\tif (isAllDay) {\n\t\t\tif (endDateObj.compare(startDateObj) === -1) {\n\t\t\t\tconst timezone = getTimezoneManager().getTimezoneForId(startDateObj.timezoneId)\n\t\t\t\tcalendarObjectInstance.eventComponent.startDate\n\t\t\t\t\t= calendarObjectInstance.eventComponent.endDate.getInTimezone(timezone)\n\t\t\t\tcalendarObjectInstance.startDate = getDateFromDateTimeValue(calendarObjectInstance.eventComponent.startDate)\n\t\t\t}\n\n\t\t\t// endDate is inclusive, but DTEND needs to be exclusive, so always add one day\n\t\t\tcalendarObjectInstance.eventComponent.endDate.addDuration(DurationValue.fromSeconds(60 * 60 * 24))\n\t\t} else {\n\t\t\t// Is end before start?\n\t\t\tif (endDateObj.compare(startDateObj) === -1) {\n\t\t\t\t// Is end more than one day before start?\n\t\t\t\tendDateObj.addDuration(DurationValue.fromSeconds(60 * 60 * 24))\n\t\t\t\tif (endDateObj.compare(startDateObj) === -1) {\n\t\t\t\t\tconst timezone = getTimezoneManager().getTimezoneForId(startDateObj.timezoneId)\n\t\t\t\t\tcalendarObjectInstance.eventComponent.startDate\n\t\t\t\t\t\t= calendarObjectInstance.eventComponent.endDate.getInTimezone(timezone)\n\t\t\t\t\tcalendarObjectInstance.startDate = getDateFromDateTimeValue(calendarObjectInstance.eventComponent.startDate)\n\t\t\t\t} else {\n\t\t\t\t\t// add one day to endDate if the endDate is before the startDate which allows to easily create events that reach over or to 0:00\n\t\t\t\t\tcalendarObjectInstance.eventComponent.endDate.addDuration(DurationValue.fromSeconds(60 * 60 * 24))\n\t\t\t\t\tendDate = new Date(endDate.getTime() + 24 * 60 * 60 * 1000)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcalendarObjectInstance.endDate = endDate\n\t},\n\n\t/**\n\t * Change the timezone of the event's end\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.endTimezone New timezone to set for end\n\t */\n\tchangeEndTimezone(state, { calendarObjectInstance, endTimezone }) {\n\t\tconst timezone = getTimezoneManager().getTimezoneForId(endTimezone)\n\t\tcalendarObjectInstance.eventComponent.endDate.replaceTimezone(timezone)\n\t\tcalendarObjectInstance.endTimezoneId = endTimezone\n\n\t\t// Either both are floating or both have a timezone, but it can't be mixed\n\t\tif (endTimezone === 'floating' || calendarObjectInstance.startTimezoneId === 'floating') {\n\t\t\tcalendarObjectInstance.eventComponent.startDate.replaceTimezone(timezone)\n\t\t\tcalendarObjectInstance.startTimezoneId = endTimezone\n\t\t}\n\t},\n\n\t/**\n\t * Switch from a timed event to allday or vice versa\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t */\n\ttoggleAllDay(state, { calendarObjectInstance }) {\n\t\tif (!calendarObjectInstance.eventComponent.canModifyAllDay()) {\n\t\t\treturn\n\t\t}\n\n\t\tconst isAllDay = calendarObjectInstance.eventComponent.isAllDay()\n\t\tcalendarObjectInstance.eventComponent.startDate.isDate = !isAllDay\n\t\tcalendarObjectInstance.eventComponent.endDate.isDate = !isAllDay\n\t\tcalendarObjectInstance.isAllDay = calendarObjectInstance.eventComponent.isAllDay()\n\n\t\t// isAllDay = old value\n\t\tif (isAllDay) {\n\t\t\tcalendarObjectInstance.eventComponent.endDate.addDuration(DurationValue.fromSeconds(-1 * 60 * 60 * 24))\n\t\t} else {\n\t\t\tcalendarObjectInstance.eventComponent.endDate.addDuration(DurationValue.fromSeconds(60 * 60 * 24))\n\t\t}\n\t},\n\n\t/**\n\t * Changes the time of a timed event to the default values\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t */\n\tchangeTimeToDefaultForTimedEvents(state, { calendarObjectInstance }) {\n\t\tconst startDate = calendarObjectInstance.eventComponent.startDate\n\t\tconst endDate = calendarObjectInstance.eventComponent.endDate\n\t\tif (startDate.hour === 0 && startDate.minute === 0 && endDate.hour === 0 && endDate.minute === 0) {\n\t\t\tstartDate.hour = 10\n\t\t\tendDate.hour = 11\n\n\t\t\tcalendarObjectInstance.startDate = getDateFromDateTimeValue(startDate)\n\t\t\tcalendarObjectInstance.endDate = getDateFromDateTimeValue(endDate)\n\t\t}\n\t},\n\n\t/**\n\t * Change the location of an event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.location New location to set\n\t */\n\tchangeLocation(state, { calendarObjectInstance, location }) {\n\t\t// Special case: delete Apple-specific location property to avoid inconsistencies\n\t\tcalendarObjectInstance.eventComponent.deleteAllProperties('X-APPLE-STRUCTURED-LOCATION')\n\n\t\tcalendarObjectInstance.eventComponent.location = location\n\t\tcalendarObjectInstance.location = location\n\t},\n\n\t/**\n\t * Change the description of an event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.description New description to set\n\t */\n\tchangeDescription(state, { calendarObjectInstance, description }) {\n\t\t// To avoid inconsistencies (bug #3863), remove all parameters (e.g., ALTREP) upon modification\n\t\tconst descriptionProperty = calendarObjectInstance.eventComponent.getFirstProperty('Description')\n\t\tif (descriptionProperty) {\n\t\t\tfor (const parameter of descriptionProperty.getParametersIterator()) {\n\t\t\t\tdescriptionProperty.deleteParameter(parameter.name)\n\t\t\t}\n\t\t}\n\n\t\t// Delete custom description properties\n\t\tcalendarObjectInstance.eventComponent.deleteAllProperties('X-ALT-DESC')\n\n\t\tcalendarObjectInstance.eventComponent.description = description\n\t\tcalendarObjectInstance.description = description\n\t},\n\n\t/**\n\t * Change the access class of an event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.accessClass New access class to set\n\t */\n\tchangeAccessClass(state, { calendarObjectInstance, accessClass }) {\n\t\tcalendarObjectInstance.eventComponent.accessClass = accessClass\n\t\tcalendarObjectInstance.accessClass = accessClass\n\t},\n\n\t/**\n\t * Change the status of an event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.status New status to set\n\t */\n\tchangeStatus(state, { calendarObjectInstance, status }) {\n\t\tcalendarObjectInstance.eventComponent.status = status\n\t\tcalendarObjectInstance.status = status\n\t},\n\n\t/**\n\t * Change the time-transparency of an event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.timeTransparency New time-transparency to set\n\t */\n\tchangeTimeTransparency(state, { calendarObjectInstance, timeTransparency }) {\n\t\tcalendarObjectInstance.eventComponent.timeTransparency = timeTransparency\n\t\tcalendarObjectInstance.timeTransparency = timeTransparency\n\t},\n\n\t/**\n\t * Change the customized color of an event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string | null} data.customColor New color to set\n\t */\n\tchangeCustomColor(state, { calendarObjectInstance, customColor }) {\n\t\tif (customColor === null) {\n\t\t\tcalendarObjectInstance.eventComponent.deleteAllProperties('COLOR')\n\t\t\tVue.set(calendarObjectInstance, 'customColor', null)\n\t\t\treturn\n\t\t}\n\n\t\tconst cssColorName = getClosestCSS3ColorNameForHex(customColor)\n\t\tconst hexColorOfCssName = getHexForColorName(cssColorName)\n\n\t\t// Abort if either is undefined\n\t\tif (!cssColorName || !hexColorOfCssName) {\n\t\t\tconsole.error('Setting custom color failed')\n\t\t\tconsole.error('customColor: ', customColor)\n\t\t\tconsole.error('cssColorName: ', cssColorName)\n\t\t\tconsole.error('hexColorOfCssName: ', hexColorOfCssName)\n\t\t\treturn\n\t\t}\n\n\t\tcalendarObjectInstance.eventComponent.color = cssColorName\n\t\tVue.set(calendarObjectInstance, 'customColor', hexColorOfCssName)\n\t},\n\n\t/**\n\t * Adds an attendee to the event and sets the organizer if not present already\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.commonName Displayname of attendee\n\t * @param {string} data.uri Email address of attendee\n\t * @param {string} data.calendarUserType Calendar-user-type of attendee (INDIVIDUAL, GROUP, RESOURCE, ROOM)\n\t * @param {string} data.participationStatus Participation Status of attendee\n\t * @param {string} data.role Role of Attendee\n\t * @param {boolean} data.rsvp Whether or not to request a response from the attendee\n\t * @param {string=} data.language Preferred language of the attendee\n\t * @param {string=} data.timezoneId Preferred timezone of the attendee\n\t * @param {object=} data.organizer Principal of the organizer to be set if not present\n\t * @param data.member\n\t */\n\taddAttendee(state, { calendarObjectInstance, commonName, uri, calendarUserType = null, participationStatus = null, role = null, rsvp = null, language = null, timezoneId = null, organizer = null, member = null }) {\n\t\tconst attendee = AttendeeProperty.fromNameAndEMail(commonName, uri)\n\n\t\tif (calendarUserType !== null) {\n\t\t\tattendee.userType = calendarUserType\n\t\t}\n\t\tif (participationStatus !== null) {\n\t\t\tattendee.participationStatus = participationStatus\n\t\t}\n\t\tif (role !== null) {\n\t\t\tattendee.role = role\n\t\t}\n\t\tif (rsvp !== null) {\n\t\t\tattendee.rsvp = rsvp\n\t\t}\n\t\tif (language !== null) {\n\t\t\tattendee.language = language\n\t\t}\n\t\tif (timezoneId !== null) {\n\t\t\tattendee.updateParameterIfExist('TZID', timezoneId)\n\t\t}\n\t\tif (member !== null) {\n\t\t\tattendee.updateParameterIfExist('MEMBER', member)\n\t\t}\n\n\t\t// TODO - use real addAttendeeFrom method\n\t\tcalendarObjectInstance.eventComponent.addProperty(attendee)\n\t\tcalendarObjectInstance.attendees.push({\n\t\t\tcommonName,\n\t\t\tparticipationStatus,\n\t\t\trole,\n\t\t\trsvp,\n\t\t\turi,\n\t\t\tattendeeProperty: attendee,\n\t\t})\n\n\t\tif (!calendarObjectInstance.organizer && organizer) {\n\t\t\tthis.commit('setOrganizer', {\n\t\t\t\tcalendarObjectInstance,\n\t\t\t\tcommonName: organizer.displayname,\n\t\t\t\temail: organizer.emailAddress,\n\t\t\t})\n\t\t}\n\t},\n\n\t/**\n\t * Removes an attendee from the event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.attendee The attendee object to remove\n\t */\n\tremoveAttendee(state, { calendarObjectInstance, attendee }) {\n\t\tcalendarObjectInstance.eventComponent.removeAttendee(attendee.attendeeProperty)\n\n\t\t// Also remove members if attendee is a group\n\t\tif (attendee.attendeeProperty.userType === 'GROUP') {\n\t\t\tattendee.members.forEach(function(member) {\n\t\t\t\tcalendarObjectInstance.eventComponent.removeAttendee(member.attendeeProperty)\n\t\t\t\tconst index = calendarObjectInstance.attendees.indexOf(member)\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tcalendarObjectInstance.attendees.splice(index, 1)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tconst index = calendarObjectInstance.attendees.indexOf(attendee)\n\t\tif (index !== -1) {\n\t\t\tcalendarObjectInstance.attendees.splice(index, 1)\n\t\t}\n\t},\n\n\t/**\n\t * Changes an attendees' participation status\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.attendee The attendee object\n\t * @param {string} data.participationStatus New Participation Status of attendee\n\t */\n\tchangeAttendeesParticipationStatus(state, { attendee, participationStatus }) {\n\t\tattendee.attendeeProperty.participationStatus = participationStatus\n\t\tattendee.participationStatus = participationStatus\n\t},\n\n\t/**\n\t * Changes an attendees' role\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.attendee The attendee object\n\t * @param {string} data.role New role of attendee\n\t */\n\tchangeAttendeesRole(state, { attendee, role }) {\n\t\tattendee.attendeeProperty.role = role\n\t\tattendee.role = role\n\t},\n\n\t/**\n\t * Changes an attendees' RVSP\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.attendee The attendee object\n\t */\n\ttoggleAttendeeRSVP(state, { attendee }) {\n\t\tconst oldRSVP = attendee.attendeeProperty.rsvp\n\t\tattendee.attendeeProperty.rsvp = !oldRSVP\n\t\tattendee.rsvp = !oldRSVP\n\t},\n\n\t/**\n\t * Set the event's organizer\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string=} data.commonName Displayname of organizer\n\t * @param {string} data.email Email-address of organizer\n\t */\n\tsetOrganizer(state, { calendarObjectInstance, commonName = null, email }) {\n\t\tcalendarObjectInstance.eventComponent.setOrganizerFromNameAndEMail(commonName, email)\n\t\tVue.set(calendarObjectInstance, 'organizer', {})\n\t\tVue.set(calendarObjectInstance.organizer, 'commonName', commonName)\n\t\tVue.set(calendarObjectInstance.organizer, 'uri', email)\n\t\tVue.set(calendarObjectInstance.organizer, 'attendeeProperty', calendarObjectInstance.eventComponent.getFirstProperty('ORGANIZER'))\n\t},\n\n\t/**\n\t * Adds a category to the event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.category Category to add\n\t */\n\taddCategory(state, { calendarObjectInstance, category }) {\n\t\tcalendarObjectInstance.eventComponent.addCategory(category)\n\t\tcalendarObjectInstance.categories.push(category)\n\t},\n\n\t/**\n\t * Removes a category from the event\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.category Category to remove\n\t */\n\tremoveCategory(state, { calendarObjectInstance, category }) {\n\t\tcalendarObjectInstance.eventComponent.removeCategory(category)\n\n\t\tconst index = calendarObjectInstance.categories.indexOf(category)\n\t\tif (index !== -1) {\n\t\t\tcalendarObjectInstance.categories.splice(index, 1)\n\t\t}\n\t},\n\n\t/**\n\t * Change the interval of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.interval The new interval to set\n\t */\n\tchangeRecurrenceInterval(state, { calendarObjectInstance, recurrenceRule, interval }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\trecurrenceRule.recurrenceRuleValue.interval = interval\n\t\t\trecurrenceRule.interval = interval\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the frequency of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.frequency The new frequency to set\n\t */\n\tchangeRecurrenceFrequency(state, { calendarObjectInstance, recurrenceRule, frequency }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\trecurrenceRule.recurrenceRuleValue.frequency = frequency\n\t\t\trecurrenceRule.frequency = frequency\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the count limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.count The new count to set\n\t */\n\tchangeRecurrenceCount(state, { calendarObjectInstance, recurrenceRule, count }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\trecurrenceRule.recurrenceRuleValue.count = count\n\t\t\trecurrenceRule.count = count\n\t\t\trecurrenceRule.until = null\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the until limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {Date} data.until The new until to set\n\t */\n\tchangeRecurrenceUntil(state, { calendarObjectInstance, recurrenceRule, until }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\t// RFC 5545, setion 3.3.10: until must be in UTC if the start time is timezone-aware\n\t\t\tif (calendarObjectInstance.startTimezoneId !== 'floating') {\n\t\t\t\trecurrenceRule.recurrenceRuleValue.until = DateTimeValue.fromJSDate(until, { zone: 'utc' })\n\t\t\t} else {\n\t\t\t\trecurrenceRule.recurrenceRuleValue.until = DateTimeValue.fromJSDate(until)\n\t\t\t}\n\t\t\trecurrenceRule.until = until\n\t\t\trecurrenceRule.count = null\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Changes the recurrence-rule to never end\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tchangeRecurrenceToInfinite(state, { calendarObjectInstance, recurrenceRule }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\trecurrenceRule.recurrenceRuleValue.setToInfinite()\n\t\t\trecurrenceRule.until = null\n\t\t\trecurrenceRule.count = null\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Reset the By-parts of the recurrence rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tresetRecurrenceByParts(state, { calendarObjectInstance, recurrenceRule }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst parts = [\n\t\t\t\t'BYSECOND',\n\t\t\t\t'BYMINUTE',\n\t\t\t\t'BYHOUR',\n\t\t\t\t'BYDAY',\n\t\t\t\t'BYMONTHDAY',\n\t\t\t\t'BYYEARDAY',\n\t\t\t\t'BYWEEKNO',\n\t\t\t\t'BYMONTH',\n\t\t\t\t'BYSETPOS',\n\t\t\t]\n\n\t\t\tfor (const part of parts) {\n\t\t\t\trecurrenceRule.recurrenceRuleValue.setComponent(part, [])\n\t\t\t}\n\n\t\t\tVue.set(recurrenceRule, 'byDay', [])\n\t\t\tVue.set(recurrenceRule, 'byMonth', [])\n\t\t\tVue.set(recurrenceRule, 'byMonthDay', [])\n\t\t\tVue.set(recurrenceRule, 'bySetPosition', null)\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Reset the By-parts of the recurrence rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tsetDefaultRecurrenceByPartsForWeekly(state, { calendarObjectInstance, recurrenceRule }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst byDay = getWeekDayFromDate(calendarObjectInstance.startDate)\n\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYDAY', [byDay])\n\t\t\trecurrenceRule.byDay.push(byDay)\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Reset the By-parts of the recurrence rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tsetDefaultRecurrenceByPartsForMonthly(state, { calendarObjectInstance, recurrenceRule }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst byMonthDay = calendarObjectInstance.startDate.getDate().toString()\n\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYMONTHDAY', [byMonthDay])\n\t\t\trecurrenceRule.byMonthDay.push(byMonthDay)\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tsetDefaultRecurrenceByPartsForMonthlyBySetPosition(state, { calendarObjectInstance, recurrenceRule }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst {\n\t\t\t\tbyDay,\n\t\t\t\tbySetPosition,\n\t\t\t} = getBySetPositionAndBySetFromDate(calendarObjectInstance.startDate)\n\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYDAY', [byDay])\n\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYSETPOS', [bySetPosition])\n\n\t\t\trecurrenceRule.byDay.push(byDay)\n\t\t\trecurrenceRule.bySetPosition = bySetPosition\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Reset the By-parts of the recurrence rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tsetDefaultRecurrenceByPartsForYearly(state, { calendarObjectInstance, recurrenceRule }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst byMonth = calendarObjectInstance.startDate.getMonth() + 1 // Javascript months are zero-based\n\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYMONTH', [byMonth])\n\t\t\trecurrenceRule.byMonth.push(byMonth)\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the until limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.byDay The new until to set\n\t */\n\taddByDayToRecurrenceRule(state, { calendarObjectInstance, recurrenceRule, byDay }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst byDayList = recurrenceRule.recurrenceRuleValue.getComponent('BYDAY')\n\t\t\tconst index = byDayList.indexOf(byDay)\n\t\t\tif (index === -1) {\n\t\t\t\tbyDayList.push(byDay)\n\t\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYDAY', byDayList)\n\t\t\t}\n\n\t\t\tconst index2 = recurrenceRule.byDay.indexOf(byDay)\n\t\t\tif (index2 === -1) {\n\t\t\t\trecurrenceRule.byDay.push(byDay)\n\t\t\t}\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the until limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.byDay The new until to set\n\t */\n\tremoveByDayFromRecurrenceRule(state, { calendarObjectInstance, recurrenceRule, byDay }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst byDayList = recurrenceRule.recurrenceRuleValue.getComponent('BYDAY')\n\t\t\tconst index = byDayList.indexOf(byDay)\n\t\t\tif (index !== -1) {\n\t\t\t\tbyDayList.splice(index, 1)\n\t\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYDAY', byDayList)\n\t\t\t}\n\n\t\t\tconst index2 = recurrenceRule.byDay.indexOf(byDay)\n\t\t\tif (index2 !== -1) {\n\t\t\t\trecurrenceRule.byDay.splice(index2, 1)\n\t\t\t}\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the until limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.byMonthDay The new until to set\n\t */\n\taddByMonthDayToRecurrenceRule(state, { calendarObjectInstance, recurrenceRule, byMonthDay }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst byMonthDayList = recurrenceRule.recurrenceRuleValue.getComponent('BYMONTHDAY')\n\t\t\tconst index = byMonthDayList.indexOf(byMonthDay)\n\t\t\tif (index === -1) {\n\t\t\t\tbyMonthDayList.push(byMonthDay)\n\t\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYMONTHDAY', byMonthDayList)\n\t\t\t}\n\n\t\t\tconst index2 = recurrenceRule.byMonthDay.indexOf(byMonthDay)\n\t\t\tif (index2 === -1) {\n\t\t\t\trecurrenceRule.byMonthDay.push(byMonthDay)\n\t\t\t}\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the until limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.byMonthDay The new until to set\n\t */\n\tremoveByMonthDayFromRecurrenceRule(state, { calendarObjectInstance, recurrenceRule, byMonthDay }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconst byMonthDayList = recurrenceRule.recurrenceRuleValue.getComponent('BYMONTHDAY')\n\t\t\tconst index = byMonthDayList.indexOf(byMonthDay)\n\t\t\tif (index !== -1) {\n\t\t\t\tbyMonthDayList.splice(index, 1)\n\t\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYMONTHDAY', byMonthDayList)\n\t\t\t}\n\n\t\t\tconst index2 = recurrenceRule.byMonthDay.indexOf(byMonthDay)\n\t\t\tif (index2 !== -1) {\n\t\t\t\trecurrenceRule.byMonthDay.splice(index2, 1)\n\t\t\t}\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the until limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.byMonth The new until to set\n\t */\n\taddByMonthToRecurrenceRule(state, { calendarObjectInstance, recurrenceRule, byMonth }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconsole.debug('addByMonthToRecurrenceRule', byMonth)\n\n\t\t\tconst byMonthList = recurrenceRule.recurrenceRuleValue.getComponent('BYMONTH')\n\t\t\tconst index = byMonthList.indexOf(byMonth)\n\t\t\tif (index === -1) {\n\t\t\t\tbyMonthList.push(byMonth)\n\t\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYMONTH', byMonthList)\n\t\t\t}\n\n\t\t\tconst index2 = recurrenceRule.byMonth.indexOf(byMonth)\n\t\t\tif (index2 === -1) {\n\t\t\t\trecurrenceRule.byMonth.push(byMonth)\n\t\t\t}\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the until limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.byMonth The new until to set\n\t */\n\tremoveByMonthFromRecurrenceRule(state, { calendarObjectInstance, recurrenceRule, byMonth }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tconsole.debug('removeByMonthFromRecurrenceRule', byMonth)\n\n\t\t\tconst byMonthList = recurrenceRule.recurrenceRuleValue.getComponent('BYMONTH')\n\t\t\tconst index = byMonthList.indexOf(byMonth)\n\t\t\tif (index !== -1) {\n\t\t\t\tbyMonthList.splice(index, 1)\n\t\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYMONTH', byMonthList)\n\t\t\t}\n\n\t\t\tconst index2 = recurrenceRule.byMonth.indexOf(byMonth)\n\t\t\tif (index2 !== -1) {\n\t\t\t\trecurrenceRule.byMonth.splice(index2, 1)\n\t\t\t}\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string[]} data.byDay The new until to set\n\t */\n\tchangeRecurrenceByDay(state, { calendarObjectInstance, recurrenceRule, byDay }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYDAY', byDay)\n\t\t\tVue.set(recurrenceRule, 'byDay', byDay)\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Change the until limit of the recurrence-rule\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data.bySetPosition The new until to set\n\t */\n\tchangeRecurrenceBySetPosition(state, { calendarObjectInstance, recurrenceRule, bySetPosition }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYSETPOS', [bySetPosition])\n\t\t\tVue.set(recurrenceRule, 'bySetPosition', bySetPosition)\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tunsetRecurrenceBySetPosition(state, { calendarObjectInstance, recurrenceRule }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\trecurrenceRule.recurrenceRuleValue.setComponent('BYSETPOS', [])\n\t\t\tVue.set(recurrenceRule, 'bySetPosition', null)\n\n\t\t\tconsole.debug(recurrenceRule.recurrenceRuleValue._innerValue.toString())\n\t\t}\n\t},\n\n\t/**\n\t * Remove the recurrence-rule from the calendarObjectInstance\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tremoveRecurrenceRuleFromCalendarObjectInstance(state, { calendarObjectInstance, recurrenceRule }) {\n\t\tif (recurrenceRule.recurrenceRuleValue) {\n\t\t\tcalendarObjectInstance.eventComponent.deleteAllProperties('RRULE')\n\t\t\tVue.set(calendarObjectInstance, 'recurrenceRule', getDefaultEventObject().recurrenceRule)\n\n\t\t\tconsole.debug(calendarObjectInstance)\n\t\t\tconsole.debug(recurrenceRule)\n\t\t}\n\t},\n\n\t/**\n\t * Add a new recurrence-rule to the calendarObjectInstance\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t */\n\taddRecurrenceRuleFromCalendarObjectInstance(state, { calendarObjectInstance }) {\n\t\tconst recurrenceValue = RecurValue.fromData({})\n\t\tconst recurrenceProperty = new Property('RRULE', recurrenceValue)\n\t\tcalendarObjectInstance.eventComponent.addProperty(recurrenceProperty)\n\t\tcalendarObjectInstance.recurrenceRule.recurrenceRuleValue = recurrenceValue\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.recurrenceRule The recurrenceRule object to modify\n\t */\n\tmarkRecurrenceRuleAsSupported(state, { calendarObjectInstance, recurrenceRule }) {\n\t\trecurrenceRule.isUnsupported = false\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t * @param {string} data.type New type of alarm\n\t */\n\tchangeAlarmType(state, { calendarObjectInstance, alarm, type }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\talarm.alarmComponent.action = type\n\t\t\talarm.type = type\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t * @param {number} data.amount New amount of timed event\n\t */\n\tchangeAlarmAmountTimed(state, { calendarObjectInstance, alarm, amount }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\talarm.alarmComponent.trigger.value.totalSeconds\n\t\t\t\t= getTotalSecondsFromAmountAndUnitForTimedEvents(amount, alarm.relativeUnitTimed, alarm.relativeIsBefore)\n\n\t\t\talarm.relativeAmountTimed = amount\n\t\t\talarm.relativeTrigger = alarm.alarmComponent.trigger.value.totalSeconds\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t * @param {string} data.unit New unit of timed event\n\t */\n\tchangeAlarmUnitTimed(state, { calendarObjectInstance, alarm, unit }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\talarm.alarmComponent.trigger.value.totalSeconds\n\t\t\t\t= getTotalSecondsFromAmountAndUnitForTimedEvents(alarm.relativeAmountTimed, unit, alarm.relativeIsBefore)\n\n\t\t\talarm.relativeUnitTimed = unit\n\t\t\talarm.relativeTrigger = alarm.alarmComponent.trigger.value.totalSeconds\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t * @param {number} data.amount New amount of all-day event\n\t */\n\tchangeAlarmAmountAllDay(state, { calendarObjectInstance, alarm, amount }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\talarm.alarmComponent.trigger.value.totalSeconds\n\t\t\t\t= getTotalSecondsFromAmountHourMinutesAndUnitForAllDayEvents(amount,\n\t\t\t\t\talarm.relativeHoursAllDay, alarm.relativeMinutesAllDay, alarm.relativeUnitAllDay)\n\n\t\t\talarm.relativeAmountAllDay = amount\n\t\t\talarm.relativeTrigger = alarm.alarmComponent.trigger.value.totalSeconds\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t * @param {string} data.unit New Unit of all-day event\n\t */\n\tchangeAlarmUnitAllDay(state, { calendarObjectInstance, alarm, unit }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\talarm.alarmComponent.trigger.value.totalSeconds\n\t\t\t\t= getTotalSecondsFromAmountHourMinutesAndUnitForAllDayEvents(alarm.relativeAmountAllDay,\n\t\t\t\t\talarm.relativeHoursAllDay, alarm.relativeMinutesAllDay, unit)\n\n\t\t\talarm.relativeUnitAllDay = unit\n\t\t\talarm.relativeTrigger = alarm.alarmComponent.trigger.value.totalSeconds\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t * @param {number} data.hours New Hour\n\t * @param {number} data.minutes New Minutes\n\t */\n\tchangeAlarmHoursMinutesAllDay(state, { calendarObjectInstance, alarm, hours, minutes }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\talarm.alarmComponent.trigger.value.totalSeconds\n\t\t\t\t= getTotalSecondsFromAmountHourMinutesAndUnitForAllDayEvents(alarm.relativeAmountAllDay,\n\t\t\t\t\thours, minutes, alarm.relativeUnitAllDay)\n\n\t\t\talarm.relativeHoursAllDay = hours\n\t\t\talarm.relativeMinutesAllDay = minutes\n\t\t\talarm.relativeTrigger = alarm.alarmComponent.trigger.value.totalSeconds\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t * @param {Date} data.date New date object\n\t */\n\tchangeAlarmAbsoluteDate(state, { calendarObjectInstance, alarm, date }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\talarm.alarmComponent.trigger.value.year = date.getFullYear()\n\t\t\talarm.alarmComponent.trigger.value.month = date.getMonth() + 1\n\t\t\talarm.alarmComponent.trigger.value.day = date.getDate()\n\t\t\talarm.alarmComponent.trigger.value.hour = date.getHours()\n\t\t\talarm.alarmComponent.trigger.value.minute = date.getMinutes()\n\t\t\talarm.alarmComponent.trigger.value.second = 0\n\n\t\t\talarm.absoluteDate = date\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t * @param {string} data.timezoneId New timezoneId\n\t */\n\tchangeAlarmAbsoluteTimezoneId(state, { calendarObjectInstance, alarm, timezoneId }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\tconst timezone = getTimezoneManager().getTimezoneForId(timezoneId)\n\t\t\talarm.alarmComponent.trigger.value.replaceTimezone(timezone)\n\n\t\t\talarm.absoluteTimezoneId = timezoneId\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t */\n\tchangeAlarmFromRelativeToAbsolute(state, { calendarObjectInstance, alarm }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\tconst triggerDateTime = calendarObjectInstance.eventComponent.startDate.clone()\n\t\t\t// The trigger of an alarm must be DATE-TIME, startDate can be either.\n\t\t\ttriggerDateTime.isDate = false\n\n\t\t\ttriggerDateTime.addDuration(alarm.alarmComponent.trigger.value)\n\n\t\t\talarm.alarmComponent.setTriggerFromAbsolute(triggerDateTime)\n\n\t\t\talarm.absoluteDate = getDateFromDateTimeValue(alarm.alarmComponent.trigger.value)\n\t\t\talarm.absoluteTimezoneId = alarm.alarmComponent.trigger.value.timezoneId\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t */\n\tchangeAlarmFromAbsoluteToRelative(state, { calendarObjectInstance, alarm }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\tconst duration = alarm.alarmComponent.trigger.value\n\t\t\t\t.subtractDateWithTimezone(calendarObjectInstance.eventComponent.startDate)\n\n\t\t\talarm.alarmComponent.setTriggerFromRelative(duration)\n\t\t\talarm.relativeIsBefore = alarm.alarmComponent.trigger.value.isNegative\n\t\t\talarm.relativeIsRelatedToStart = true\n\t\t\talarm.relativeTrigger = duration.totalSeconds\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.alarm The alarm object\n\t */\n\tresetAlarmRelativeParts(state, { alarm }) {\n\t\talarm.relativeIsBefore = null\n\t\talarm.relativeIsRelatedToStart = null\n\t\talarm.relativeUnitTimed = null\n\t\talarm.relativeAmountTimed = null\n\t\talarm.relativeUnitAllDay = null\n\t\talarm.relativeAmountAllDay = null\n\t\talarm.relativeHoursAllDay = null\n\t\talarm.relativeMinutesAllDay = null\n\t\talarm.relativeTrigger = null\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.alarm The alarm object\n\t */\n\tresetAlarmAbsoluteParts(state, { alarm }) {\n\t\talarm.absoluteDate = null\n\t\talarm.absoluteTimezoneId = null\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t */\n\tupdateAlarmAllDayParts(state, { calendarObjectInstance, alarm }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\tconst totalSeconds = alarm.alarmComponent.trigger.value.totalSeconds\n\t\t\tconst allDayParts = getAmountHoursMinutesAndUnitForAllDayEvents(totalSeconds)\n\n\t\t\talarm.relativeUnitAllDay = allDayParts.unit\n\t\t\talarm.relativeAmountAllDay = allDayParts.amount\n\t\t\talarm.relativeHoursAllDay = allDayParts.hours\n\t\t\talarm.relativeMinutesAllDay = allDayParts.minutes\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t */\n\tupdateAlarmTimedParts(state, { calendarObjectInstance, alarm }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\tconst totalSeconds = alarm.alarmComponent.trigger.value.totalSeconds\n\t\t\tconst timedParts = getAmountAndUnitForTimedEvents(totalSeconds)\n\n\t\t\talarm.relativeUnitTimed = timedParts.unit\n\t\t\talarm.relativeAmountTimed = timedParts.amount\n\n\t\t\tconsole.debug(alarm.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data.type Type of alarm\n\t * @param {number} data.totalSeconds Total amount of seconds for new alarm\n\t */\n\taddAlarmToCalendarObjectInstance(state, { calendarObjectInstance, type, totalSeconds }) {\n\t\tif (calendarObjectInstance.eventComponent) {\n\t\t\tconst eventComponent = calendarObjectInstance.eventComponent\n\n\t\t\tconst duration = DurationValue.fromSeconds(totalSeconds)\n\t\t\tconst alarmComponent = eventComponent.addRelativeAlarm(type, duration)\n\n\t\t\tconst alarmObject = mapAlarmComponentToAlarmObject(alarmComponent)\n\n\t\t\tcalendarObjectInstance.alarms.push(alarmObject)\n\n\t\t\tconsole.debug(alarmObject.alarmComponent.toICALJs().toString())\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.alarm The alarm object\n\t */\n\tremoveAlarmFromCalendarObjectInstance(state, { calendarObjectInstance, alarm }) {\n\t\tif (alarm.alarmComponent) {\n\t\t\tcalendarObjectInstance.eventComponent.removeAlarm(alarm.alarmComponent)\n\n\t\t\tconst index = calendarObjectInstance.alarms.indexOf(alarm)\n\t\t\tif (index !== -1) {\n\t\t\t\tcalendarObjectInstance.alarms.splice(index, 1)\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * @deprecated\n\t * @param state\n\t * @param calendarObjectInstance.calendarObjectInstance\n\t * @param calendarObjectInstance\n\t * @param calendarObjectInstance.sharedData\n\t * @param sharedData\n\t */\n\taddAttachmentBySharedData(state, { calendarObjectInstance, sharedData }) {\n\t\tconst attachment = AttachmentProperty.fromLink(sharedData.url)\n\t\tconst fileName = sharedData.fileName\n\n\t\t// hot-fix needed temporary, becase calendar-js has no fileName get-setter\n\t\tconst parameterFileName = new Parameter('FILENAME', fileName)\n\t\t// custom has-preview parameter from dav file\n\t\tconst xNcHasPreview = new Parameter('X-NC-HAS-PREVIEW', sharedData['has-preview'].toString())\n\t\t// custom file id parameter from dav file\n\t\tconst xNcFileId = new Parameter('X-NC-FILE-ID', sharedData.fileid.toString())\n\t\t// custom share-types parameter from dav file\n\t\tconst xNcSharedTypes = new Parameter('X-NC-SHARED-TYPES', sharedData['share-types']['share-type']\n\t\t\t? sharedData['share-types']['share-type'].join(',')\n\t\t\t: '')\n\t    attachment.setParameter(parameterFileName)\n\t    attachment.setParameter(xNcFileId)\n\t    attachment.setParameter(xNcHasPreview)\n\t    attachment.setParameter(xNcSharedTypes)\n\t\tattachment.isNew = true\n\t\tattachment.shareTypes = sharedData['share-types']['share-type']\n\t\t\t? sharedData['share-types']['share-type'].join(',')\n\t\t\t: ''\n\t\tattachment.fileName = fileName\n\t\tattachment.xNcFileId = sharedData.fileid\n\t\tattachment.xNcHasPreview = sharedData['has-preview']\n\t\tattachment.formatType = sharedData.getcontenttype\n\t\tattachment.uri = sharedData.url ? sharedData.url : generateUrl(`/f/${sharedData.fileid}`)\n\n\t\tcalendarObjectInstance.eventComponent.addProperty(attachment)\n\t\tcalendarObjectInstance.attachments.push(attachment)\n\n\t\t// console.log(attachment)\n\t},\n\n\taddAttachmentWithProperty(state, { calendarObjectInstance, sharedData }) {\n\t\tconst attachment = {}\n\t\tconst fileName = sharedData.fileName\n\t\tattachment.isNew = true\n\t\tattachment.shareTypes = (typeof sharedData?.['share-types']?.['share-type'] === 'number'\n\t\t\t? sharedData?.['share-types']?.['share-type']?.toString()\n\t\t\t: sharedData?.['share-types']?.['share-type']?.join(',')) ?? null\n\t\tattachment.fileName = fileName\n\t\tattachment.xNcFileId = sharedData.fileid\n\t\tattachment.xNcHasPreview = sharedData['has-preview']\n\t\tattachment.formatType = sharedData.getcontenttype\n\t\tattachment.uri = sharedData.url ? sharedData.url : generateUrl(`/f/${sharedData.fileid}`)\n\n\t\tconst attachmentProperty = AttachmentProperty.fromLink(attachment.uri, attachment.formatType)\n\t\tconst parameterFileName = new Parameter('FILENAME', fileName)\n\t\tconst xNcHasPreview = new Parameter('X-NC-HAS-PREVIEW', attachment.xNcHasPreview.toString())\n\t\tconst xNcFileId = new Parameter('X-NC-FILE-ID', attachment.xNcFileId.toString())\n\t\t// ADD X-NC-SHARED-TYPES only if sharet-type not empty\n\t\tif (attachment.shareTypes !== null) {\n\t\t\tconst xNcSharedTypes = new Parameter('X-NC-SHARED-TYPES', attachment.shareTypes)\n\t\t\tattachmentProperty.setParameter(xNcSharedTypes)\n\t\t}\n\n\t\tattachmentProperty.setParameter(parameterFileName)\n\t\tattachmentProperty.setParameter(xNcFileId)\n\t\tattachmentProperty.setParameter(xNcHasPreview)\n\t\tattachmentProperty.uri = attachment.uri\n\n\t\tattachment.attachmentProperty = attachmentProperty\n\n\t\tcalendarObjectInstance.eventComponent.addProperty(attachmentProperty)\n\t\tcalendarObjectInstance.attachments.push(attachment)\n\t},\n\n\t/**\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data.attachment The attachment object\n\t */\n\tdeleteAttachment(state, { calendarObjectInstance, attachment }) {\n\t\ttry {\n\t\t\tconst index = calendarObjectInstance.attachments.indexOf(attachment)\n\t\t\tif (index !== -1) {\n\t\t\t\t calendarObjectInstance.attachments.splice(index, 1)\n\t\t\t}\n\t\t\tcalendarObjectInstance.eventComponent.removeAttachment(attachment.attachmentProperty)\n\t\t} catch {\n\t\t}\n\n\t},\n}\n\nconst getters = {}\n\nconst actions = {\n\n\t/**\n\t * Returns the closest existing recurrence-id of a calendar-object\n\t * close to the given date.\n\t * This is either the next occurrence in the future or\n\t * in case there are no more future occurrences the closest\n\t * occurrence in the past\n\t *\n\t * @param {object} vuex The vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.dispatch The Vuex dispatch function\n\t * @param {Function} vuex.commit The Vuex commit function\n\t * @param {object} data The destructuring object\n\t * @param {string} data.objectId The objectId of the calendar-object to edit\n\t * @param {Date} data.closeToDate The date to get a close occurrence to\n\t * @return {Promise<number>}\n\t */\n\tasync resolveClosestRecurrenceIdForCalendarObject({ state, dispatch, commit }, { objectId, closeToDate }) {\n\t\tconst calendarObject = await dispatch('getEventByObjectId', { objectId })\n\t\tconst iterator = calendarObject.calendarComponent.getVObjectIterator()\n\t\tconst firstVObject = iterator.next().value\n\n\t\tconst d = DateTimeValue.fromJSDate(closeToDate, true)\n\t\treturn firstVObject\n\t\t\t.recurrenceManager\n\t\t\t.getClosestOccurrence(d)\n\t\t\t.getReferenceRecurrenceId()\n\t\t\t.unixTime\n\t},\n\n\t/**\n\t * Gets the calendar-object and calendar-object-instance\n\t * for a given objectId and recurrenceId.\n\t *\n\t * If the recurrenceId does not represent a valid instance,\n\t * an error will be thrown.\n\t *\n\t * @param {object} vuex The vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.dispatch The Vuex dispatch function\n\t * @param {Function} vuex.commit The Vuex commit function\n\t * @param {object} data The destructuring object\n\t * @param {string} data.objectId The objectId of the calendar-object to edit\n\t * @param {number} data.recurrenceId The recurrence-id to edit\n\t * @return {Promise<{calendarObject: object, calendarObjectInstance: object}>}\n\t */\n\tasync getCalendarObjectInstanceByObjectIdAndRecurrenceId({ state, dispatch, commit }, { objectId, recurrenceId }) {\n\t\tif (state.existingEvent.objectId === objectId && state.existingEvent.recurrenceId === recurrenceId) {\n\t\t\treturn Promise.resolve({\n\t\t\t\tcalendarObject: state.calendarObject,\n\t\t\t\tcalendarObjectInstance: state.calendarObjectInstance,\n\t\t\t})\n\t\t}\n\n\t\tconst recurrenceIdDate = new Date(recurrenceId * 1000)\n\t\tconst calendarObject = await dispatch('getEventByObjectId', { objectId })\n\t\tconst eventComponent = getObjectAtRecurrenceId(calendarObject, recurrenceIdDate)\n\t\tif (eventComponent === null) {\n\t\t\tthrow new Error('Not a valid recurrence-id')\n\t\t}\n\n\t\tconst calendarObjectInstance = mapEventComponentToEventObject(eventComponent)\n\t\tcommit('setCalendarObjectInstanceForExistingEvent', {\n\t\t\tcalendarObject,\n\t\t\tcalendarObjectInstance,\n\t\t\tobjectId,\n\t\t\trecurrenceId,\n\t\t})\n\n\t\treturn {\n\t\t\tcalendarObject,\n\t\t\tcalendarObjectInstance,\n\t\t}\n\t},\n\n\t/**\n\t * Gets the new calendar-object-instance.\n\t *\n\t * @param {object} vuex The vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.dispatch The Vuex dispatch function\n\t * @param {Function} vuex.commit The Vuex commit function\n\t * @param {object} data The destructuring object\n\t * @param {boolean} data.isAllDay Whether or not the new event is supposed to be all-day\n\t * @param {number} data.start The start of the new event (unixtime)\n\t * @param {number} data.end The end of the new event (unixtime)\n\t * @param {string} data.timezoneId The timezoneId of the new event\n\t * @return {Promise<{calendarObject: object, calendarObjectInstance: object}>}\n\t */\n\tasync getCalendarObjectInstanceForNewEvent({ state, dispatch, commit }, { isAllDay, start, end, timezoneId }) {\n\t\tif (state.isNew === true) {\n\t\t\treturn Promise.resolve({\n\t\t\t\tcalendarObject: state.calendarObject,\n\t\t\t\tcalendarObjectInstance: state.calendarObjectInstance,\n\t\t\t})\n\t\t}\n\n\t\tconst calendarObject = await dispatch('createNewEvent', { start, end, isAllDay, timezoneId })\n\t\tconst startDate = new Date(start * 1000)\n\t\tconst eventComponent = getObjectAtRecurrenceId(calendarObject, startDate)\n\t\tconst calendarObjectInstance = mapEventComponentToEventObject(eventComponent)\n\n\t\t// Add an alarm if the user set a default one in the settings. If\n\t\t// not, defaultReminder will not be a number (rather the string \"none\").\n\t\tconst defaultReminder = parseInt(settings.state.defaultReminder)\n\t\tif (!isNaN(defaultReminder)) {\n\t\t\tcommit('addAlarmToCalendarObjectInstance', {\n\t\t\t\tcalendarObjectInstance,\n\t\t\t\ttype: 'DISPLAY',\n\t\t\t\ttotalSeconds: defaultReminder,\n\t\t\t})\n\t\t\tlogger.debug(`Added defaultReminder (${defaultReminder}s) to newly created event`)\n\t\t}\n\n\t\t// Add default status\n\t\tconst rfcProps = getRFCProperties()\n\t\tconst status = rfcProps.status.defaultValue\n\t\tcommit('changeStatus', {\n\t\t\tcalendarObjectInstance,\n\t\t\tstatus,\n\t\t})\n\n\t\tcommit('setCalendarObjectInstanceForNewEvent', {\n\t\t\tcalendarObject,\n\t\t\tcalendarObjectInstance,\n\t\t})\n\n\t\treturn {\n\t\t\tcalendarObject,\n\t\t\tcalendarObjectInstance,\n\t\t}\n\t},\n\n\t/**\n\t * Updates the existing calendar-object-instance.\n\t *\n\t * @param {object} vuex The vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.dispatch The Vuex dispatch function\n\t * @param {Function} vuex.commit The Vuex commit function\n\t * @param {object} data The destructuring object\n\t * @param {boolean} data.isAllDay Whether or not the new event is supposed to be all-day\n\t * @param {number} data.start The start of the new event (unixtime)\n\t * @param {number} data.end The end of the new event (unixtime)\n\t * @param {string} data.timezoneId The timezoneId of the new event\n\t * @return {Promise<{calendarObject: object, calendarObjectInstance: object}>}\n\t */\n\tasync updateCalendarObjectInstanceForNewEvent({ state, dispatch, commit }, { isAllDay, start, end, timezoneId }) {\n\t\tawait dispatch('updateTimeOfNewEvent', {\n\t\t\tcalendarObjectInstance: state.calendarObjectInstance,\n\t\t\tstart,\n\t\t\tend,\n\t\t\tisAllDay,\n\t\t\ttimezoneId,\n\t\t})\n\t\tcommit('setCalendarObjectInstanceForNewEvent', {\n\t\t\tcalendarObject: state.calendarObject,\n\t\t\tcalendarObjectInstance: state.calendarObjectInstance,\n\t\t})\n\n\t\treturn {\n\t\t\tcalendarObject: state.calendarObject,\n\t\t\tcalendarObjectInstance: state.calendarObjectInstance,\n\t\t}\n\t},\n\n\t/**\n\t * Saves changes made to a single calendar-object-instance\n\t *\n\t * @param {object} vuex The vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.dispatch The Vuex dispatch function\n\t * @param {Function} vuex.commit The Vuex commit function\n\t * @param {object} data The destructuring object\n\t * @param {boolean} data.thisAndAllFuture Whether or not to save changes for all future occurrences or just this one\n\t * @param {string} data.calendarId The new calendar-id to store it in\n\t * @return {Promise<void>}\n\t */\n\tasync saveCalendarObjectInstance({ state, dispatch, commit }, { thisAndAllFuture, calendarId }) {\n\t\tconst eventComponent = state.calendarObjectInstance.eventComponent\n\t\tconst calendarObject = state.calendarObject\n\n\t\tupdateAlarms(eventComponent)\n\t\tupdateTalkParticipants(eventComponent)\n\n\t\tif (eventComponent.isDirty()) {\n\t\t\tconst isForkedItem = eventComponent.primaryItem !== null\n\t\t\tlet original = null\n\t\t\tlet fork = null\n\n\t\t\t// We check if two things apply:\n\t\t\t// - primaryItem !== null -> Is this a fork or not?\n\t\t\t// - eventComponent.canCreateRecurrenceExceptions() - Can we create a recurrence-exception for this item\n\t\t\tif (isForkedItem && eventComponent.canCreateRecurrenceExceptions()) {\n\t\t\t\t[original, fork] = eventComponent.createRecurrenceException(thisAndAllFuture)\n\t\t\t}\n\n\t\t\tawait dispatch('updateCalendarObject', { calendarObject })\n\n\t\t\tif (original !== null && fork !== null && original.root !== fork.root) {\n\t\t\t\tawait dispatch('createCalendarObjectFromFork', {\n\t\t\t\t\teventComponent: fork,\n\t\t\t\t\tcalendarId,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tif (calendarId !== state.calendarObject.calendarId) {\n\t\t\tawait dispatch('moveCalendarObject', {\n\t\t\t\tcalendarObject,\n\t\t\t\tnewCalendarId: calendarId,\n\t\t\t})\n\t\t}\n\t},\n\n\t/**\n\t * Duplicate calendar-object-instance\n\t *\n\t * @param {object} vuex The vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.dispatch The Vuex dispatch function\n\t * @param {Function} vuex.commit The Vuex commit function\n\t * @return {Promise<void>}\n\t */\n\tasync duplicateCalendarObjectInstance({ state, dispatch, commit }) {\n\t\tconst oldCalendarObjectInstance = state.calendarObjectInstance\n\t\tconst oldEventComponent = oldCalendarObjectInstance.eventComponent\n\t\tconst startDate = oldEventComponent.startDate.getInUTC()\n\t\tconst endDate = oldEventComponent.endDate.getInUTC()\n\t\tconst calendarObject = await dispatch('createNewEvent', {\n\t\t\tstart: startDate.unixTime,\n\t\t\tend: endDate.unixTime,\n\t\t\ttimezoneId: oldEventComponent.startDate.timezoneId,\n\t\t\tisAllDay: oldEventComponent.isAllDay(),\n\t\t})\n\t\tconst eventComponent = getObjectAtRecurrenceId(calendarObject, startDate.jsDate)\n\t\tcopyCalendarObjectInstanceIntoEventComponent(oldCalendarObjectInstance, eventComponent)\n\t\tconst calendarObjectInstance = mapEventComponentToEventObject(eventComponent)\n\n\t\tawait commit('setCalendarObjectInstanceForNewEvent', { calendarObject, calendarObjectInstance })\n\t},\n\n\t/**\n\t * Deletes a calendar-object-instance\n\t *\n\t * @param {object} vuex The vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.dispatch The Vuex dispatch function\n\t * @param {Function} vuex.commit The Vuex commit function\n\t * @param {object} data The destructuring object\n\t * @param {boolean} data.thisAndAllFuture Whether or not to delete all future occurrences or just this one\n\t * @return {Promise<void>}\n\t */\n\tasync deleteCalendarObjectInstance({ state, dispatch, commit }, { thisAndAllFuture }) {\n\t\tconst eventComponent = state.calendarObjectInstance.eventComponent\n\t\tconst isRecurrenceSetEmpty = eventComponent.removeThisOccurrence(thisAndAllFuture)\n\t\tconst calendarObject = state.calendarObject\n\n\t\tif (isRecurrenceSetEmpty) {\n\t\t\tawait dispatch('deleteCalendarObject', { calendarObject })\n\t\t} else {\n\t\t\tawait dispatch('updateCalendarObject', { calendarObject })\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {Date} data2.startDate The new start-date\n\t */\n\tchangeStartDate({ commit }, { calendarObjectInstance, startDate }) {\n\t\tconst difference = startDate.getTime() - calendarObjectInstance.startDate.getTime()\n\t\tconst endDate = new Date(calendarObjectInstance.endDate.getTime() + difference)\n\n\t\tcommit('changeStartDate', {\n\t\t\tcalendarObjectInstance,\n\t\t\tstartDate,\n\t\t})\n\t\tcommit('changeEndDate', {\n\t\t\tcalendarObjectInstance,\n\t\t\tendDate,\n\t\t})\n\t},\n\n\t/**\n\t * Change the timezone of the event's start\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data2.startTimezone New timezone to set for start\n\t */\n\tchangeStartTimezone({ commit }, { calendarObjectInstance, startTimezone }) {\n\t\tcommit('changeStartTimezone', { calendarObjectInstance, startTimezone })\n\n\t\t// Simulate a change of the start time to trigger the comparison\n\t\t// of start and end and trigger an update of end if necessary\n\t\tcommit('changeStartDate', {\n\t\t\tcalendarObjectInstance,\n\t\t\tstartDate: calendarObjectInstance.startDate,\n\t\t})\n\t},\n\n\t/**\n\t * Change the timezone of the event's end\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {string} data2.endTimezone New timezone to set for end\n\t */\n\tchangeEndTimezone({ commit }, { calendarObjectInstance, endTimezone }) {\n\t\tcommit('changeEndTimezone', { calendarObjectInstance, endTimezone })\n\n\t\t// Simulate a change of the end time to trigger the comparison\n\t\t// of start and end and trigger an update of start if necessary\n\t\tcommit('changeEndDate', {\n\t\t\tcalendarObjectInstance,\n\t\t\tendDate: calendarObjectInstance.endDate,\n\t\t})\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {Function} data.dispatch The Vuex dispatch function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data2.frequency The new frequency to set\n\t */\n\tchangeRecurrenceFrequency({ commit, dispatch }, { calendarObjectInstance, recurrenceRule, frequency }) {\n\n\t\tconsole.debug(calendarObjectInstance)\n\t\tconsole.debug(recurrenceRule)\n\t\tconsole.debug(frequency)\n\n\t\tif (recurrenceRule.frequency === 'NONE' && frequency !== 'NONE') {\n\t\t\t// Add a new recurrence-rule\n\t\t\tcommit('addRecurrenceRuleFromCalendarObjectInstance', { calendarObjectInstance })\n\t\t\tcommit('resetRecurrenceByParts', { calendarObjectInstance, recurrenceRule })\n\t\t\tcommit('changeRecurrenceFrequency', {\n\t\t\t\tcalendarObjectInstance,\n\t\t\t\trecurrenceRule: calendarObjectInstance.recurrenceRule,\n\t\t\t\tfrequency,\n\t\t\t})\n\t\t\tcommit('changeRecurrenceInterval', {\n\t\t\t\tcalendarObjectInstance,\n\t\t\t\trecurrenceRule: calendarObjectInstance.recurrenceRule,\n\t\t\t\tinterval: 1,\n\t\t\t})\n\t\t\tcommit('changeRecurrenceToInfinite', {\n\t\t\t\tcalendarObjectInstance,\n\t\t\t\trecurrenceRule: calendarObjectInstance.recurrenceRule,\n\t\t\t})\n\t\t\tdispatch('setDefaultRecurrenceByParts', { calendarObjectInstance, recurrenceRule, frequency })\n\n\t\t\tconsole.debug(`changed from none to ${frequency}`)\n\t\t} else if (recurrenceRule.frequency !== 'NONE' && frequency === 'NONE') {\n\t\t\tconsole.debug('calling removeRecurrenceRuleFromCalendarObjectInstance')\n\t\t\t// Remove the recurrence-rule\n\t\t\tcommit('removeRecurrenceRuleFromCalendarObjectInstance', { calendarObjectInstance, recurrenceRule })\n\t\t} else {\n\t\t\t// Change frequency of existing recurrence-rule\n\t\t\tcommit('resetRecurrenceByParts', { calendarObjectInstance, recurrenceRule })\n\t\t\tcommit('changeRecurrenceFrequency', {\n\t\t\t\tcalendarObjectInstance,\n\t\t\t\trecurrenceRule: calendarObjectInstance.recurrenceRule,\n\t\t\t\tfrequency,\n\t\t\t})\n\t\t\tdispatch('setDefaultRecurrenceByParts', { calendarObjectInstance, recurrenceRule, frequency })\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t * @param {string} data2.frequency The new frequency to set\n\t */\n\tsetDefaultRecurrenceByParts({ commit }, { calendarObjectInstance, recurrenceRule, frequency }) {\n\t\tswitch (frequency) {\n\t\tcase 'WEEKLY':\n\t\t\tcommit('setDefaultRecurrenceByPartsForWeekly', { calendarObjectInstance, recurrenceRule })\n\t\t\tbreak\n\n\t\tcase 'MONTHLY':\n\t\t\tcommit('setDefaultRecurrenceByPartsForMonthly', { calendarObjectInstance, recurrenceRule })\n\t\t\tbreak\n\n\t\tcase 'YEARLY':\n\t\t\tcommit('setDefaultRecurrenceByPartsForYearly', { calendarObjectInstance, recurrenceRule })\n\t\t\tbreak\n\t\t}\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t */\n\tsetRecurrenceToInfinite({ commit }, { calendarObjectInstance, recurrenceRule }) {\n\t\tcommit('changeRecurrenceToInfinite', {\n\t\t\tcalendarObjectInstance,\n\t\t\trecurrenceRule,\n\t\t})\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t */\n\tchangeMonthlyRecurrenceFromByDayToBySetPosition({ commit }, { calendarObjectInstance, recurrenceRule }) {\n\t\tconsole.debug('changeMonthlyRecurrenceFromByDayToBySetPosition')\n\t\tcommit('resetRecurrenceByParts', { calendarObjectInstance, recurrenceRule })\n\t\tcommit('setDefaultRecurrenceByPartsForMonthlyBySetPosition', { calendarObjectInstance, recurrenceRule })\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t */\n\tchangeMonthlyRecurrenceFromBySetPositionToByDay({ commit }, { calendarObjectInstance, recurrenceRule }) {\n\t\tconsole.debug('changeMonthlyRecurrenceFromBySetPositionToByDay')\n\t\tcommit('resetRecurrenceByParts', { calendarObjectInstance, recurrenceRule })\n\t\tcommit('setDefaultRecurrenceByPartsForMonthly', { calendarObjectInstance, recurrenceRule })\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t */\n\tenableYearlyRecurrenceBySetPosition({ commit }, { calendarObjectInstance, recurrenceRule }) {\n\t\tcommit('setDefaultRecurrenceByPartsForMonthlyBySetPosition', {\n\t\t\tcalendarObjectInstance,\n\t\t\trecurrenceRule,\n\t\t})\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t */\n\tdisableYearlyRecurrenceBySetPosition({ commit }, { calendarObjectInstance, recurrenceRule }) {\n\t\tcommit('changeRecurrenceByDay', {\n\t\t\tcalendarObjectInstance,\n\t\t\trecurrenceRule,\n\t\t\tbyDay: [],\n\t\t})\n\t\tcommit('unsetRecurrenceBySetPosition', {\n\t\t\tcalendarObjectInstance,\n\t\t\trecurrenceRule,\n\t\t})\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t */\n\tenableRecurrenceLimitByUntil({ commit }, { calendarObjectInstance, recurrenceRule }) {\n\t\tlet until\n\t\tswitch (recurrenceRule.frequency) {\n\t\t// Defaults to 7 days\n\t\tcase 'DAILY':\n\t\t\tuntil = new Date(calendarObjectInstance.startDate.getTime() + 7 * 24 * 60 * 60 * 1000)\n\t\t\tbreak\n\n\t\t// Defaults to 4 weeks\n\t\tcase 'WEEKLY':\n\t\t\tuntil = new Date(calendarObjectInstance.startDate.getTime() + 4 * 7 * 24 * 60 * 60 * 1000)\n\t\t\tbreak\n\n\t\t// Defaults to 10 year\n\t\tcase 'YEARLY':\n\t\t\tuntil = new Date(\n\t\t\t\tcalendarObjectInstance.startDate.getFullYear() + 10,\n\t\t\t\tcalendarObjectInstance.startDate.getMonth(),\n\t\t\t\tcalendarObjectInstance.startDate.getDate(),\n\t\t\t\t23,\n\t\t\t\t59,\n\t\t\t\t59,\n\t\t\t)\n\t\t\tbreak\n\n\t\t// Defaults to 12 months\n\t\tcase 'MONTHLY':\n\t\tdefault:\n\t\t\tuntil = new Date(\n\t\t\t\tcalendarObjectInstance.startDate.getFullYear() + 1,\n\t\t\t\tcalendarObjectInstance.startDate.getMonth(),\n\t\t\t\tcalendarObjectInstance.startDate.getDate(),\n\t\t\t\t23,\n\t\t\t\t59,\n\t\t\t\t59,\n\t\t\t)\n\t\t\tbreak\n\t\t}\n\n\t\tcommit('changeRecurrenceToInfinite', { calendarObjectInstance, recurrenceRule })\n\t\tcommit('changeRecurrenceUntil', {\n\t\t\tcalendarObjectInstance,\n\t\t\trecurrenceRule,\n\t\t\tuntil,\n\t\t})\n\t},\n\n\t/**\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {object} data2 The destructuring object for data\n\t * @param {object} data2.calendarObjectInstance The calendarObjectInstance object\n\t * @param {object} data2.recurrenceRule The recurrenceRule object to modify\n\t */\n\tenableRecurrenceLimitByCount({ commit }, { calendarObjectInstance, recurrenceRule }) {\n\t\tcommit('changeRecurrenceToInfinite', { calendarObjectInstance, recurrenceRule })\n\t\tcommit('changeRecurrenceCount', {\n\t\t\tcalendarObjectInstance,\n\t\t\trecurrenceRule,\n\t\t\tcount: 2, // Default value is two\n\t\t})\n\t},\n\n\tchangeAlarmAmountTimed({ commit }, { calendarObjectInstance, alarm, amount }) {\n\t\tcommit('changeAlarmAmountTimed', { calendarObjectInstance, alarm, amount })\n\t\tcommit('updateAlarmAllDayParts', { calendarObjectInstance, alarm })\n\t},\n\n\tchangeAlarmUnitTimed({ commit }, { calendarObjectInstance, alarm, unit }) {\n\t\tcommit('changeAlarmUnitTimed', { calendarObjectInstance, alarm, unit })\n\t\tcommit('updateAlarmAllDayParts', { calendarObjectInstance, alarm })\n\t},\n\n\tchangeAlarmAmountAllDay({ commit }, { calendarObjectInstance, alarm, amount }) {\n\t\tcommit('changeAlarmAmountAllDay', { calendarObjectInstance, alarm, amount })\n\t\tcommit('updateAlarmTimedParts', { calendarObjectInstance, alarm })\n\t},\n\n\tchangeAlarmUnitAllDay({ commit }, { calendarObjectInstance, alarm, unit }) {\n\t\tcommit('changeAlarmUnitAllDay', { calendarObjectInstance, alarm, unit })\n\t\tcommit('updateAlarmTimedParts', { calendarObjectInstance, alarm })\n\t},\n\n\tchangeAlarmHoursMinutesAllDay({ commit }, { calendarObjectInstance, alarm, hours, minutes }) {\n\t\tcommit('changeAlarmHoursMinutesAllDay', { calendarObjectInstance, alarm, hours, minutes })\n\t\tcommit('updateAlarmTimedParts', { calendarObjectInstance, alarm })\n\t},\n\n\tchangeAlarmFromRelativeToAbsolute({ commit }, { calendarObjectInstance, alarm }) {\n\t\tcommit('changeAlarmFromRelativeToAbsolute', { calendarObjectInstance, alarm })\n\t\tcommit('resetAlarmRelativeParts', { alarm })\n\t},\n\n\tchangeAlarmFromAbsoluteToRelative({ commit }, { calendarObjectInstance, alarm }) {\n\t\tcommit('changeAlarmFromAbsoluteToRelative', { calendarObjectInstance, alarm })\n\t\tcommit('updateAlarmAllDayParts', { calendarObjectInstance, alarm })\n\t\tcommit('updateAlarmTimedParts', { calendarObjectInstance, alarm })\n\t\tcommit('resetAlarmAbsoluteParts', { alarm })\n\t},\n\n\ttoggleAllDay({ commit, getters }, { calendarObjectInstance }) {\n\t\tcommit('toggleAllDay', { calendarObjectInstance })\n\n\t\tif (!calendarObjectInstance.isAllDay) {\n\t\t\tif (calendarObjectInstance.startTimezoneId === 'floating') {\n\t\t\t\tconst startTimezone = getters.getResolvedTimezone\n\t\t\t\tcommit('changeStartTimezone', { calendarObjectInstance, startTimezone })\n\t\t\t}\n\n\t\t\tcommit('changeTimeToDefaultForTimedEvents', { calendarObjectInstance })\n\t\t}\n\t},\n\n}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @author John Molakvo <skjnldsv@protonmail.com>\n *\n * @author Thomas Citharel <tcit@tcit.fr>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport Vue from 'vue'\nimport { mapCalendarJsToCalendarObject } from '../models/calendarObject.js'\nimport logger from '../utils/logger.js'\nimport {\n\tcreateEvent,\n\tgetParserManager,\n\tgetTimezoneManager,\n\tDateTimeValue,\n} from '@nextcloud/calendar-js'\n\nconst state = {\n\tcalendarObjects: {},\n\tmodificationCount: 0,\n}\n\nconst mutations = {\n\n\t/**\n\t * Adds an array of calendar-objects to the store\n\t *\n\t * @param {object} state The store data\n\t * @param {object} data The destructuring object\n\t * @param {object[]} data.calendarObjects Calendar-objects to add\n\t */\n\tappendCalendarObjects(state, { calendarObjects = [] }) {\n\t\tfor (const calendarObject of calendarObjects) {\n\t\t\tif (!state.calendarObjects[calendarObject.id]) {\n\t\t\t\tVue.set(state.calendarObjects, calendarObject.id, calendarObject)\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Adds one calendar-object to the store\n\t *\n\t * @param {object} state The store data\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObject Calendar-object to add\n\t */\n\tappendCalendarObject(state, { calendarObject }) {\n\t\tif (!state.calendarObjects[calendarObject.id]) {\n\t\t\tVue.set(state.calendarObjects, calendarObject.id, calendarObject)\n\t\t}\n\t},\n\n\t/**\n\t * Updates a calendar-object id\n\t *\n\t * @param {object} state The store data\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObject Calendar-object to update\n\t */\n\tupdateCalendarObjectId(state, { calendarObject }) {\n\t\tif (calendarObject.dav === null) {\n\t\t\tcalendarObject.id = null\n\t\t} else {\n\t\t\tcalendarObject.id = btoa(calendarObject.dav.url)\n\t\t}\n\t},\n\n\t/**\n\t * Updates a calendar-object's calendarId\n\t *\n\t * @param {object} state The store data\n\t * @param {object} data The destructuring object\n\t * @param {string} data.calendarObjectId Id of calendar-object to update\n\t * @param {string} data.calendarId New calendarId\n\t */\n\tupdateCalendarObjectIdCalendarId(state, { calendarObjectId, calendarId }) {\n\t\tstate.calendarObjects[calendarObjectId].calendarId = calendarId\n\t},\n\n\t/**\n\t * Resets a calendar-object to it's original server state\n\t *\n\t * @param {object} state The store data\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObject Calendar-object to reset\n\t */\n\tresetCalendarObjectToDav(state, { calendarObject }) {\n\t\tcalendarObject = state.calendarObjects[calendarObject.id]\n\n\t\t// If this object does not exist on the server yet, there is nothing to do\n\t\tif (!calendarObject || !calendarObject.existsOnServer) {\n\t\t\treturn\n\t\t}\n\n\t\tconst parserManager = getParserManager()\n\t\tconst parser = parserManager.getParserForFileType('text/calendar')\n\t\tparser.parse(calendarObject.dav.data)\n\n\t\tconst itemIterator = parser.getItemIterator()\n\t\tconst firstVCalendar = itemIterator.next().value\n\t\tif (firstVCalendar) {\n\t\t\tcalendarObject.calendarComponent = firstVCalendar\n\t\t}\n\t},\n\n\t/**\n\t * Removes a calendar-object from the store\n\t *\n\t * @param {object} state The store data\n\t * @param {object} data The destructuring object\n\t * @param {object} data.calendarObject Calendar-object to delete\n\t */\n\tdeleteCalendarObject(state, { calendarObject }) {\n\t\tVue.delete(state.calendarObjects, calendarObject.id)\n\t},\n\n\t/**\n\t * Increments the modification count\n\t *\n\t * @param {object} state The store data\n\t */\n\tincrementModificationCount(state) {\n\t\tstate.modificationCount++\n\t},\n}\n\nconst getters = {\n\n\t/**\n\t * Gets a calendar-object based on its id\n\t *\n\t * @param {object} state The store data\n\t * @return {function({String}): CalendarObject}\n\t */\n\tgetCalendarObjectById: (state) => (id) => state.calendarObjects[id],\n}\n\nconst actions = {\n\n\t/**\n\t * Moves a calendar-object to a different calendar\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {CalendarObject} data.calendarObject Calendar-object to delete\n\t * @param {string} data.newCalendarId Calendar-Id of calendar to move this calendar-object to\n\t * @return {Promise<void>}\n\t */\n\tasync moveCalendarObject(context, { calendarObject, newCalendarId }) {\n\t\tif (!calendarObject.existsOnServer) {\n\t\t\treturn\n\t\t}\n\n\t\tconst oldCalendarObjectId = calendarObject.id\n\t\tconst oldCalendarId = calendarObject.calendarId\n\n\t\tif (oldCalendarId === newCalendarId) {\n\t\t\tlogger.error('Old calendar Id and new calendar Id are the same, nothing to move')\n\t\t\treturn\n\t\t}\n\n\t\tconst newCalendar = context.getters.getCalendarById(newCalendarId)\n\t\tif (!newCalendar) {\n\t\t\tlogger.error('Calendar to move to not found, aborting')\n\t\t\treturn\n\t\t}\n\n\t\tawait calendarObject.dav.move(newCalendar.dav)\n\t\t// Update calendarId in calendarObject manually as it is not stored in dav\n\t\tcontext.commit('updateCalendarObjectIdCalendarId', {\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t\tcalendarId: newCalendarId,\n\t\t})\n\n\t\tcontext.commit('addCalendarObjectToCalendar', {\n\t\t\tcalendar: {\n\t\t\t\tid: newCalendarId,\n\t\t\t},\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\t\tcontext.commit('addCalendarObjectIdToAllTimeRangesOfCalendar', {\n\t\t\tcalendarId: newCalendarId,\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\n\t\tcontext.commit('deleteCalendarObjectFromCalendar', {\n\t\t\tcalendar: {\n\t\t\t\tid: oldCalendarId,\n\t\t\t},\n\t\t\tcalendarObjectId: oldCalendarObjectId,\n\t\t})\n\t\tcontext.commit('removeCalendarObjectIdFromAllTimeRangesOfCalendar', {\n\t\t\tcalendarId: oldCalendarId,\n\t\t\tcalendarObjectId: oldCalendarObjectId,\n\t\t})\n\n\t\tcontext.commit('incrementModificationCount')\n\t},\n\n\t/**\n\t * Updates a calendar-object\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {CalendarObject} data.calendarObject Calendar-object to delete\n\t * @return {Promise<void>}\n\t */\n\tasync updateCalendarObject(context, { calendarObject }) {\n\t\tif (calendarObject.existsOnServer) {\n\t\t\tcalendarObject.dav.data = calendarObject.calendarComponent.toICS()\n\t\t\tawait calendarObject.dav.update()\n\n\t\t\tcontext.commit('addCalendarObjectIdToAllTimeRangesOfCalendar', {\n\t\t\t\tcalendarId: calendarObject.calendarId,\n\t\t\t\tcalendarObjectId: calendarObject.id,\n\t\t\t})\n\t\t\tcontext.commit('incrementModificationCount')\n\n\t\t\treturn\n\n\t\t\t// TODO - catch conflicts\n\t\t}\n\n\t\tconst calendar = context.getters.getCalendarById(calendarObject.calendarId)\n\t\tcalendarObject.dav = await calendar.dav.createVObject(calendarObject.calendarComponent.toICS())\n\t\tcalendarObject.existsOnServer = true\n\t\tcontext.commit('updateCalendarObjectId', { calendarObject })\n\n\t\tcontext.commit('appendCalendarObject', { calendarObject })\n\t\tcontext.commit('addCalendarObjectToCalendar', {\n\t\t\tcalendar: {\n\t\t\t\tid: calendarObject.calendarId,\n\t\t\t},\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\t\tcontext.commit('addCalendarObjectIdToAllTimeRangesOfCalendar', {\n\t\t\tcalendarId: calendarObject.calendarId,\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\t\tcontext.commit('resetCalendarObjectToDav', { calendarObject })\n\t\tcontext.commit('incrementModificationCount')\n\t},\n\n\t/**\n\t * Creates a new calendar-object from an recurrence-exception fork\n\t *\n\t * @param {object} context The Vuex context\n\t * @param {object} data destructuring object\n\t * @param {EventComponent} data.eventComponent EventComponent to store\n\t * @param {string} data.calendarId The calendar-id to store it in\n\t * @return {Promise<void>}\n\t */\n\tasync createCalendarObjectFromFork(context, { eventComponent, calendarId }) {\n\t\tconst calendar = context.getters.getCalendarById(calendarId)\n\t\tconst calendarObject = mapCalendarJsToCalendarObject(eventComponent.root, calendar.id)\n\t\tcalendarObject.dav = await calendar.dav.createVObject(calendarObject.calendarComponent.toICS())\n\t\tcalendarObject.existsOnServer = true\n\t\tcontext.commit('updateCalendarObjectId', { calendarObject })\n\n\t\tcontext.commit('appendCalendarObject', { calendarObject })\n\t\tcontext.commit('addCalendarObjectToCalendar', {\n\t\t\tcalendar: {\n\t\t\t\tid: calendarObject.calendarId,\n\t\t\t},\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\t\tcontext.commit('addCalendarObjectIdToAllTimeRangesOfCalendar', {\n\t\t\tcalendarId: calendar.id,\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\t\tcontext.commit('incrementModificationCount')\n\t},\n\n\t/**\n\t * Deletes a calendar-object\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {CalendarObject} data.calendarObject Calendar-object to delete\n\t * @return {Promise<void>}\n\t */\n\tasync deleteCalendarObject(context, { calendarObject }) {\n\t\t// If this calendar-object was not created on the server yet,\n\t\t// no need to send requests to the server\n\t\tif (calendarObject.existsOnServer) {\n\t\t\tawait calendarObject.dav.delete()\n\t\t}\n\n\t\tcontext.commit('deleteCalendarObject', { calendarObject })\n\t\tcontext.commit('deleteCalendarObjectFromCalendar', {\n\t\t\tcalendar: {\n\t\t\t\tid: calendarObject.calendarId,\n\t\t\t},\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\t\tcontext.commit('removeCalendarObjectIdFromAnyTimeRange', {\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\t\tcontext.commit('incrementModificationCount')\n\t},\n\n\t/**\n\t * Creates a new calendar object based on start, end, timezone and isAllDay\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {number} data.start Timestamp for start of new event\n\t * @param {number} data.end Timestamp for end of new event\n\t * @param {string} data.timezoneId asd\n\t * @param {boolean} data.isAllDay foo\n\t * @return {Promise<CalendarObject>}\n\t */\n\tcreateNewEvent(context, { start, end, timezoneId, isAllDay }) {\n\t\tconst timezoneManager = getTimezoneManager()\n\t\tconst timezone = timezoneManager.getTimezoneForId(timezoneId)\n\n\t\tconst startDate = new Date(start * 1000)\n\t\tconst endDate = new Date(end * 1000)\n\n\t\tconst startDateTime = DateTimeValue\n\t\t\t.fromJSDate(startDate, true)\n\t\t\t.getInTimezone(timezone)\n\t\tconst endDateTime = DateTimeValue\n\t\t\t.fromJSDate(endDate, true)\n\t\t\t.getInTimezone(timezone)\n\n\t\tif (isAllDay) {\n\t\t\tstartDateTime.isDate = true\n\t\t\tendDateTime.isDate = true\n\t\t}\n\n\t\tconst calendar = createEvent(startDateTime, endDateTime)\n\t\tfor (const vObject of calendar.getVObjectIterator()) {\n\t\t\tvObject.undirtify()\n\t\t}\n\n\t\tconst firstCalendar = context.getters.sortedCalendars[0].id\n\t\treturn Promise.resolve(mapCalendarJsToCalendarObject(calendar, firstCalendar))\n\t},\n\n\t/**\n\t * Updates the time of the new calendar object\n\t *\n\t * @param {object} data The destructuring object for Vuex\n\t * @param {Function} data.commit The Vuex commit function\n\t * @param {Function} data.dispatch The Vuex dispatch function\n\t * @param {object} data2 destructuring object\n\t * @param {CalendarObject} data2.calendarObjectInstance Calendar-object to\n\t * @param {number} data2.start Timestamp for start of new event\n\t * @param {number} data2.end Timestamp for end of new event\n\t * @param {string} data2.timezoneId asd\n\t * @param {boolean} data2.isAllDay foo\n\t */\n\tupdateTimeOfNewEvent({ commit, dispatch }, { calendarObjectInstance, start, end, timezoneId, isAllDay }) {\n\t\tconst isDirty = calendarObjectInstance.eventComponent.isDirty()\n\t\tconst startDate = new Date(start * 1000)\n\t\tconst endDate = new Date(end * 1000)\n\n\t\tif (calendarObjectInstance.isAllDay !== isAllDay) {\n\t\t\tcommit('toggleAllDay', { calendarObjectInstance })\n\t\t}\n\n\t\tdispatch('changeStartTimezone', {\n\t\t\tcalendarObjectInstance,\n\t\t\tstartTimezone: timezoneId,\n\t\t})\n\t\tdispatch('changeEndTimezone', {\n\t\t\tcalendarObjectInstance,\n\t\t\tendTimezone: timezoneId,\n\t\t})\n\n\t\tcommit('changeStartDate', {\n\t\t\tcalendarObjectInstance,\n\t\t\tstartDate,\n\t\t})\n\n\t\tif (isAllDay) {\n\t\t\t// The full-calendar end date is exclusive, but the end-date\n\t\t\t// that changeEndDate expects is inclusive, so we have to deduct one day.\n\t\t\tcommit('changeEndDate', {\n\t\t\t\tcalendarObjectInstance,\n\t\t\t\tendDate: new Date(endDate.getTime() - 24 * 60 * 60 * 1000),\n\t\t\t})\n\t\t} else {\n\t\t\tcommit('changeEndDate', {\n\t\t\t\tcalendarObjectInstance,\n\t\t\t\tendDate,\n\t\t\t})\n\t\t}\n\n\t\tif (!isDirty) {\n\t\t\tcalendarObjectInstance.eventComponent.undirtify()\n\t\t}\n\t},\n}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @copyright Copyright (c) 2019 John Molakvo\n *\n * @copyright Copyright (c) 2019 Thomas Citharel\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @author John Molakvo <skjnldsv@protonmail.com>\n *\n * @author Thomas Citharel <tcit@tcit.fr>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport Vue from 'vue'\nimport {\n\tcreateCalendar,\n\tcreateSubscription,\n\tfindAll,\n\tfindAllDeletedCalendars,\n\tfindPublicCalendarsByTokens,\n} from '../services/caldavService.js'\nimport { mapCDavObjectToCalendarObject } from '../models/calendarObject.js'\nimport { dateFactory, getUnixTimestampFromDate } from '../utils/date.js'\nimport { getDefaultCalendarObject, mapDavCollectionToCalendar } from '../models/calendar.js'\nimport pLimit from 'p-limit'\nimport { uidToHexColor } from '../utils/color.js'\nimport { translate as t } from '@nextcloud/l10n'\nimport getTimezoneManager from '../services/timezoneDataProviderService.js'\nimport { CalendarComponent, Timezone, TimezoneComponent } from '@nextcloud/calendar-js'\nimport {\n\tCALDAV_BIRTHDAY_CALENDAR,\n\tIMPORT_STAGE_IMPORTING,\n\tIMPORT_STAGE_PROCESSING,\n} from '../models/consts.js'\nimport { showError } from '@nextcloud/dialogs'\n\nconst state = {\n\tcalendars: [],\n\ttrashBin: undefined,\n\tscheduleInbox: undefined,\n\tdeletedCalendars: [],\n\tdeletedCalendarObjects: [],\n\tcalendarsById: {},\n\tinitialCalendarsLoaded: false,\n\teditCalendarModal: undefined,\n\twidgetView: 'dayGridMonth',\n\twidgetDate: 'now',\n\twidgetEventDetailsOpen: false,\n\twidgetEventDetails: {},\n\twidgetRef: undefined,\n}\n\nconst mutations = {\n\n\t/**\n\t * Adds calendar into state\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to add\n\t */\n\taddCalendar(state, { calendar }) {\n\t\tconst object = getDefaultCalendarObject(calendar)\n\n\t\tif (!state.calendars.some(existing => existing.id === object.id)) {\n\t\t\tstate.calendars.push(object)\n\t\t}\n\t\tVue.set(state.calendarsById, object.id, object)\n\t},\n\n\taddTrashBin(state, { trashBin }) {\n\t\tstate.trashBin = trashBin\n\t},\n\n\tsetWidgetView(state, { viewName }) {\n\t\tstate.widgetView = viewName\n\t},\n\n\tsetWidgetDate(state, { widgetDate }) {\n\t\tstate.widgetDate = widgetDate\n\t},\n\n\tsetWidgetRef(state, { widgetRef }) {\n\t\tstate.widgetRef = widgetRef\n\t},\n\n\tsetSelectedEvent(state, { object, recurrenceId }) {\n\t\tstate.widgetEventDetailsOpen = true\n\t\tstate.widgetEventDetails = {\n\t\t\tobject,\n\t\t\trecurrenceId,\n\t\t}\n\t},\n\n\tcloseWidgetEventDetails(state) {\n\t\tstate.widgetEventDetailsOpen = false\n\t},\n\n\taddScheduleInbox(state, { scheduleInbox }) {\n\t\tstate.scheduleInbox = scheduleInbox\n\t},\n\n\t/**\n\t * Adds deleted calendar into state\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar calendar the calendar to add\n\t */\n\taddDeletedCalendar(state, { calendar }) {\n\t\tif (state.deletedCalendars.some(c => c.url === calendar.url)) {\n\t\t\t// This calendar is already known\n\t\t\treturn\n\t\t}\n\t\tstate.deletedCalendars.push(calendar)\n\t},\n\n\t/**\n\t * Removes a deleted calendar\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the deleted calendar to remove\n\t */\n\tremoveDeletedCalendar(state, { calendar }) {\n\t\tstate.deletedCalendars = state.deletedCalendars.filter(c => c !== calendar)\n\t},\n\n\t/**\n\t * Removes a deleted calendar object\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.vobject the deleted calendar object to remove\n\t */\n\tremoveDeletedCalendarObject(state, { vobject }) {\n\t\tstate.deletedCalendarObjects = state.deletedCalendarObjects.filter(vo => vo.id !== vobject.id)\n\t},\n\n\t/**\n\t * Adds a deleted vobject into state\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.vobject the calendar vobject to add\n\t */\n\taddDeletedCalendarObject(state, { vobject }) {\n\t\tif (state.deletedCalendarObjects.some(c => c.uri === vobject.uri)) {\n\t\t\t// This vobject is already known\n\t\t\treturn\n\t\t}\n\t\tstate.deletedCalendarObjects.push(vobject)\n\t},\n\n\t/**\n\t * Deletes a calendar\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to delete\n\t */\n\tdeleteCalendar(state, { calendar }) {\n\t\tstate.calendars.splice(state.calendars.indexOf(calendar), 1)\n\t\tVue.delete(state.calendarsById, calendar.id)\n\t},\n\n\t/**\n\t * Toggles a calendar's visibility\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to toggle\n\t */\n\ttoggleCalendarEnabled(state, { calendar }) {\n\t\tstate.calendarsById[calendar.id].enabled = !state.calendarsById[calendar.id].enabled\n\t},\n\n\t/**\n\t * Renames a calendar\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to rename\n\t * @param {string} data.newName the new name of the calendar\n\t */\n\trenameCalendar(state, { calendar, newName }) {\n\t\tstate.calendarsById[calendar.id].displayName = newName\n\t},\n\n\t/**\n\t * Changes calendar's color\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to rename\n\t * @param {string} data.newColor the new color of the calendar\n\t */\n\tchangeCalendarColor(state, { calendar, newColor }) {\n\t\tstate.calendarsById[calendar.id].color = newColor\n\t},\n\n\t/**\n\t * Changes calendar's order\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to rename\n\t * @param {string} data.newOrder the new order of the calendar\n\t */\n\tchangeCalendarOrder(state, { calendar, newOrder }) {\n\t\tstate.calendarsById[calendar.id].order = newOrder\n\t},\n\n\t/**\n\t * Adds multiple calendar-objects to calendar\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar The calendar to append objects to\n\t * @param {string[]} data.calendarObjectIds The calendar object ids to append\n\t */\n\tappendCalendarObjectsToCalendar(state, { calendar, calendarObjectIds }) {\n\t\tfor (const calendarObjectId of calendarObjectIds) {\n\t\t\tif (state.calendarsById[calendar.id].calendarObjects.indexOf(calendarObjectId) === -1) {\n\t\t\t\tstate.calendarsById[calendar.id].calendarObjects.push(calendarObjectId)\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Adds calendar-object to calendar\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar The calendar to append objects to\n\t * @param {string} data.calendarObjectId The calendar object id to append\n\t */\n\taddCalendarObjectToCalendar(state, { calendar, calendarObjectId }) {\n\t\tif (state.calendarsById[calendar.id].calendarObjects.indexOf(calendarObjectId) === -1) {\n\t\t\tstate.calendarsById[calendar.id].calendarObjects.push(calendarObjectId)\n\t\t}\n\t},\n\n\t/**\n\t * Removes calendar-object from calendar\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar The calendar to delete objects from\n\t * @param {string} data.calendarObjectId The calendar object ids to delete\n\t */\n\tdeleteCalendarObjectFromCalendar(state, { calendar, calendarObjectId }) {\n\t\tconst index = state.calendarsById[calendar.id].calendarObjects.indexOf(calendarObjectId)\n\n\t\tif (index !== -1) {\n\t\t\tstate.calendarsById[calendar.id].calendarObjects.slice(index, 1)\n\t\t}\n\t},\n\n\t/**\n\t * Adds fetched time-range to calendar\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar The calendar to append a time-range to\n\t * @param {number} data.fetchedTimeRangeId The time-range-id to append\n\t */\n\taddFetchedTimeRangeToCalendar(state, { calendar, fetchedTimeRangeId }) {\n\t\tstate.calendarsById[calendar.id].fetchedTimeRanges.push(fetchedTimeRangeId)\n\n\t},\n\n\t/**\n\t * Removes fetched time-range from calendar\n\t *\n\t * @param {object} state the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar The calendar to remove a time-range from\n\t * @param {number} data.fetchedTimeRangeId The time-range-id to remove\n\t */\n\tdeleteFetchedTimeRangeFromCalendar(state, { calendar, fetchedTimeRangeId }) {\n\t\tconst index = state.calendarsById[calendar.id].fetchedTimeRanges.indexOf(fetchedTimeRangeId)\n\n\t\tif (index !== -1) {\n\t\t\tstate.calendarsById[calendar.id].fetchedTimeRanges.slice(index, 1)\n\t\t}\n\t},\n\n\t/**\n\t * Shares calendar with a user or group\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar\n\t * @param {string} data.user the userId\n\t * @param {string} data.displayName the displayName\n\t * @param {string} data.uri the sharing principalScheme uri\n\t * @param {boolean} data.isGroup is this a group?\n\t * @param {boolean} data.isCircle is this a circle?\n\t */\n\tshareCalendar(state, { calendar, user, displayName, uri, isGroup, isCircle }) {\n\t\tconst newSharee = {\n\t\t\tdisplayName,\n\t\t\tid: user,\n\t\t\twriteable: false,\n\t\t\tisGroup,\n\t\t\tisCircle,\n\t\t\turi,\n\t\t}\n\t\tstate.calendarsById[calendar.id].shares.push(newSharee)\n\t},\n\n\t/**\n\t * Removes Sharee from calendar shares list\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar\n\t * @param {string} data.uri the sharee uri\n\t */\n\tunshareCalendar(state, { calendar, uri }) {\n\t\tcalendar = state.calendars.find(search => search.id === calendar.id)\n\t\tconst shareIndex = calendar.shares.findIndex(sharee => sharee.uri === uri)\n\t\tcalendar.shares.splice(shareIndex, 1)\n\t},\n\n\t/**\n\t * Toggles sharee's writable permission\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar\n\t * @param {string} data.uri the sharee uri\n\t */\n\ttoggleCalendarShareWritable(state, { calendar, uri }) {\n\t\tcalendar = state.calendars.find(search => search.id === calendar.id)\n\t\tconst sharee = calendar.shares.find(sharee => sharee.uri === uri)\n\t\tsharee.writeable = !sharee.writeable\n\t},\n\n\t/**\n\t * Publishes a calendar calendar\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to publish\n\t * @param {string} data.publishURL published URL of calendar\n\t */\n\tpublishCalendar(state, { calendar, publishURL }) {\n\t\tcalendar = state.calendars.find(search => search.id === calendar.id)\n\t\tcalendar.publishURL = publishURL\n\t},\n\n\t/**\n\t * Unpublishes a calendar\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to unpublish\n\t */\n\tunpublishCalendar(state, { calendar }) {\n\t\tcalendar = state.calendars.find(search => search.id === calendar.id)\n\t\tcalendar.publishURL = null\n\t},\n\n\t/**\n\t * Marks initial loading of calendars as complete\n\t *\n\t * @param {object} state the store data\n\t */\n\tinitialCalendarsLoaded(state) {\n\t\tstate.initialCalendarsLoaded = true\n\t},\n\n\t/**\n\t * Marks a calendar as loading\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to mark as loading\n\t */\n\tmarkCalendarAsLoading(state, { calendar }) {\n\t\tstate.calendarsById[calendar.id].loading = true\n\t},\n\n\t/**\n\t * Marks a calendar as finished loading\n\t *\n\t * @param {object} state the store data\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to mark as finished loading\n\t */\n\tmarkCalendarAsNotLoading(state, { calendar }) {\n\t\tstate.calendarsById[calendar.id].loading = false\n\t},\n\n\tshowEditCalendarModal(state, { calendarId }) {\n\t\tstate.editCalendarModal = {\n\t\t\tcalendarId,\n\t\t}\n\t},\n\n\thideEditCalendarModal(state) {\n\t\tstate.editCalendarModal = undefined\n\t},\n\n\tsetCalendarDeleteCountdown(state, { calendar, countdown }) {\n\t\tVue.set(state.calendarsById[calendar.id], 'countdown', countdown)\n\t},\n\n\tsetCalendarDeleteHandles(state, { calendar, deleteTimeout, deleteInterval }) {\n\t\tVue.set(state.calendarsById[calendar.id], 'deleteTimeout', deleteTimeout)\n\t\tVue.set(state.calendarsById[calendar.id], 'deleteInterval', deleteInterval)\n\t},\n}\n\nconst getters = {\n\n\t/**\n\t * List of sorted calendars and subscriptions\n\t *\n\t * @param {object} state the store data\n\t * @param {object} store the store\n\t * @param {object} rootState the rootState\n\t * @return {Array}\n\t */\n\tsortedCalendarsSubscriptions(state, store, rootState) {\n\t\treturn state.calendars\n\t\t\t.filter(calendar => calendar.supportsEvents || (rootState.settings.showTasks && calendar.supportsTasks))\n\t\t\t.sort((a, b) => a.order - b.order)\n\t},\n\n\t/**\n\t * List of sorted calendars\n\t *\n\t * @param {object} state the store data\n\t * @return {Array}\n\t */\n\tsortedCalendars(state) {\n\t\treturn state.calendars\n\t\t\t.filter(calendar => calendar.supportsEvents)\n\t\t\t.filter(calendar => !calendar.readOnly)\n\t\t\t.sort((a, b) => a.order - b.order)\n\t},\n\n\t/**\n\t * List of sorted calendars owned by the principal\n\t *\n\t * @param {object} state the store data\n\t * @return {Array}\n\t */\n\townSortedCalendars(state) {\n\t\treturn state.calendars\n\t\t\t.filter(calendar => calendar.supportsEvents)\n\t\t\t.filter(calendar => !calendar.readOnly)\n\t\t\t.filter(calendar => !calendar.isSharedWithMe)\n\t\t\t.sort((a, b) => a.order - b.order)\n\t},\n\n\twidgetView(state) {\n\t\treturn state.widgetView\n\t},\n\n\twidgetDate(state) {\n\t\treturn state.widgetDate\n\t},\n\n\twidgetEventDetailsOpen(state) {\n\t\treturn state.widgetEventDetailsOpen\n\t},\n\n\twidgetRef(state) {\n\t\treturn state.widgetRef\n\t},\n\n\thasTrashBin(state) {\n\t\treturn state.trashBin !== undefined && state.trashBin.retentionDuration !== 0\n\t},\n\n\ttrashBin(state) {\n\t\treturn state.trashBin\n\t},\n\n\tscheduleInbox: (state) => {\n\t\treturn state.scheduleInbox\n\t},\n\n\t/**\n\t * List of deleted sorted calendars\n\t *\n\t * @param {object} state the store data\n\t * @return {Array}\n\t */\n\tsortedDeletedCalendars(state) {\n\t\treturn state.deletedCalendars\n\t\t\t.sort((a, b) => a.deletedAt - b.deletedAt)\n\t},\n\n\t/**\n\t * List of deleted calendars objects\n\t *\n\t * @param {object} state the store data\n\t * @return {Array}\n\t */\n\tdeletedCalendarObjects(state) {\n\t\tconst calendarUriMap = {}\n\t\tstate.calendars.forEach(calendar => {\n\t\t\tconst withoutTrail = calendar.url.replace(/\\/$/, '')\n\t\t\tconst uri = withoutTrail.slice(withoutTrail.lastIndexOf('/') + 1)\n\t\t\tcalendarUriMap[uri] = calendar\n\t\t})\n\n\t\treturn state.deletedCalendarObjects.map(obj => ({\n\t\t\tcalendar: calendarUriMap[obj.dav._props['{http://nextcloud.com/ns}calendar-uri']],\n\t\t\t...obj,\n\t\t}))\n\t},\n\n\t/**\n\t * List of sorted subscriptions\n\t *\n\t * @param {object} state the store data\n\t * @return {Array}\n\t */\n\tsortedSubscriptions(state) {\n\t\treturn state.calendars\n\t\t\t.filter(calendar => calendar.supportsEvents)\n\t\t\t.filter(calendar => calendar.readOnly)\n\t\t\t.sort((a, b) => a.order - b.order)\n\t},\n\n\t/**\n\t * List of enabled calendars and subscriptions\n\t *\n\t * @param {object} state the store data\n\t * @param {object} store the store\n\t * @param {object} rootState the rootState\n\t * @return {Array}\n\t */\n\tenabledCalendars(state, store, rootState) {\n\t\treturn state.calendars\n\t\t\t.filter(calendar => calendar.supportsEvents || (rootState.settings.showTasks && calendar.supportsTasks))\n\t\t\t.filter(calendar => calendar.enabled)\n\t},\n\n\t/**\n\t * Gets a calendar by it's Id\n\t *\n\t * @param {object} state the store data\n\t * @return {function({String}): {Object}}\n\t */\n\tgetCalendarById: (state) => (calendarId) => state.calendarsById[calendarId],\n\n\t/**\n\t * Gets a calendar by its url\n\t *\n\t * @param {object} state the store data\n\t * @return {function({String}): {Object}}\n\t */\n\tgetCalendarByUrl: (state) => (url) => state.calendars.find((calendar) => calendar.url === url),\n\n\t/**\n\t * Gets the contact's birthday calendar or null\n\t *\n\t * @param {object} state the store data\n\t * @return {object | null}\n\t */\n\tgetBirthdayCalendar: (state) => {\n\t\tfor (const calendar of state.calendars) {\n\t\t\tconst url = calendar.url.slice(0, -1)\n\t\t\tconst lastSlash = url.lastIndexOf('/')\n\t\t\tconst uri = url.slice(lastSlash + 1)\n\n\t\t\tif (uri === CALDAV_BIRTHDAY_CALENDAR) {\n\t\t\t\treturn calendar\n\t\t\t}\n\t\t}\n\n\t\treturn null\n\t},\n\n\t/**\n\t * Whether or not a birthday calendar exists\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} getters the vuex getters\n\t * @return {boolean}\n\t */\n\thasBirthdayCalendar: (state, getters) => {\n\t\treturn !!getters.getBirthdayCalendar\n\t},\n\n\t/**\n\t *\n\t * @param {object} state the store data\n\t * @param {object} getters the store getters\n\t * @return {function({Boolean}, {Boolean}, {Boolean}): {Object}[]}\n\t */\n\tsortedCalendarFilteredByComponents: (state, getters) => (vevent, vjournal, vtodo) => {\n\t\treturn getters.sortedCalendars.filter((calendar) => {\n\t\t\tif (vevent && !calendar.supportsEvents) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tif (vjournal && !calendar.supportsJournals) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tif (vtodo && !calendar.supportsTasks) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\treturn true\n\t\t})\n\t},\n\n\teditCalendarModal: (state) => state.editCalendarModal,\n}\n\nconst actions = {\n\n\t/**\n\t * Retrieve and commit calendars and other collections\n\t *\n\t * @param {object} context the store object\n\t * @param {object} context.commit the store mutations\n\t * @param {object} context.state the store state\n\t * @param {object} context.getters the store getters\n\t * @return {Promise<object>} the results\n\t */\n\tasync loadCollections({ commit, state, getters }) {\n\t\tconst { calendars, trashBins, scheduleInboxes, subscriptions } = await findAll()\n\t\tconsole.info('calendar home scanned', calendars, trashBins, subscriptions)\n\t\tcalendars.map((calendar) => mapDavCollectionToCalendar(calendar, getters.getCurrentUserPrincipal)).forEach(calendar => {\n\t\t\tcommit('addCalendar', { calendar })\n\t\t})\n\t\tif (trashBins.length) {\n\t\t\tcommit('addTrashBin', { trashBin: trashBins[0] })\n\t\t}\n\t\tif (scheduleInboxes.length) {\n\t\t\tcommit('addScheduleInbox', { scheduleInbox: scheduleInboxes[0] })\n\t\t}\n\n\t\tcommit('initialCalendarsLoaded')\n\t\treturn {\n\t\t\tcalendars: state.calendars,\n\t\t\ttrashBin: state.trashBin,\n\t\t}\n\t},\n\n\t/**\n\t * Retrieve and commit deleted calendars\n\t *\n\t * @param {object} context the store object\n\t * @param {object} context.commit the store mutations\n\t * @return {Promise<Array>} the calendars\n\t */\n\tasync loadDeletedCalendars({ commit }) {\n\t\tconst calendars = await findAllDeletedCalendars()\n\n\t\tcalendars.forEach(calendar => commit('addDeletedCalendar', { calendar }))\n\t},\n\n\t/**\n\t * Retrieve and commit deleted calendar objects\n\t *\n\t * @param {object} context the store object\n\t * @param {object} context.commit the store mutations\n\t * @param {object} context.state the store state\n\t */\n\tasync loadDeletedCalendarObjects({ commit, state }) {\n\t\tconst vobjects = await state.trashBin.findDeletedObjects()\n\t\tconsole.info('vobjects loaded', { vobjects })\n\n\t\tvobjects.forEach(vobject => {\n\t\t\ttry {\n\t\t\t\tconst calendarObject = mapCDavObjectToCalendarObject(vobject, undefined)\n\t\t\t\tcommit('addDeletedCalendarObject', { vobject: calendarObject })\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('could not convert calendar object', vobject, error)\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t *\n\t * @param {object} context the store object\n\t * @param {object} context.commit the store mutations\n\t * @param {object} data The data destructuring object\n\t * @param {string[]} data.tokens The tokens to load\n\t * @return {Promise<object[]>}\n\t */\n\tasync getPublicCalendars({ commit }, { tokens }) {\n\t\tconst calendars = await findPublicCalendarsByTokens(tokens)\n\t\tconst calendarObjects = []\n\t\tfor (const davCalendar of calendars) {\n\t\t\tconst calendar = mapDavCollectionToCalendar(davCalendar)\n\t\t\tcommit('addCalendar', { calendar })\n\t\t\tcalendarObjects.push(calendar)\n\t\t}\n\n\t\tcommit('initialCalendarsLoaded')\n\t\treturn calendarObjects\n\t},\n\n\t/**\n\t * Append a new calendar to array of existing calendars\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.displayName The name of the new calendar\n\t * @param {object} data.color The color of the new calendar\n\t * @param {object} data.order The order of the new calendar\n\t * @param {string[]} data.components The supported components of the calendar\n\t * @param {string=} data.timezone The timezoneId\n\t * @return {Promise}\n\t */\n\tasync appendCalendar(context, { displayName, color, order, components = ['VEVENT'], timezone = null }) {\n\t\tif (timezone === null) {\n\t\t\ttimezone = context.getters.getResolvedTimezone\n\t\t}\n\n\t\tlet timezoneIcs = null\n\t\tconst timezoneObject = getTimezoneManager().getTimezoneForId(timezone)\n\t\tif (timezoneObject !== Timezone.utc && timezoneObject !== Timezone.floating) {\n\t\t\tconst calendar = CalendarComponent.fromEmpty()\n\t\t\tcalendar.addComponent(TimezoneComponent.fromICALJs(timezoneObject.toICALJs()))\n\t\t\ttimezoneIcs = calendar.toICS(false)\n\t\t}\n\n\t\tconst response = await createCalendar(displayName, color, components, order, timezoneIcs)\n\t\tconst calendar = mapDavCollectionToCalendar(response, context.getters.getCurrentUserPrincipal)\n\t\tcontext.commit('addCalendar', { calendar })\n\t},\n\n\t/**\n\t * Append a new subscription to array of existing calendars\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {string} data.displayName Name of new subscription\n\t * @param {string} data.color Color of new subscription\n\t * @param {string} data.order Order of new subscription\n\t * @param {string} data.source Source of new subscription\n\t * @return {Promise}\n\t */\n\tasync appendSubscription(context, { displayName, color, order, source }) {\n\t\tconst response = await createSubscription(displayName, color, source, order)\n\t\tconst calendar = mapDavCollectionToCalendar(response, context.getters.getCurrentUserPrincipal)\n\t\tcontext.commit('addCalendar', { calendar })\n\t},\n\n\t/**\n\t * Delete a calendar\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to delete\n\t * @return {Promise}\n\t */\n\tasync deleteCalendar(context, { calendar }) {\n\t\tawait calendar.dav.delete()\n\t\tcontext.commit('deleteCalendar', { calendar })\n\t},\n\n\t/**\n\t * Delete a calendar in the trash bin\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to delete\n\t * @return {Promise}\n\t */\n\tasync deleteCalendarPermanently(context, { calendar }) {\n\t\tawait calendar.delete({\n\t\t\t'X-NC-CalDAV-No-Trashbin': 1,\n\t\t})\n\n\t\tcontext.commit('removeDeletedCalendar', { calendar })\n\t},\n\n\tdeleteCalendarAfterTimeout(context, { calendar, countdown = 7 }) {\n\t\tcontext.commit('setCalendarDeleteCountdown', { calendar, countdown })\n\t\tconst deleteInterval = setInterval(() => {\n\t\t\tcountdown--\n\n\t\t\tif (countdown < 0) {\n\t\t\t\tcountdown = 0\n\t\t\t}\n\n\t\t\tcontext.commit('setCalendarDeleteCountdown', { calendar, countdown })\n\t\t}, 1000)\n\t\tconst deleteTimeout = setTimeout(async () => {\n\t\t\ttry {\n\t\t\t\tawait context.dispatch('deleteCalendar', { calendar })\n\t\t\t} catch (error) {\n\t\t\t\tshowError(t('calendar', 'An error occurred, unable to delete the calendar.'))\n\t\t\t\tconsole.error(error)\n\t\t\t} finally {\n\t\t\t\tclearInterval(deleteInterval)\n\t\t\t}\n\t\t}, 7000)\n\t\tcontext.commit('setCalendarDeleteHandles', {\n\t\t\tcalendar,\n\t\t\tdeleteInterval,\n\t\t\tdeleteTimeout,\n\t\t})\n\t},\n\n\tcancelCalendarDeletion(context, { calendar }) {\n\t\tif (calendar.deleteInterval) clearInterval(calendar.deleteInterval)\n\t\tif (calendar.deleteTimeout) clearTimeout(calendar.deleteTimeout)\n\t\tcontext.commit('setCalendarDeleteHandles', {\n\t\t\tcalendar,\n\t\t\tdeleteInterval: undefined,\n\t\t\tdeleteTimeout: undefined,\n\t\t})\n\t},\n\n\tasync restoreCalendar({ commit, state }, { calendar }) {\n\t\tawait state.trashBin.restore(calendar.url)\n\n\t\tcommit('removeDeletedCalendar', { calendar })\n\t},\n\n\tasync restoreCalendarObject({ commit, state, getters }, { vobject }) {\n\t\tawait state.trashBin.restore(vobject.uri)\n\n\t\t// Clean up the data locally\n\t\tcommit('removeDeletedCalendarObject', { vobject })\n\n\t\t// Delete cached time range that includes the restored event\n\t\tconst calendarObject = mapCDavObjectToCalendarObject(vobject.dav, undefined)\n\t\tconst component = calendarObject.calendarComponent.getFirstComponent(vobject.objectType)\n\t\tconst timeRange = getters.getTimeRangeForCalendarCoveringRange(\n\t\t\tvobject.calendar.id,\n\t\t\tcomponent.startDate?.unixTime,\n\t\t\tcomponent.endDate?.unixTime,\n\t\t)\n\t\tif (timeRange) {\n\t\t\tcommit('deleteFetchedTimeRangeFromCalendar', {\n\t\t\t\tcalendar: vobject.calendar,\n\t\t\t\tfetchedTimeRangeId: timeRange.id,\n\t\t\t})\n\t\t\tcommit('removeTimeRange', {\n\t\t\t\ttimeRangeId: timeRange.id,\n\t\t\t})\n\t\t}\n\n\t\t// Trigger calendar refresh\n\t\tcommit('incrementModificationCount')\n\t},\n\n\t/**\n\t * Deletes a calendar-object permanently\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {vobject} data.vobject Calendar-object to delete\n\t * @return {Promise<void>}\n\t */\n\tasync deleteCalendarObjectPermanently(context, { vobject }) {\n\t\tawait vobject.dav.delete({\n\t\t\t'X-NC-CalDAV-No-Trashbin': 1,\n\t\t})\n\n\t\tcontext.commit('removeDeletedCalendarObject', { vobject })\n\t},\n\n\t/**\n\t * Toggle whether a calendar is enabled\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to modify\n\t * @return {Promise}\n\t */\n\tasync toggleCalendarEnabled(context, { calendar }) {\n\t\tcontext.commit('markCalendarAsLoading', { calendar })\n\t\tcalendar.dav.enabled = !calendar.dav.enabled\n\n\t\ttry {\n\t\t\tawait calendar.dav.update()\n\t\t\tcontext.commit('markCalendarAsNotLoading', { calendar })\n\t\t\tcontext.commit('toggleCalendarEnabled', { calendar })\n\t\t} catch (error) {\n\t\t\tcontext.commit('markCalendarAsNotLoading', { calendar })\n\t\t\tthrow error\n\t\t}\n\t},\n\n\t/**\n\t * Rename a calendar\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to modify\n\t * @param {string} data.newName the new name of the calendar\n\t * @return {Promise}\n\t */\n\tasync renameCalendar(context, { calendar, newName }) {\n\t\tcalendar.dav.displayname = newName\n\n\t\tawait calendar.dav.update()\n\t\tcontext.commit('renameCalendar', { calendar, newName })\n\t},\n\n\t/**\n\t * Change a calendar's color\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to modify\n\t * @param {string} data.newColor the new color of the calendar\n\t * @return {Promise}\n\t */\n\tasync changeCalendarColor(context, { calendar, newColor }) {\n\t\tcalendar.dav.color = newColor\n\n\t\tawait calendar.dav.update()\n\t\tcontext.commit('changeCalendarColor', { calendar, newColor })\n\t},\n\n\t/**\n\t * Share calendar with User or Group\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to share\n\t * @param {string} data.user the userId\n\t * @param {string} data.displayName the displayName\n\t * @param {string} data.uri the sharing principalScheme uri\n\t * @param {boolean} data.isGroup is this a group?\n\t * @param {boolean} data.isCircle is this a circle?\n\t */\n\tasync shareCalendar(context, { calendar, user, displayName, uri, isGroup, isCircle }) {\n\t\t// Share calendar with entered group or user\n\t\tawait calendar.dav.share(uri)\n\t\tcontext.commit('shareCalendar', { calendar, user, displayName, uri, isGroup, isCircle })\n\t},\n\n\t/**\n\t * Toggle permissions of calendar Sharees writeable rights\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to change\n\t * @param {string} data.uri the sharing principalScheme uri\n\t */\n\tasync toggleCalendarShareWritable(context, { calendar, uri }) {\n\t\tconst sharee = calendar.shares.find(sharee => sharee.uri === uri)\n\t\tawait calendar.dav.share(uri, !sharee.writeable)\n\t\tcontext.commit('toggleCalendarShareWritable', { calendar, uri })\n\t},\n\n\t/**\n\t * Remove sharee from calendar\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to change\n\t * @param {string} data.uri the sharing principalScheme uri\n\t */\n\tasync unshareCalendar(context, { calendar, uri }) {\n\t\tawait calendar.dav.unshare(uri)\n\t\tcontext.commit('unshareCalendar', { calendar, uri })\n\t},\n\n\t/**\n\t * Publish a calendar\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to change\n\t * @return {Promise<void>}\n\t */\n\tasync publishCalendar(context, { calendar }) {\n\t\tawait calendar.dav.publish()\n\t\tconst publishURL = calendar.dav.publishURL\n\t\tcontext.commit('publishCalendar', { calendar, publishURL })\n\t},\n\n\t/**\n\t * Unpublish a calendar\n\t *\n\t * @param {object} context the store mutations Current context\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to change\n\t * @return {Promise<void>}\n\t */\n\tasync unpublishCalendar(context, { calendar }) {\n\t\tawait calendar.dav.unpublish()\n\t\tcontext.commit('unpublishCalendar', { calendar })\n\t},\n\n\t/**\n\t * Retrieve the events of the specified calendar\n\t * and commit the results\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {object} data.calendar the calendar to get events from\n\t * @param {Date} data.from the date to start querying events from\n\t * @param {Date} data.to the last date to query events from\n\t * @return {Promise<void>}\n\t */\n\tasync getEventsFromCalendarInTimeRange(context, { calendar, from, to }) {\n\t\tcontext.commit('markCalendarAsLoading', { calendar })\n\t\tconst response = await calendar.dav.findByTypeInTimeRange('VEVENT', from, to)\n\t\tlet responseTodo = []\n\t\tif (context.rootState.settings.showTasks) {\n\t\t\tresponseTodo = await calendar.dav.findByTypeInTimeRange('VTODO', from, to)\n\t\t}\n\t\tcontext.commit('addTimeRange', {\n\t\t\tcalendarId: calendar.id,\n\t\t\tfrom: getUnixTimestampFromDate(from),\n\t\t\tto: getUnixTimestampFromDate(to),\n\t\t\tlastFetched: getUnixTimestampFromDate(dateFactory()),\n\t\t\tcalendarObjectIds: [],\n\t\t})\n\t\tconst insertId = context.getters.getLastTimeRangeInsertId\n\t\tcontext.commit('addFetchedTimeRangeToCalendar', {\n\t\t\tcalendar,\n\t\t\tfetchedTimeRangeId: insertId,\n\t\t})\n\n\t\tconst calendarObjects = []\n\t\tconst calendarObjectIds = []\n\t\tfor (const r of response.concat(responseTodo)) {\n\t\t\ttry {\n\t\t\t\tconst calendarObject = mapCDavObjectToCalendarObject(r, calendar.id)\n\t\t\t\tcalendarObjects.push(calendarObject)\n\t\t\t\tcalendarObjectIds.push(calendarObject.id)\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(`could not convert calendar object of calendar ${calendar.id}`, e, {\n\t\t\t\t\tresponse: r,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tcontext.commit('appendCalendarObjects', { calendarObjects })\n\t\tcontext.commit('appendCalendarObjectsToCalendar', { calendar, calendarObjectIds })\n\t\tcontext.commit('appendCalendarObjectIdsToTimeFrame', {\n\t\t\ttimeRangeId: insertId,\n\t\t\tcalendarObjectIds,\n\t\t})\n\n\t\tcontext.commit('markCalendarAsNotLoading', { calendar })\n\t\treturn context.rootState.fetchedTimeRanges.lastTimeRangeInsertId\n\t},\n\n\t/**\n\t * Retrieve one object\n\t *\n\t * @param {object} context the store mutations\n\t * @param {object} data destructuring object\n\t * @param {string} data.objectId Id of the object to fetch\n\t * @return {Promise<CalendarObject>}\n\t */\n\tasync getEventByObjectId(context, { objectId }) {\n\t\t// TODO - we should still check if the calendar-object is up to date\n\t\t//  - Just send head and compare etags\n\t\tif (context.getters.getCalendarObjectById(objectId)) {\n\t\t\treturn Promise.resolve(context.getters.getCalendarObjectById(objectId))\n\t\t}\n\n\t\t// This might throw an exception, but we will leave it up to the methods\n\t\t// calling this action to properly handle it\n\t\tconst objectPath = atob(objectId)\n\t\tconst lastSlashIndex = objectPath.lastIndexOf('/')\n\t\tconst calendarPath = objectPath.slice(0, lastSlashIndex + 1)\n\t\tconst objectFileName = objectPath.slice(lastSlashIndex + 1)\n\n\t\tconst calendarId = btoa(calendarPath)\n\t\tif (!context.state.calendarsById[calendarId]) {\n\t\t\treturn Promise.reject(new Error(''))\n\t\t}\n\n\t\tconst calendar = context.state.calendarsById[calendarId]\n\t\tconst vObject = await calendar.dav.find(objectFileName)\n\t\tconst calendarObject = mapCDavObjectToCalendarObject(vObject, calendar.id)\n\t\tcontext.commit('appendCalendarObject', { calendarObject })\n\t\tcontext.commit('addCalendarObjectToCalendar', {\n\t\t\tcalendar: {\n\t\t\t\tid: calendarId,\n\t\t\t},\n\t\t\tcalendarObjectId: calendarObject.id,\n\t\t})\n\n\t\treturn calendarObject\n\t},\n\n\t/**\n\t * Import events into calendar\n\t *\n\t * @param {object} context the store mutations\n\t */\n\tasync importEventsIntoCalendar(context) {\n\t\tcontext.commit('changeStage', IMPORT_STAGE_IMPORTING)\n\n\t\t// Create a copy\n\t\tconst files = context.rootState.importFiles.importFiles.slice()\n\n\t\tlet totalCount = 0\n\t\tfor (const file of files) {\n\t\t\ttotalCount += file.parser.getItemCount()\n\n\t\t\tconst calendarId = context.rootState.importFiles.importCalendarRelation[file.id]\n\t\t\tif (calendarId === 'new') {\n\t\t\t\tconst displayName = file.parser.getName() || t('calendar', 'Imported {filename}', {\n\t\t\t\t\tfilename: file.name,\n\t\t\t\t})\n\t\t\t\tconst color = file.parser.getColor() || uidToHexColor(displayName)\n\t\t\t\tconst components = []\n\t\t\t\tif (file.parser.containsVEvents()) {\n\t\t\t\t\tcomponents.push('VEVENT')\n\t\t\t\t}\n\t\t\t\tif (file.parser.containsVJournals()) {\n\t\t\t\t\tcomponents.push('VJOURNAL')\n\t\t\t\t}\n\t\t\t\tif (file.parser.containsVTodos()) {\n\t\t\t\t\tcomponents.push('VTODO')\n\t\t\t\t}\n\n\t\t\t\tconst response = await createCalendar(displayName, color, components, 0)\n\t\t\t\tconst calendar = mapDavCollectionToCalendar(response, context.getters.getCurrentUserPrincipal)\n\t\t\t\tcontext.commit('addCalendar', { calendar })\n\t\t\t\tcontext.commit('setCalendarForFileId', {\n\t\t\t\t\tfileId: file.id,\n\t\t\t\t\tcalendarId: calendar.id,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tcontext.commit('setTotal', totalCount)\n\n\t\tconst limit = pLimit(3)\n\t\tconst requests = []\n\n\t\tfor (const file of files) {\n\t\t\tconst calendarId = context.rootState.importFiles.importCalendarRelation[file.id]\n\t\t\tconst calendar = context.getters.getCalendarById(calendarId)\n\n\t\t\tfor (const item of file.parser.getItemIterator()) {\n\t\t\t\trequests.push(limit(async () => {\n\t\t\t\t\tconst ics = item.toICS()\n\n\t\t\t\t\tlet davObject\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdavObject = await calendar.dav.createVObject(ics)\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tcontext.commit('incrementDenied')\n\t\t\t\t\t\tconsole.error(error)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tconst calendarObject = mapCDavObjectToCalendarObject(davObject, calendarId)\n\t\t\t\t\tcontext.commit('appendCalendarObject', { calendarObject })\n\t\t\t\t\tcontext.commit('addCalendarObjectToCalendar', {\n\t\t\t\t\t\tcalendar,\n\t\t\t\t\t\tcalendarObjectId: calendarObject.id,\n\t\t\t\t\t})\n\t\t\t\t\tcontext.commit('addCalendarObjectIdToAllTimeRangesOfCalendar', {\n\t\t\t\t\t\tcalendarId: calendar.id,\n\t\t\t\t\t\tcalendarObjectId: calendarObject.id,\n\t\t\t\t\t})\n\t\t\t\t\tcontext.commit('incrementAccepted')\n\t\t\t\t}))\n\t\t\t}\n\t\t}\n\n\t\tawait Promise.all(requests)\n\t\tcontext.commit('changeStage', IMPORT_STAGE_PROCESSING)\n\t},\n\t/**\n\t *\n\t * @param {object} context the store object\n\t * @param {object} context.commit the store mutations\n\t * @param {object} context.state the store state\n\t * @param {object} data The data destructuring object\n\t * @param {object} data.newOrder The object containing String => Number with the new order\n\t * @return {Promise<void>}\n\t */\n\tasync updateCalendarListOrder({ state, commit }, { newOrder }) {\n\t\t// keep a record of the original order in case we need to do a rollback\n\n\t\tconst limit = pLimit(3)\n\t\tconst requests = []\n\t\tconst calendarsToUpdate = []\n\n\t\tfor (const key in newOrder) {\n\t\t\trequests.push(limit(async () => {\n\t\t\t\tconst calendar = state.calendarsById[key]\n\n\t\t\t\t// Do not update unless necessary\n\t\t\t\tif (calendar.dav.order === newOrder[key]) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tcalendar.dav.order = newOrder[key]\n\n\t\t\t\tawait calendar.dav.update()\n\n\t\t\t\tcalendarsToUpdate.push({ calendar, newOrder: newOrder[key] })\n\t\t\t}))\n\t\t}\n\n\t\tawait Promise.all(requests)\n\n\t\tfor (const { calendar, newOrder } of calendarsToUpdate) {\n\t\t\tconsole.debug(calendar, newOrder)\n\t\t\tcommit('changeCalendarOrder', { calendar, newOrder })\n\t\t}\n\t},\n}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport Vue from 'vue'\n\nconst state = {\n\tcontacts: [],\n\tcontactByEMail: {},\n}\n\nconst mutations = {\n\n\t/**\n\t * Append a single contact to the store\n\t *\n\t * @param {object} state The store data\n\t * @param {object} data The destructuring object\n\t * @param {object} data.contact The contact to append to the store\n\t */\n\tappendContact(state, { contact }) {\n\t\tif (state.contacts.indexOf(contact) === -1) {\n\t\t\tstate.contacts.push(contact)\n\t\t}\n\n\t\tfor (const email of contact.emails) {\n\t\t\t// In the unlikely case that multiple contacts\n\t\t\t// share the same email address, we will just follow\n\t\t\t// first come, first served.\n\t\t\tif (state.contactByEMail[email] === undefined) {\n\t\t\t\tVue.set(state.contactByEMail, email, contact)\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Removes a single contact from the store\n\t *\n\t * @param {object} state The store data\n\t * @param {object} data The destructuring object\n\t * @param {object} data.contact The contact to remove from the store\n\t */\n\tremoveContact(state, { contact }) {\n\t\tfor (const email of contact.emails) {\n\t\t\tif (state.contactByEMail[email] === contact) {\n\t\t\t\tVue.delete(state.contactByEMail, email)\n\t\t\t}\n\t\t}\n\n\t\tconst index = state.contacts.indexOf(contact)\n\t\tif (index !== -1) {\n\t\t\tstate.contacts.splice(index, 1)\n\t\t}\n\t},\n}\n\nconst getters = {}\n\nconst actions = {}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2020 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nconst state = {\n\tminimumDate: '1970-01-01T00:00:00Z',\n\tmaximumDate: '2037-12-31T23:59:59Z',\n}\n\nconst mutations = {\n\n\t/**\n\t * Initialize restrictions imposed by CalDAV server\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.minimumDate The minimum-date allowed by the CalDAV server\n\t * @param {string} data.maximumDate The maximum-date allowed by the CalDAV server\n\t */\n\tloadDavRestrictionsFromServer(state, { minimumDate, maximumDate }) {\n\t\tstate.minimumDate = minimumDate\n\t\tstate.maximumDate = maximumDate\n\t},\n}\n\nconst getters = {}\n\nconst actions = {}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport Vue from 'vue'\n\nconst state = {\n\tlastTimeRangeInsertId: -1,\n\tfetchedTimeRanges: [],\n\tfetchedTimeRangesById: {},\n}\n\nconst mutations = {\n\n\t/**\n\t * Adds a fetched time-range to the state\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.calendarId Calendar-id which objects have been fetched\n\t * @param {number} data.from timestamp of start\n\t * @param {number} data.to timestamp of end\n\t * @param {number} data.lastFetched timestamp of last-fetched\n\t * @param {string[]} data.calendarObjectIds array of calendarObjectIds\n\t */\n\taddTimeRange(state, { calendarId, from, to, lastFetched, calendarObjectIds }) {\n\t\tconst fetchedTimeRange = {\n\t\t\tid: ++state.lastTimeRangeInsertId,\n\t\t\tcalendarId,\n\t\t\tfrom,\n\t\t\tto,\n\t\t\tlastFetched,\n\t\t\tcalendarObjectIds,\n\t\t}\n\n\t\tstate.fetchedTimeRanges.push(fetchedTimeRange)\n\t\tVue.set(state.fetchedTimeRangesById, fetchedTimeRange.id, fetchedTimeRange)\n\t},\n\n\t/**\n\t * Removes a fetched time-range from the state\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {number} data.timeRangeId Id of time-range to remove\n\t */\n\tremoveTimeRange(state, { timeRangeId }) {\n\t\tconst obj = state.fetchedTimeRangesById[timeRangeId]\n\t\tconst index = state.fetchedTimeRanges.indexOf(obj)\n\n\t\tif (index !== -1) {\n\t\t\tstate.fetchedTimeRanges.splice(index, 1)\n\t\t\tVue.delete(state.fetchedTimeRangesById, timeRangeId)\n\t\t}\n\t},\n\n\t/**\n\t * Adds a calendar-object-id to an already fetched time-range\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {number} data.timeRangeId The id of the time-range\n\t * @param {string[]} data.calendarObjectIds The array of ids of the calendar-object to add\n\t */\n\tappendCalendarObjectIdsToTimeFrame(state, { timeRangeId, calendarObjectIds }) {\n\t\tfor (const calendarObjectId of calendarObjectIds) {\n\t\t\tif (state.fetchedTimeRangesById[timeRangeId].calendarObjectIds.indexOf(calendarObjectId) === -1) {\n\t\t\t\tstate.fetchedTimeRangesById[timeRangeId].calendarObjectIds.push(calendarObjectId)\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Adds a calendar-object-id to an already fetched time-range\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {number} data.timeRangeId The id of the time-range\n\t * @param {string} data.calendarObjectId The id of the calendar-object to add\n\t */\n\tappendCalendarObjectIdToTimeRange(state, { timeRangeId, calendarObjectId }) {\n\t\tstate.fetchedTimeRangesById[timeRangeId].calendarObjectIds.push(calendarObjectId)\n\t},\n\n\t/**\n\t * Removes a calendar-object-id from an already fetched time-range\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {number} data.timeRangeId The id of the timerange\n\t * @param {string} data.calendarObjectId The id of the calendar-object to remove\n\t */\n\tremoveCalendarObjectIdFromTimeRange(state, { timeRangeId, calendarObjectId }) {\n\t\tconst index = state.fetchedTimeRangesById[timeRangeId]\n\t\t\t.calendarObjectIds\n\t\t\t.indexOf(calendarObjectId)\n\t\tif (index !== -1) {\n\t\t\tstate.fetchedTimeRangesById[timeRangeId]\n\t\t\t\t.calendarObjectIds\n\t\t\t\t.splice(index, 1)\n\t\t}\n\t},\n\n\t/**\n\t * Removes a calendar-object-id from any time-range it may occur in\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.calendarObjectId The id of the calendar-object to remove\n\t */\n\tremoveCalendarObjectIdFromAnyTimeRange(state, { calendarObjectId }) {\n\t\tfor (const timeRange of state.fetchedTimeRanges) {\n\t\t\tconst index = timeRange\n\t\t\t\t.calendarObjectIds\n\t\t\t\t.indexOf(calendarObjectId)\n\t\t\tif (index !== -1) {\n\t\t\t\ttimeRange\n\t\t\t\t\t.calendarObjectIds\n\t\t\t\t\t.splice(index, 1)\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Updates the last-fetched timestamp of a time-range\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {number} data.timeRangeId The id of the timerange\n\t * @param {number} data.lastFetched Timestamp of last-fetched\n\t */\n\tupdateTimestampOfLastFetched(state, { timeRangeId, lastFetched }) {\n\t\tstate.fetchedTimeRangesById[timeRangeId].lastFetched = lastFetched\n\t},\n\n\t/**\n\t * Adds a calendar-object-id to all time-ranges of a given caloendar\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.calendarObjectId The id of the calendar-object\n\t * @param {string} data.calendarId The id of the calendar\n\t */\n\taddCalendarObjectIdToAllTimeRangesOfCalendar(state, { calendarObjectId, calendarId }) {\n\t\tfor (const timerange of state.fetchedTimeRanges) {\n\t\t\tif (timerange.calendarId !== calendarId) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (timerange.calendarObjectIds.indexOf(calendarObjectId) === -1) {\n\t\t\t\ttimerange.calendarObjectIds.push(calendarObjectId)\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Removes a calendar-object-id to all time-ranges of a given caloendar\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.calendarObjectId The id of the calendar-object\n\t * @param {string} data.calendarId The id of the calendar\n\t */\n\tremoveCalendarObjectIdFromAllTimeRangesOfCalendar(state, { calendarObjectId, calendarId }) {\n\t\tfor (const timerange of state.fetchedTimeRanges) {\n\t\t\tif (timerange.calendarId !== calendarId) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tconst index = timerange.calendarObjectIds.indexOf(calendarObjectId)\n\t\t\tif (index !== -1) {\n\t\t\t\ttimerange.calendarObjectIds.splice(index, 1)\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * clear FetchedTimeRanges Store\n\t *\n\t * @param {object} state The vuex state\n\t */\n\tclearFetchedTimeRanges(state) {\n\t\tstate.lastTimeRangeInsertId = -1\n\t\tstate.fetchedTimeRanges = []\n\t\tstate.fetchedTimeRangesById = {}\n\t},\n}\n\nconst getters = {\n\n\t/**\n\t * Get all time-ranges for a calendar\n\t *\n\t * @param {object} state The vuex state\n\t * @return {function({String}): {Object}[]}\n\t */\n\tgetAllTimeRangesForCalendar: (state) => (calendarId) =>\n\t\tstate.fetchedTimeRanges.filter(f => (f.calendarId === calendarId)),\n\n\t/**\n\t * Get time-range covering\n\t *\n\t * @param {object} state The vuex state\n\t * @return {function({Number}, {Number}, {Number}): {Object}|false}\n\t */\n\tgetTimeRangeForCalendarCoveringRange: (state) => (calendarId, requestedFrom, requestedTo) => {\n\t\treturn state.fetchedTimeRanges.find(f => {\n\t\t\treturn f.calendarId === calendarId && f.from <= requestedFrom && f.to >= requestedTo\n\t\t})\n\t},\n\n\t/**\n\t * Get all time-ranges that have been last fetched before a given time\n\t *\n\t * @param {object} state The vuex state\n\t * @return {function({Number}): {Object}[]}\n\t */\n\tgetAllTimeRangesOlderThan: (state) => (olderThan) =>\n\t\tstate.fetchedTimeRanges.filter(f => (f.lastFetched <= olderThan)),\n\n\t/**\n\t *\n\t * @param {object} state The vuex state\n\t * @return {number}\n\t */\n\tgetLastTimeRangeInsertId: (state) => state.lastTimeRangeInsertId,\n\n\t/**\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} getters The vuex getters\n\t * @return {function({Number}): {CalendarObject}[]}\n\t */\n\tgetCalendarObjectsByTimeRangeId: (state, getters) => (timeRangeId) => {\n\t\tif (!state.fetchedTimeRangesById[timeRangeId]) {\n\t\t\treturn []\n\t\t}\n\n\t\treturn state.fetchedTimeRangesById[timeRangeId].calendarObjectIds.map((calendarObjectId) => {\n\t\t\treturn getters.getCalendarObjectById(calendarObjectId)\n\t\t})\n\t},\n}\n\nconst actions = {}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2019 Team Popcorn <teampopcornberlin@gmail.com>\n *\n * @copyright Copyright (c) 2020 Georg Ehrke\n *\n * @author Team Popcorn <teampopcornberlin@gmail.com>\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport Vue from 'vue'\n\nconst state = {\n\tlastFileInsertId: -1,\n\timportFiles: [],\n\timportFilesById: {},\n\timportCalendarRelation: {},\n}\n\nconst mutations = {\n\n\t/**\n\t * Adds a file to the state\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.contents Contents of file\n\t * @param {number} data.lastModified Timestamp of last modification\n\t * @param {string} data.name Name of file\n\t * @param {AbstractParser} data.parser The parser\n\t * @param {number} data.size Size of file\n\t * @param {string} data.type mime-type of file\n\t */\n\taddFile(state, { contents, lastModified, name, parser, size, type }) {\n\t\tconst file = {\n\t\t\tid: ++state.lastFileInsertId,\n\t\t\tcontents,\n\t\t\tlastModified,\n\t\t\tname,\n\t\t\tparser,\n\t\t\tsize,\n\t\t\ttype,\n\t\t}\n\n\t\tstate.importFiles.push(file)\n\t\tVue.set(state.importFilesById, file.id, file)\n\t},\n\n\t/**\n\t * Sets a calendar for the file\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {number} data.fileId Id of file to select calendar for\n\t * @param {string} data.calendarId Id of calendar to import file into\n\t */\n\tsetCalendarForFileId(state, { fileId, calendarId }) {\n\t\tVue.set(state.importCalendarRelation, fileId, calendarId)\n\t},\n\n\t/**\n\t * Removes all files from state\n\t *\n\t * @param {object} state The vuex state\n\t */\n\tremoveAllFiles(state) {\n\t\tVue.set(state, 'importFiles', [])\n\t\tVue.set(state, 'importFilesById', {})\n\t\tVue.set(state, 'importCalendarRelation', {})\n\t},\n}\n\nconst getters = {}\n\nconst actions = {}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2019 Team Popcorn <teampopcornberlin@gmail.com>\n *\n * @copyright Copyright (c) 2020 Georg Ehrke\n *\n * @author Team Popcorn <teampopcornberlin@gmail.com>\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { IMPORT_STAGE_DEFAULT } from '../models/consts.js'\n\nconst state = {\n\ttotal: 0,\n\taccepted: 0,\n\tdenied: 0,\n\tstage: IMPORT_STAGE_DEFAULT,\n}\n\nconst mutations = {\n\n\t/**\n\t * Increment the number of calendar-objects accepted\n\t *\n\t * @param {object} state the store data\n\t */\n\tincrementAccepted(state) {\n\t\tstate.accepted++\n\t},\n\n\t/**\n\t * Increment the number of calendar-objects denied\n\t *\n\t * @param {object} state the store data\n\t */\n\tincrementDenied(state) {\n\t\tstate.denied++\n\t},\n\n\t/**\n\t * Set the total number of calendar-objects\n\t *\n\t * @param {object} state the store data\n\t * @param {number} total the total number of calendar-objects to import\n\t */\n\tsetTotal(state, total) {\n\t\tstate.total = total\n\t},\n\n\t/**\n\t * Change stage to the indicated one\n\t *\n\t * @param {object} state the store data\n\t * @param {string} stage the name of the stage, see /src/models/consts.js\n\t */\n\tchangeStage(state, stage) {\n\t\tstate.stage = stage\n\t},\n\n\t/**\n\t * Reset to the default state\n\t *\n\t * @param {object} state the store data\n\t */\n\tresetState(state) {\n\t\tstate.total = 0\n\t\tstate.accepted = 0\n\t\tstate.denied = 0\n\t\tstate.stage = IMPORT_STAGE_DEFAULT\n\t},\n}\n\nconst getters = {}\nconst actions = {}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @author John Molakvo <skjnldsv@protonmail.com>\n *\n * @author Thomas Citharel <tcit@tcit.fr>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport Vue from 'vue'\nimport Vuex from 'vuex'\n\nimport calendarObjectInstance from './calendarObjectInstance.js'\nimport calendarObjects from './calendarObjects.js'\nimport calendars from './calendars.js'\nimport contacts from './contacts.js'\nimport davRestrictions from './davRestrictions.js'\nimport fetchedTimeRanges from './fetchedTimeRanges.js'\nimport importFiles from './importFiles.js'\nimport importState from './importState.js'\nimport principals from './principals.js'\nimport settings from './settings.js'\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({\n\tmodules: {\n\t\tcalendarObjectInstance,\n\t\tcalendarObjects,\n\t\tcalendars,\n\t\tcontacts,\n\t\tdavRestrictions,\n\t\tfetchedTimeRanges,\n\t\timportFiles,\n\t\timportState,\n\t\tprincipals,\n\t\tsettings,\n\t},\n\t// // Throw errors when the state is edited outside of mutations\n\t// strict: true\n})\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport Vue from 'vue'\nimport {\n\tfindPrincipalByUrl,\n\tgetCurrentUserPrincipal,\n} from '../services/caldavService.js'\nimport logger from '../utils/logger.js'\nimport {\n\tgetDefaultPrincipalObject,\n\tmapDavToPrincipal,\n} from '../models/principal.js'\n\nconst state = {\n\tprincipals: [],\n\tprincipalsById: {},\n\tcurrentUserPrincipal: null,\n}\n\nconst mutations = {\n\n\t/**\n\t * Adds a principal to the state\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.principal The principal to add\n\t */\n\taddPrincipal(state, { principal }) {\n\t\tconst object = getDefaultPrincipalObject(principal)\n\n\t\tif (state.principalsById[object.id]) {\n\t\t\treturn\n\t\t}\n\n\t\tstate.principals.push(object)\n\t\tVue.set(state.principalsById, object.id, object)\n\t},\n\n\t/**\n\t * Adds the current user principal to the state\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data destructuring object\n\t * @param {string} data.principalId principalId of the current-user-principal\n\t */\n\tsetCurrentUserPrincipal(state, { principalId }) {\n\t\tstate.currentUserPrincipal = principalId\n\t},\n\n\t/**\n\t * Changes the schedule-default-calendar-URL of a principal\n\t *\n\t * @param {object} state The vuex state\n\t * @param {object} data The destructuring object\n\t * @param {object} data.principal The principal to modify\n\t * @param {string} data.scheduleDefaultCalendarUrl The new schedule-default-calendar-URL\n\t */\n\tchangePrincipalScheduleDefaultCalendarUrl(state, { principal, scheduleDefaultCalendarUrl }) {\n\t\tVue.set(\n\t\t\tstate.principalsById[principal.id],\n\t\t\t'scheduleDefaultCalendarUrl',\n\t\t\tscheduleDefaultCalendarUrl,\n\t\t)\n\t},\n}\n\nconst getters = {\n\n\t/**\n\t * Gets a principal object by its url\n\t *\n\t * @param {object} state the store data\n\t * @return {function({String}): {Object}}\n\t */\n\tgetPrincipalByUrl: (state) => (url) => state.principals.find((principal) => principal.url === url),\n\n\t/**\n\t * Gets a principal object by its id\n\t *\n\t * @param {object} state the store data\n\t * @return {function({String}): {Object}}\n\t */\n\tgetPrincipalById: (state) => (id) => state.principalsById[id],\n\n\t/**\n\t * Gets the principal object of the current-user-principal\n\t *\n\t * @param {object} state the store data\n\t * @return {{Object}}\n\t */\n\tgetCurrentUserPrincipal: (state) => state.principalsById[state.currentUserPrincipal],\n\n\t/**\n\t * Gets the email-address of the current-user-principal\n\t *\n\t * @param {object} state the store data\n\t * @return {string|undefined}\n\t */\n\tgetCurrentUserPrincipalEmail: (state) => state.principalsById[state.currentUserPrincipal]?.emailAddress,\n}\n\nconst actions = {\n\n\t/**\n\t * Fetches a principal from the DAV server and commits it to the state\n\t *\n\t * @param {object} context The vuex context\n\t * @param {string} url The URL of the principal\n\t * @return {Promise<void>}\n\t */\n\tasync fetchPrincipalByUrl(context, { url }) {\n\t\t// Don't refetch principals we already have\n\t\tif (context.getters.getPrincipalByUrl(url)) {\n\t\t\treturn\n\t\t}\n\n\t\tconst principal = await findPrincipalByUrl(url)\n\t\tif (!principal) {\n\t\t\t// TODO - handle error\n\t\t\treturn\n\t\t}\n\n\t\tcontext.commit('addPrincipal', {\n\t\t\tprincipal: mapDavToPrincipal(principal),\n\t\t})\n\t},\n\n\t/**\n\t * Fetches the current-user-principal\n\t *\n\t * @param {object} context The vuex context\n\t * @return {Promise<void>}\n\t */\n\tasync fetchCurrentUserPrincipal(context) {\n\t\tconst currentUserPrincipal = getCurrentUserPrincipal()\n\t\tif (!currentUserPrincipal) {\n\t\t\t// TODO - handle error\n\t\t\treturn\n\t\t}\n\n\t\tconst principal = mapDavToPrincipal(currentUserPrincipal)\n\t\tcontext.commit('addPrincipal', { principal })\n\t\tcontext.commit('setCurrentUserPrincipal', { principalId: principal.id })\n\t\tlogger.debug(`Current user principal is ${principal.url}`)\n\t},\n\n\t/**\n\t * Change a principal's schedule-default-calendar-URL\n\t *\n\t * @param {object} context The vuex context\n\t * @param {object} data The destructuring object\n\t * @param {object} data.principal The principal to modify\n\t * @param {string} data.scheduleDefaultCalendarUrl The new schedule-default-calendar-URL\n\t * @return {Promise<void>}\n\t */\n\tasync changePrincipalScheduleDefaultCalendarUrl(context, { principal, scheduleDefaultCalendarUrl }) {\n\t\tprincipal.dav.scheduleDefaultCalendarUrl = scheduleDefaultCalendarUrl\n\n\t\tawait principal.dav.update()\n\t\tcontext.commit('changePrincipalScheduleDefaultCalendarUrl', {\n\t\t\tprincipal,\n\t\t\tscheduleDefaultCalendarUrl,\n\t\t})\n\t},\n}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2020 Georg Ehrke\n * @copyright Copyright (c) 2022 Informatyka Boguslawski sp. z o.o. sp.k., http://www.ib.pl/\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n * @author Richard Steinmetz <richard@steinmetz.cloud>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { enableBirthdayCalendar } from '../services/caldavService.js'\nimport { mapDavCollectionToCalendar } from '../models/calendar.js'\nimport { detectTimezone } from '../services/timezoneDetectionService.js'\nimport { setConfig as setCalendarJsConfig } from '@nextcloud/calendar-js'\nimport { setConfig } from '../services/settings.js'\nimport { logInfo } from '../utils/logger.js'\nimport getTimezoneManager from '../services/timezoneDataProviderService.js'\nimport * as AttachmentService from '../services/attachmentService.js'\n\nconst state = {\n\t// env\n\tappVersion: null,\n\tfirstRun: null,\n\ttalkEnabled: false,\n\tdisableAppointments: false,\n\tpublicCalendars: null,\n\t// user-defined calendar settings\n\teventLimit: null,\n\tshowTasks: null,\n\tshowWeekends: null,\n\tshowWeekNumbers: null,\n\tskipPopover: null,\n\tslotDuration: null,\n\tdefaultReminder: null,\n\ttasksEnabled: false,\n\ttimezone: 'automatic',\n\thideEventExport: false,\n\tforceEventAlarmType: false,\n\tcanSubscribeLink: true,\n\tshowResources: true,\n\t// user-defined Nextcloud settings\n\tmomentLocale: 'en',\n\tattachmentsFolder: '/Calendar',\n\tattachmentsFolderCreated: false,\n}\n\nconst mutations = {\n\n\t/**\n\t * Updates the user's setting for event limit\n\t *\n\t * @param {object} state The Vuex state\n\t */\n\ttoggleEventLimitEnabled(state) {\n\t\tstate.eventLimit = !state.eventLimit\n\t},\n\n\t/**\n\t * Updates the user's setting for visibility of event popover\n\t *\n\t * @param {object} state The Vuex state\n\t */\n\ttogglePopoverEnabled(state) {\n\t\tstate.skipPopover = !state.skipPopover\n\t},\n\n\t/**\n\t * Updates the user's setting for visibility of weekends\n\t *\n\t * @param {object} state The Vuex state\n\t */\n\ttoggleTasksEnabled(state) {\n\t\tstate.showTasks = !state.showTasks\n\t},\n\n\t/**\n\t * Updates the user's setting for visibility of weekends\n\t *\n\t * @param {object} state The Vuex state\n\t */\n\ttoggleWeekendsEnabled(state) {\n\t\tstate.showWeekends = !state.showWeekends\n\t},\n\n\t/**\n\t * Updates the user's setting for visibility of week numbers\n\t *\n\t * @param {object} state The Vuex state\n\t */\n\ttoggleWeekNumberEnabled(state) {\n\t\tstate.showWeekNumbers = !state.showWeekNumbers\n\t},\n\n\t/**\n\t * Updates the user's preferred slotDuration\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.slotDuration The new slot duration\n\t */\n\tsetSlotDuration(state, { slotDuration }) {\n\t\tstate.slotDuration = slotDuration\n\t},\n\n\t/**\n\t * Updates the user's preferred defaultReminder\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.defaultReminder The new default reminder length\n\t */\n\t setDefaultReminder(state, { defaultReminder }) {\n\t\tstate.defaultReminder = defaultReminder\n\t},\n\n\t/**\n\t * Updates the user's timezone\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.timezoneId The new timezone\n\t */\n\tsetTimezone(state, { timezoneId }) {\n\t\tstate.timezone = timezoneId\n\t},\n\n\t/**\n\t * Updates the user's attachments folder\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.attachmentsFolder The new attachments folder\n\t */\n\tsetAttachmentsFolder(state, { attachmentsFolder }) {\n\t\tstate.attachmentsFolder = attachmentsFolder\n\t\tstate.attachmentsFolderCreated = false\n\t},\n\n\t/**\n\t * Update wheter the user's attachments folder has been created\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {boolean} data.attachmentsFolderCreated True if the folder has been created\n\t */\n\tsetAttachmentsFolderCreated(state, { attachmentsFolderCreated }) {\n\t\tstate.attachmentsFolderCreated = attachmentsFolderCreated\n\t},\n\n\t/**\n\t * Initialize settings\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.appVersion The version of the Nextcloud app\n\t * @param {boolean} data.eventLimit Whether or not to limit number of visible events in grid view\n\t * @param {boolean} data.firstRun Whether or not this is the first run\n\t * @param {boolean} data.showWeekNumbers Whether or not to show week numbers\n\t * @param {boolean} data.showTasks Whether or not to display tasks with a due-date\n\t * @param {boolean} data.showWeekends Whether or not to display weekends\n\t * @param {boolean} data.skipPopover Whether or not to skip the simple event popover\n\t * @param {string} data.slotDuration The duration of one slot in the agendaView\n\t * @param {string} data.defaultReminder The default reminder to set on newly created events\n\t * @param {boolean} data.talkEnabled Whether or not the talk app is enabled\n\t * @param {boolean} data.tasksEnabled Whether ot not the tasks app is enabled\n\t * @param {string} data.timezone The timezone to view the calendar in. Either an Olsen timezone or \"automatic\"\n\t * @param {boolean} data.hideEventExport\n\t * @param {string} data.forceEventAlarmType\n\t * @param {boolean} data.disableAppointments Allow to disable the appointments feature\n\t * @param {boolean} data.canSubscribeLink\n\t * @param {string} data.attachmentsFolder Default user's attachments folder\n\t * @param {boolean} data.showResources Show or hide the resources tab\n\t * @param {string} data.publicCalendars\n\t */\n\tloadSettingsFromServer(state, { appVersion, eventLimit, firstRun, showWeekNumbers, showTasks, showWeekends, skipPopover, slotDuration, defaultReminder, talkEnabled, tasksEnabled, timezone, hideEventExport, forceEventAlarmType, disableAppointments, canSubscribeLink, attachmentsFolder, showResources, publicCalendars }) {\n\t\tlogInfo(`\nInitial settings:\n\t- AppVersion: ${appVersion}\n\t- EventLimit: ${eventLimit}\n\t- FirstRun: ${firstRun}\n\t- ShowWeekNumbers: ${showWeekNumbers}\n\t- ShowTasks: ${showTasks}\n\t- ShowWeekends: ${showWeekends}\n\t- SkipPopover: ${skipPopover}\n\t- SlotDuration: ${slotDuration}\n\t- DefaultReminder: ${defaultReminder}\n\t- TalkEnabled: ${talkEnabled}\n\t- TasksEnabled: ${tasksEnabled}\n\t- Timezone: ${timezone}\n\t- HideEventExport: ${hideEventExport}\n\t- ForceEventAlarmType: ${forceEventAlarmType}\n\t- disableAppointments: ${disableAppointments}\n\t- CanSubscribeLink: ${canSubscribeLink}\n\t- attachmentsFolder: ${attachmentsFolder}\n\t- ShowResources: ${showResources}\n\t- PublicCalendars: ${publicCalendars}\n`)\n\n\t\tstate.appVersion = appVersion\n\t\tstate.eventLimit = eventLimit\n\t\tstate.firstRun = firstRun\n\t\tstate.showWeekNumbers = showWeekNumbers\n\t\tstate.showTasks = showTasks\n\t\tstate.showWeekends = showWeekends\n\t\tstate.skipPopover = skipPopover\n\t\tstate.slotDuration = slotDuration\n\t\tstate.defaultReminder = defaultReminder\n\t\tstate.talkEnabled = talkEnabled\n\t\tstate.tasksEnabled = tasksEnabled\n\t\tstate.timezone = timezone\n\t\tstate.hideEventExport = hideEventExport\n\t\tstate.forceEventAlarmType = forceEventAlarmType\n\t\tstate.disableAppointments = disableAppointments\n\t\tstate.canSubscribeLink = canSubscribeLink\n\t\tstate.attachmentsFolder = attachmentsFolder\n\t\tstate.showResources = showResources\n\t\tstate.publicCalendars = publicCalendars\n\t},\n\n\t/**\n\t * Sets the name of the moment.js locale to be used\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} data The destructuring object\n\t * @param {string} data.locale The moment.js locale to be used\n\t */\n\tsetMomentLocale(state, { locale }) {\n\t\tlogInfo(`Updated moment locale: ${locale}`)\n\n\t\tstate.momentLocale = locale\n\t},\n}\n\nconst getters = {\n\n\tisTalkEnabled: (state) => state.talkEnabled,\n\n\t/**\n\t * Gets the resolved timezone.\n\t * If the timezone is set to automatic, it returns the user's current timezone\n\t * Otherwise, it returns the Olsen timezone stored\n\t *\n\t * @param {object} state The Vuex state\n\t * @return {string}\n\t */\n\tgetResolvedTimezone: (state) => state.timezone === 'automatic'\n\t\t? detectTimezone()\n\t\t: state.timezone,\n\n\t/**\n\t * Gets the resolved timezone object.\n\t * Falls back to UTC if timezone is invalid.\n\t *\n\t * @param {object} state The Vuex state\n\t * @param {object} getters The vuex getters\n\t * @return {object} The calendar-js timezone object\n\t */\n\tgetResolvedTimezoneObject: (state, getters) => {\n\t\tconst timezone = getters.getResolvedTimezone\n\t\tlet timezoneObject = getTimezoneManager().getTimezoneForId(timezone)\n\t\tif (!timezoneObject) {\n\t\t\ttimezoneObject = getTimezoneManager().getTimezoneForId('UTC')\n\t\t}\n\t\treturn timezoneObject\n\t},\n}\n\nconst actions = {\n\n\t/**\n\t * Updates the user's setting for visibility of birthday calendar\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.getters The Vuex Getters\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @param {Function} vuex.dispatch The Vuex dispatch Function\n\t * @return {Promise<void>}\n\t */\n\tasync toggleBirthdayCalendarEnabled({ getters, commit, dispatch }) {\n\t\tif (getters.hasBirthdayCalendar) {\n\t\t\tconst calendar = getters.getBirthdayCalendar\n\t\t\tawait dispatch('deleteCalendar', { calendar })\n\t\t} else {\n\t\t\tconst davCalendar = await enableBirthdayCalendar()\n\t\t\tconst calendar = mapDavCollectionToCalendar(davCalendar)\n\t\t\tcommit('addCalendar', { calendar })\n\t\t}\n\t},\n\n\t/**\n\t * Updates the user's setting for event limit\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @return {Promise<void>}\n\t */\n\tasync toggleEventLimitEnabled({ state, commit }) {\n\t\tconst newState = !state.eventLimit\n\t\tconst value = newState ? 'yes' : 'no'\n\n\t\tawait setConfig('eventLimit', value)\n\t\tcommit('toggleEventLimitEnabled')\n\t},\n\n\t/**\n\t * Updates the user's setting for visibility of event popover\n\t *\n\t * @param {object} context The Vuex context\n\t * @param {object} context.state The store state\n\t * @param {object} context.commit The store mutations\n\t * @return {Promise<void>}\n\t */\n\tasync togglePopoverEnabled({ state, commit }) {\n\t\tconst newState = !state.skipPopover\n\t\tconst value = newState ? 'yes' : 'no'\n\n\t\tawait setConfig('skipPopover', value)\n\t\tcommit('togglePopoverEnabled')\n\t},\n\n\t/**\n\t * Updates the user's setting for visibility of weekends\n\t *\n\t * @param {object} context The Vuex context\n\t * @param {object} context.state The store state\n\t * @param {object} context.commit The store mutations\n\t * @return {Promise<void>}\n\t */\n\tasync toggleWeekendsEnabled({ state, commit }) {\n\t\tconst newState = !state.showWeekends\n\t\tconst value = newState ? 'yes' : 'no'\n\n\t\tawait setConfig('showWeekends', value)\n\t\tcommit('toggleWeekendsEnabled')\n\t},\n\n\t/**\n\t * Updates the user's setting for visibility of tasks\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @return {Promise<void>}\n\t */\n\tasync toggleTasksEnabled({ state, commit }) {\n\t\tconst newState = !state.showTasks\n\t\tconst value = newState ? 'yes' : 'no'\n\n\t\tawait setConfig('showTasks', value)\n\t\tcommit('toggleTasksEnabled')\n\t\tcommit('clearFetchedTimeRanges')\n\t\tcommit('incrementModificationCount')\n\t},\n\n\t/**\n\t * Updates the user's setting for visibility of week numbers\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @return {Promise<void>}\n\t */\n\tasync toggleWeekNumberEnabled({ state, commit }) {\n\t\tconst newState = !state.showWeekNumbers\n\t\tconst value = newState ? 'yes' : 'no'\n\n\t\tawait setConfig('showWeekNr', value)\n\t\tcommit('toggleWeekNumberEnabled')\n\t},\n\n\t/**\n\t * Updates the view to be used as initial view when opening\n\t * the calendar app again\n\t *\n\t * @param {object} context The Vuex destructuring object\n\t * @param {object} data The destructuring object\n\t * @param {string} data.initialView New view to be used as initial view\n\t * @return {Promise<void>}\n\t */\n\tasync setInitialView(context, { initialView }) {\n\t\tawait setConfig('view', initialView)\n\t},\n\n\t/**\n\t * Updates the user's preferred slotDuration\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @param {object} data The destructuring object\n\t * @param {string} data.slotDuration The new slot duration\n\t */\n\tasync setSlotDuration({ state, commit }, { slotDuration }) {\n\t\tif (state.slotDuration === slotDuration) {\n\t\t\treturn\n\t\t}\n\n\t\tawait setConfig('slotDuration', slotDuration)\n\t\tcommit('setSlotDuration', { slotDuration })\n\t},\n\n\t/**\n\t * Updates the user's preferred defaultReminder\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @param {object} data The destructuring object\n\t * @param {string} data.defaultReminder The new default reminder\n\t */\n\tasync setDefaultReminder({ state, commit }, { defaultReminder }) {\n\t\tif (state.defaultReminder === defaultReminder) {\n\t\t\treturn\n\t\t}\n\n\t\tawait setConfig('defaultReminder', defaultReminder)\n\t\tcommit('setDefaultReminder', { defaultReminder })\n\t},\n\n\t/**\n\t * Updates the user's timezone\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @param {object} data The destructuring object\n\t * @param {string} data.timezoneId The new timezone\n\t * @return {Promise<void>}\n\t */\n\tasync setTimezone({ state, commit }, { timezoneId }) {\n\t\tif (state.timezone === timezoneId) {\n\t\t\treturn\n\t\t}\n\n\t\tawait setConfig('timezone', timezoneId)\n\t\tcommit('setTimezone', { timezoneId })\n\t},\n\n\t/**\n\t * Updates the user's attachments folder\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @param {object} data The destructuring object\n\t * @param {string} data.attachmentsFolder The new attachments folder\n\t * @return {Promise<void>}\n\t */\n\tasync setAttachmentsFolder({ state, commit }, { attachmentsFolder }) {\n\t\tif (state.attachmentsFolder === attachmentsFolder) {\n\t\t\treturn\n\t\t}\n\n\t\tawait setConfig('attachmentsFolder', attachmentsFolder)\n\t\tcommit('setAttachmentsFolder', { attachmentsFolder })\n\t},\n\n\t/**\n\t * Create the user's attachment folder if it doesn't exist and return its path\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t * @param {Function} vuex.commit The Vuex commit Function\n\t * @param {Function} vuex.dispatch The Vuex commit function\n\t * @param {object} vuex.getters The Vuex getters object\n\t * @return {Promise<string>} The path of the user's attachments folder\n\t */\n\tasync createAttachmentsFolder({ state, commit, dispatch, getters }) {\n\t\tif (state.attachmentsFolderCreated) {\n\t\t\treturn state.attachmentsFolder\n\t\t}\n\n\t\tconst userId = getters.getCurrentUserPrincipal.dav.userId\n\t\tconst path = await AttachmentService.createFolder(state.attachmentsFolder, userId)\n\t\tif (path !== state.attachmentsFolder) {\n\t\t\tawait dispatch('setAttachmentsFolder', { attachmentsFolder: path })\n\t\t}\n\t\tcommit('setAttachmentsFolderCreated', { attachmentsFolderCreated: true })\n\t\treturn path\n\t},\n\n\t/**\n\t * Initializes the calendar-js configuration\n\t *\n\t * @param {object} vuex The Vuex destructuring object\n\t * @param {object} vuex.state The Vuex state\n\t */\n\tinitializeCalendarJsConfig({ state }) {\n\t\tsetCalendarJsConfig('PRODID', `-//IDN nextcloud.com//Calendar app ${state.appVersion}//EN`)\n\t\tsetCalendarJsConfig('property-list-significant-change', [\n\t\t\t'SUMMARY',\n\t\t\t'LOCATION',\n\t\t\t'DESCRIPTION',\n\t\t])\n\t},\n}\n\nexport default { state, mutations, getters, actions }\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n * @author Richard Steinmetz <richard@steinmetz.cloud>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { AttendeeProperty, Property } from '@nextcloud/calendar-js'\nimport { translate as t } from '@nextcloud/l10n'\n\n/**\n * Get the factor for a given unit\n *\n * @param {string} unit The name of the unit to get the factor of\n * @return {number}\n */\nexport function getFactorForAlarmUnit(unit) {\n\tswitch (unit) {\n\tcase 'seconds':\n\t\treturn 1\n\n\tcase 'minutes':\n\t\treturn 60\n\n\tcase 'hours':\n\t\treturn 60 * 60\n\n\tcase 'days':\n\t\treturn 24 * 60 * 60\n\n\tcase 'weeks':\n\t\treturn 7 * 24 * 60 * 60\n\n\tdefault:\n\t\treturn 1\n\t}\n}\n\n/**\n * Gets the amount of days / weeks, unit from total seconds\n *\n * @param {number} totalSeconds Total amount of seconds\n * @return {{amount: number, unit: string}}\n */\nexport function getAmountAndUnitForTimedEvents(totalSeconds) {\n\t// Before or after the event is handled somewhere else,\n\t// so make sure totalSeconds is positive\n\ttotalSeconds = Math.abs(totalSeconds)\n\n\t// Handle the special case of 0, so we don't show 0 weeks\n\tif (totalSeconds === 0) {\n\t\treturn {\n\t\t\tamount: 0,\n\t\t\tunit: 'minutes',\n\t\t}\n\t}\n\n\tif (totalSeconds % (7 * 24 * 60 * 60) === 0) {\n\t\treturn {\n\t\t\tamount: totalSeconds / (7 * 24 * 60 * 60),\n\t\t\tunit: 'weeks',\n\t\t}\n\t}\n\tif (totalSeconds % (24 * 60 * 60) === 0) {\n\t\treturn {\n\t\t\tamount: totalSeconds / (24 * 60 * 60),\n\t\t\tunit: 'days',\n\t\t}\n\t}\n\tif (totalSeconds % (60 * 60) === 0) {\n\t\treturn {\n\t\t\tamount: totalSeconds / (60 * 60),\n\t\t\tunit: 'hours',\n\t\t}\n\t}\n\tif (totalSeconds % (60) === 0) {\n\t\treturn {\n\t\t\tamount: totalSeconds / (60),\n\t\t\tunit: 'minutes',\n\t\t}\n\t}\n\n\treturn {\n\t\tamount: totalSeconds,\n\t\tunit: 'seconds',\n\t}\n}\n\n/**\n * Get the total amount of seconds based on amount and unit for timed events\n *\n * @param {number} amount Amount of unit\n * @param {string} unit Minutes/Hours/Days/Weeks\n * @param {boolean=} isBefore Whether the reminder is before or after the event\n * @return {number}\n */\nexport function getTotalSecondsFromAmountAndUnitForTimedEvents(amount, unit, isBefore = true) {\n\treturn amount * getFactorForAlarmUnit(unit) * (isBefore ? -1 : 1)\n}\n\n/**\n * Gets the amount of days / weeks, unit, hours and minutes from total seconds\n *\n * @param {number} totalSeconds Total amount of seconds\n * @return {{amount: *, unit: *, hours: *, minutes: *}}\n */\nexport function getAmountHoursMinutesAndUnitForAllDayEvents(totalSeconds) {\n\tconst dayFactor = getFactorForAlarmUnit('days')\n\tconst hourFactor = getFactorForAlarmUnit('hours')\n\tconst minuteFactor = getFactorForAlarmUnit('minutes')\n\tconst isNegative = totalSeconds < 0\n\ttotalSeconds = Math.abs(totalSeconds)\n\n\tlet dayPart = Math.floor(totalSeconds / dayFactor)\n\tconst hourPart = totalSeconds % dayFactor\n\n\tif (hourPart !== 0) {\n\t\tif (isNegative) {\n\t\t\tdayPart++\n\t\t}\n\t}\n\n\tlet amount = 0\n\tlet unit = null\n\tif (dayPart === 0) {\n\t\tunit = 'days'\n\t} else if (dayPart % 7 === 0) {\n\t\tamount = dayPart / 7\n\t\tunit = 'weeks'\n\t} else {\n\t\tamount = dayPart\n\t\tunit = 'days'\n\t}\n\n\tlet hours = Math.floor(hourPart / hourFactor)\n\tconst minutePart = hourPart % hourFactor\n\tlet minutes = Math.floor(minutePart / minuteFactor)\n\n\tif (isNegative) {\n\t\thours = 24 - hours\n\n\t\tif (minutes !== 0) {\n\t\t\thours--\n\t\t\tminutes = 60 - minutes\n\t\t}\n\t}\n\n\treturn {\n\t\tamount,\n\t\tunit,\n\t\thours,\n\t\tminutes,\n\t}\n}\n\n/**\n * Get the total amount of seconds for all-day events\n *\n * @param {number} amount amount of unit\n * @param {number} hours Time of reminder\n * @param {number} minutes Time of reminder\n * @param {string} unit days/weeks\n * @return {number}\n */\nexport function getTotalSecondsFromAmountHourMinutesAndUnitForAllDayEvents(amount, hours, minutes, unit) {\n\tif (unit === 'weeks') {\n\t\tamount *= 7\n\t\tunit = 'days'\n\t}\n\n\t// 0 is on the same day of the all-day event => positive\n\t// 1 ... n before the event is negative\n\tconst isNegative = amount > 0\n\n\tif (isNegative) {\n\t\t// If it's negative, we need to subtract one day\n\t\tamount--\n\t\t// Convert days to seconds\n\t\tamount *= getFactorForAlarmUnit(unit)\n\n\t\tlet invertedHours = 24 - hours\n\t\tlet invertedMinutes = 0\n\n\t\tif (minutes !== 0) {\n\t\t\tinvertedHours--\n\t\t\tinvertedMinutes = 60 - minutes\n\t\t}\n\n\t\tamount += (invertedHours * getFactorForAlarmUnit('hours'))\n\t\tamount += (invertedMinutes * getFactorForAlarmUnit('minutes'))\n\n\t\tamount *= -1\n\t} else {\n\t\t// Convert days to seconds\n\t\tamount *= getFactorForAlarmUnit('days')\n\n\t\tamount += (hours * getFactorForAlarmUnit('hours'))\n\t\tamount += (minutes * getFactorForAlarmUnit('minutes'))\n\t}\n\n\treturn amount\n}\n\n/**\n * Propagate data from an event component to all EMAIL alarm components.\n * An alarm component must contain a description, summary and all attendees to be notified.\n * We don't have a separate UI for maintaining attendees of an alarm, so we just copy them from the event.\n *\n * https://www.rfc-editor.org/rfc/rfc5545#section-3.6.6\n *\n * @param {AbstractRecurringComponent} eventComponent\n */\nexport function updateAlarms(eventComponent) {\n\tfor (const alarmComponent of eventComponent.getAlarmIterator()) {\n\t\tif (alarmComponent.action !== 'EMAIL' && alarmComponent.action !== 'DISPLAY') {\n\t\t\tcontinue\n\t\t}\n\n\t\talarmComponent.deleteAllProperties('SUMMARY')\n\t\tconst summaryProperty = eventComponent.getFirstProperty('SUMMARY')\n\t\tif (summaryProperty) {\n\t\t\talarmComponent.addProperty(summaryProperty.clone())\n\t\t} else {\n\t\t\tconst defaultSummary = t('calendar', 'Untitled event')\n\t\t\talarmComponent.addProperty(new Property('SUMMARY', defaultSummary))\n\t\t}\n\n\t\tif (!alarmComponent.hasProperty('DESCRIPTION')) {\n\t\t\tconst defaultDescription = t('calendar', 'This is an event reminder.')\n\t\t\talarmComponent.addProperty(new Property('DESCRIPTION', defaultDescription))\n\t\t}\n\n\t\talarmComponent.deleteAllProperties('ATTENDEE')\n\t\tfor (const attendee of eventComponent.getAttendeeIterator()) {\n\t\t\tif (['RESOURCE', 'ROOM'].includes(attendee.userType)) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// Only copy the email address (value) of the attendee\n\t\t\talarmComponent.addProperty(new AttendeeProperty('ATTENDEE', attendee.value))\n\t\t}\n\t}\n}\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\n/**\n * Gets the ByDay and BySetPosition\n *\n * @param {Date} jsDate The date to get the weekday of\n * @return {object}\n */\nexport function getBySetPositionAndBySetFromDate(jsDate) {\n\tconst byDay = getWeekDayFromDate(jsDate)\n\tlet bySetPosition = 1\n\tlet dayOfMonth = jsDate.getDate()\n\tfor (; dayOfMonth > 7; dayOfMonth -= 7) {\n\t\tbySetPosition++\n\t}\n\n\treturn {\n\t\tbyDay,\n\t\tbySetPosition,\n\t}\n}\n\n/**\n * Gets the string-representation of the weekday of a given date\n *\n * @param {Date} jsDate The date to get the weekday of\n * @return {string}\n */\nexport function getWeekDayFromDate(jsDate) {\n\tswitch (jsDate.getDay()) {\n\tcase 0:\n\t\treturn 'SU'\n\tcase 1:\n\t\treturn 'MO'\n\tcase 2:\n\t\treturn 'TU'\n\tcase 3:\n\t\treturn 'WE'\n\tcase 4:\n\t\treturn 'TH'\n\tcase 5:\n\t\treturn 'FR'\n\tcase 6:\n\t\treturn 'SA'\n\tdefault:\n\t\tthrow TypeError('Invalid date-object given')\n\t}\n}\n","/**\n * @copyright Copyright (c) 2019 Georg Ehrke\n *\n * @author Georg Ehrke <oc.list@georgehrke.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nimport { linkTo } from '@nextcloud/router'\n\n/**\n * Get URL to modify config-key\n *\n * @param {string} key URL of config-key to modify\n * @return {string}\n */\nexport function getLinkToConfig(key) {\n\treturn [\n\t\tlinkTo('calendar', 'index.php'),\n\t\t'v1/config',\n\t\tkey,\n\t].join('/')\n}\n"],"names":["getDefaultAlarmObject","props","arguments","length","undefined","Object","assign","alarmComponent","type","isRelative","absoluteDate","absoluteTimezoneId","relativeIsBefore","relativeIsRelatedToStart","relativeUnitTimed","relativeAmountTimed","relativeUnitAllDay","relativeAmountAllDay","relativeHoursAllDay","relativeMinutesAllDay","relativeTrigger","mapAlarmComponentToAlarmObject","trigger","value","isNegative","related","amount","unit","getAmountAndUnitForTimedEvents","totalSeconds","hours","minutes","getAmountHoursMinutesAndUnitForAllDayEvents","action","getDateFromDateTimeValue","timezoneId","mapAttachmentPropertyToAttchmentObject","attachmentProperty","fileName","formatType","uri","xNcHasPreview","xNcFileId","getDefaultAttachmentObject","getParameterFirstValue","mapAttendeePropertyToAttendeeObject","attendeeProperty","commonName","calendarUserType","participationStatus","role","rsvp","member","getDefaultAttendeeObject","userType","email","getDefaultCalendarObject","id","displayName","color","uidToHexColor","enabled","loading","supportsEvents","supportsJournals","supportsTasks","owner","timezone","shares","publishURL","url","readOnly","order","isSharedWithMe","canBeShared","canBePublished","dav","calendarObjects","fetchedTimeRanges","mapDavCollectionToCalendar","calendar","currentUserPrincipal","btoa","displayname","endsWith","substring","lastIndexOf","getCalendarUriFromUrl","detectColor","components","includes","isWriteable","isShareable","isPublishable","Array","isArray","share","href","principalScheme","push","mapDavShareeToCalendarShareObject","getDefaultCalendarObjectObject","calendarId","calendarComponent","uid","objectType","isEvent","isJournal","isTodo","existsOnServer","mapCDavObjectToCalendarObject","parser","getParserManager","getParserForFileType","data","trim","Error","parse","getItemIterator","next","firstVObject","getVObjectIterator","name","COMPONENT_NAME_EVENT","COMPONENT_NAME_JOURNAL","COMPONENT_NAME_VTODO","mapCalendarJsToCalendarObject","sharee","encodeURI","startsWith","PRINCIPAL_PREFIX_GROUP","decodeURIComponent","slice","PRINCIPAL_PREFIX_USER","writeable","isUser","isGroup","isCircle","getDefaultCalendarShareObject","access","PRINCIPAL_PREFIX_CIRCLE","getDefaultEventObject","eventComponent","title","startDate","startTimezoneId","endDate","endTimezoneId","isAllDay","canModifyAllDay","location","description","accessClass","status","timeTransparency","recurrenceRule","getDefaultRecurrenceRuleObject","hasMultipleRRules","isMasterItem","isRecurrenceException","forceThisAndAllFuture","canCreateRecurrenceException","attendees","organizer","alarms","customColor","categories","attachments","mapEventComponentToEventObject","eventObject","from","getCategoryIterator","canCreateRecurrenceExceptions","clone","addDuration","DurationValue","fromSeconds","organizerProperty","getFirstProperty","alarm","getAlarmIterator","attendee","getAttendeeIterator","attachment","getPropertyIterator","recurrenceRuleIterator","firstRecurrenceRule","mapRecurrenceRuleValueToRecurrenceRuleObject","getFirstValue","done","hasProperty","hexColor","getHexForColorName","getFirstPropertyFirstValue","copyCalendarObjectInstanceIntoEventComponent","category","addCategory","setOrganizerFromNameAndEMail","duration","addRelativeAlarm","date","DateTimeValue","fromJSDate","addAbsoluteAlarm","addProperty","rule","getClosestCSS3ColorNameForHex","getDefaultPrincipalObject","emailAddress","userId","isCalendarResource","isCalendarRoom","principalId","scheduleDefaultCalendarUrl","mapDavToPrincipal","PRINCIPAL_PREFIX_CALENDAR_RESOURCE","PRINCIPAL_PREFIX_CALENDAR_ROOM","principalUrl","recurrenceRuleValue","frequency","interval","count","until","byDay","byMonth","byMonthDay","bySetPosition","isUnsupported","baseDate","mapDailyRuleValueToRecurrenceRuleObject","mapWeeklyRuleValueToRecurrenceRuleObject","mapMonthlyRuleValueToRecurrenceRuleObject","mapYearlyRuleValueToRecurrenceRuleObject","getDefaultRecurrenceRuleObjectForRecurrenceValue","FORBIDDEN_BY_PARTS_DAILY","FORBIDDEN_BY_PARTS_WEEKLY","FORBIDDEN_BY_PARTS_MONTHLY","FORBIDDEN_BY_PARTS_YEARLY","SUPPORTED_BY_DAY_WEEKLY","getRangeAsStrings","start","end","apply","map","_","n","s","toString","SUPPORTED_BY_MONTHDAY_MONTHLY","SUPPORTED_BY_MONTH_YEARLY","containsRecurrenceComponent","containsUnsupportedByParts","containsInvalidByDayPart","getComponent","some","weekday","filter","getWeekDayFromDate","jsDate","containsInvalidByMonthDay","monthDay","isAllowedByDay","setPositionArray","isAllowedBySetPos","byDayArray","day","firstElement","match","exec","matchedBySetPosition","matchedByDay","parseInt","month","sort","join","bySetPos","component","isUnsupportedProps","createFolder","async","folderName","generateRemoteUrl","concat","axios","method","e","_e$response","response","showError","t","folder","findFirstOwnedFolder","path","_info$multistatus","infoXml","getFileInfo","info","parseXML","multistatus","propstat","prop","hierarchy","split","pop","catch","setConfig","key","HttpClient","post","getLinkToConfig","mutations","setCalendarObjectInstanceForExistingEvent","state","_ref","calendarObject","calendarObjectInstance","objectId","recurrenceId","isNew","existingEvent","setCalendarObjectInstanceForNewEvent","_ref2","resetCalendarObjectInstanceObjectIdAndRecurrenceId","changeTitle","_ref3","changeStartDate","_ref4","year","getFullYear","getMonth","getDate","hour","getHours","minute","getMinutes","second","endDateObj","startDateObj","compare","getTimezoneManager","getTimezoneForId","getInTimezone","changeStartTimezone","_ref5","startTimezone","replaceTimezone","changeEndDate","_ref6","endDateObject","Date","getTime","changeEndTimezone","_ref7","endTimezone","toggleAllDay","_ref8","isDate","changeTimeToDefaultForTimedEvents","_ref9","changeLocation","_ref10","deleteAllProperties","changeDescription","_ref11","descriptionProperty","parameter","getParametersIterator","deleteParameter","changeAccessClass","_ref12","changeStatus","_ref13","changeTimeTransparency","_ref14","changeCustomColor","_ref15","Vue","cssColorName","hexColorOfCssName","console","error","addAttendee","_ref16","language","AttendeeProperty","fromNameAndEMail","updateParameterIfExist","this","commit","removeAttendee","_ref17","members","forEach","index","indexOf","splice","changeAttendeesParticipationStatus","_ref18","changeAttendeesRole","_ref19","toggleAttendeeRSVP","_ref20","oldRSVP","setOrganizer","_ref21","_ref22","removeCategory","_ref23","changeRecurrenceInterval","_ref24","debug","_innerValue","changeRecurrenceFrequency","_ref25","changeRecurrenceCount","_ref26","changeRecurrenceUntil","_ref27","zone","changeRecurrenceToInfinite","_ref28","setToInfinite","resetRecurrenceByParts","_ref29","parts","part","setComponent","setDefaultRecurrenceByPartsForWeekly","_ref30","setDefaultRecurrenceByPartsForMonthly","_ref31","setDefaultRecurrenceByPartsForMonthlyBySetPosition","_ref32","getBySetPositionAndBySetFromDate","setDefaultRecurrenceByPartsForYearly","_ref33","addByDayToRecurrenceRule","_ref34","byDayList","removeByDayFromRecurrenceRule","_ref35","index2","addByMonthDayToRecurrenceRule","_ref36","byMonthDayList","removeByMonthDayFromRecurrenceRule","_ref37","addByMonthToRecurrenceRule","_ref38","byMonthList","removeByMonthFromRecurrenceRule","_ref39","changeRecurrenceByDay","_ref40","changeRecurrenceBySetPosition","_ref41","unsetRecurrenceBySetPosition","_ref42","removeRecurrenceRuleFromCalendarObjectInstance","_ref43","addRecurrenceRuleFromCalendarObjectInstance","_ref44","recurrenceValue","RecurValue","fromData","recurrenceProperty","Property","markRecurrenceRuleAsSupported","_ref45","changeAlarmType","_ref46","toICALJs","changeAlarmAmountTimed","_ref47","getTotalSecondsFromAmountAndUnitForTimedEvents","changeAlarmUnitTimed","_ref48","changeAlarmAmountAllDay","_ref49","getTotalSecondsFromAmountHourMinutesAndUnitForAllDayEvents","changeAlarmUnitAllDay","_ref50","changeAlarmHoursMinutesAllDay","_ref51","changeAlarmAbsoluteDate","_ref52","changeAlarmAbsoluteTimezoneId","_ref53","changeAlarmFromRelativeToAbsolute","_ref54","triggerDateTime","setTriggerFromAbsolute","changeAlarmFromAbsoluteToRelative","_ref55","subtractDateWithTimezone","setTriggerFromRelative","resetAlarmRelativeParts","_ref56","resetAlarmAbsoluteParts","_ref57","updateAlarmAllDayParts","_ref58","allDayParts","updateAlarmTimedParts","_ref59","timedParts","addAlarmToCalendarObjectInstance","_ref60","alarmObject","removeAlarmFromCalendarObjectInstance","_ref61","removeAlarm","addAttachmentBySharedData","_ref62","sharedData","AttachmentProperty","fromLink","parameterFileName","Parameter","fileid","xNcSharedTypes","setParameter","shareTypes","getcontenttype","generateUrl","addAttachmentWithProperty","_ref63","_ref64","_sharedData$shareTyp","_sharedData$shareTyp2","_sharedData$shareTyp3","deleteAttachment","_ref65","removeAttachment","actions","resolveClosestRecurrenceIdForCalendarObject","_ref66","_ref67","dispatch","closeToDate","d","recurrenceManager","getClosestOccurrence","getReferenceRecurrenceId","unixTime","getCalendarObjectInstanceByObjectIdAndRecurrenceId","_ref68","_ref69","Promise","resolve","recurrenceIdDate","getObjectAtRecurrenceId","getCalendarObjectInstanceForNewEvent","_ref70","_ref71","defaultReminder","settings","isNaN","logger","getRFCProperties","defaultValue","updateCalendarObjectInstanceForNewEvent","_ref72","_ref73","saveCalendarObjectInstance","_ref74","_ref75","thisAndAllFuture","updateAlarms","updateTalkParticipants","isDirty","original","fork","primaryItem","createRecurrenceException","root","newCalendarId","duplicateCalendarObjectInstance","_ref76","oldCalendarObjectInstance","oldEventComponent","getInUTC","deleteCalendarObjectInstance","_ref77","_ref78","isRecurrenceSetEmpty","removeThisOccurrence","_ref79","_ref80","difference","_ref81","_ref82","_ref83","_ref84","_ref85","_ref86","setDefaultRecurrenceByParts","_ref87","_ref88","setRecurrenceToInfinite","_ref89","_ref90","changeMonthlyRecurrenceFromByDayToBySetPosition","_ref91","_ref92","changeMonthlyRecurrenceFromBySetPositionToByDay","_ref93","_ref94","enableYearlyRecurrenceBySetPosition","_ref95","_ref96","disableYearlyRecurrenceBySetPosition","_ref97","_ref98","enableRecurrenceLimitByUntil","_ref99","_ref100","enableRecurrenceLimitByCount","_ref101","_ref102","_ref103","_ref104","_ref105","_ref106","_ref107","_ref108","_ref109","_ref110","_ref111","_ref112","_ref113","_ref114","_ref115","_ref116","_ref117","_ref118","getters","getResolvedTimezone","appendCalendarObjects","appendCalendarObject","updateCalendarObjectId","updateCalendarObjectIdCalendarId","calendarObjectId","resetCalendarObjectToDav","firstVCalendar","deleteCalendarObject","delete","incrementModificationCount","modificationCount","getCalendarObjectById","moveCalendarObject","context","oldCalendarObjectId","oldCalendarId","newCalendar","getCalendarById","move","updateCalendarObject","toICS","update","createVObject","createCalendarObjectFromFork","createNewEvent","startDateTime","endDateTime","createEvent","vObject","undirtify","firstCalendar","sortedCalendars","updateTimeOfNewEvent","addCalendar","object","calendars","existing","calendarsById","addTrashBin","trashBin","setWidgetView","viewName","widgetView","setWidgetDate","widgetDate","setWidgetRef","widgetRef","setSelectedEvent","widgetEventDetailsOpen","widgetEventDetails","closeWidgetEventDetails","addScheduleInbox","scheduleInbox","addDeletedCalendar","deletedCalendars","c","removeDeletedCalendar","removeDeletedCalendarObject","vobject","deletedCalendarObjects","vo","addDeletedCalendarObject","deleteCalendar","toggleCalendarEnabled","renameCalendar","newName","changeCalendarColor","newColor","changeCalendarOrder","newOrder","appendCalendarObjectsToCalendar","calendarObjectIds","addCalendarObjectToCalendar","deleteCalendarObjectFromCalendar","addFetchedTimeRangeToCalendar","fetchedTimeRangeId","deleteFetchedTimeRangeFromCalendar","shareCalendar","user","newSharee","unshareCalendar","find","search","shareIndex","findIndex","toggleCalendarShareWritable","publishCalendar","unpublishCalendar","initialCalendarsLoaded","markCalendarAsLoading","markCalendarAsNotLoading","showEditCalendarModal","editCalendarModal","hideEditCalendarModal","setCalendarDeleteCountdown","countdown","setCalendarDeleteHandles","deleteTimeout","deleteInterval","sortedCalendarsSubscriptions","store","rootState","showTasks","a","b","ownSortedCalendars","hasTrashBin","retentionDuration","sortedDeletedCalendars","deletedAt","calendarUriMap","withoutTrail","replace","obj","_props","sortedSubscriptions","enabledCalendars","getCalendarByUrl","getBirthdayCalendar","lastSlash","CALDAV_BIRTHDAY_CALENDAR","hasBirthdayCalendar","sortedCalendarFilteredByComponents","vevent","vjournal","vtodo","loadCollections","trashBins","scheduleInboxes","subscriptions","findAll","getCurrentUserPrincipal","loadDeletedCalendars","findAllDeletedCalendars","loadDeletedCalendarObjects","vobjects","findDeletedObjects","getPublicCalendars","tokens","findPublicCalendarsByTokens","davCalendar","appendCalendar","timezoneIcs","timezoneObject","Timezone","utc","floating","CalendarComponent","fromEmpty","addComponent","TimezoneComponent","fromICALJs","createCalendar","appendSubscription","source","createSubscription","deleteCalendarPermanently","deleteCalendarAfterTimeout","setInterval","setTimeout","clearInterval","cancelCalendarDeletion","clearTimeout","restoreCalendar","restore","restoreCalendarObject","_component$startDate","_component$endDate","getFirstComponent","timeRange","getTimeRangeForCalendarCoveringRange","timeRangeId","deleteCalendarObjectPermanently","unshare","publish","unpublish","getEventsFromCalendarInTimeRange","to","findByTypeInTimeRange","responseTodo","getUnixTimestampFromDate","lastFetched","dateFactory","insertId","getLastTimeRangeInsertId","r","lastTimeRangeInsertId","getEventByObjectId","objectPath","atob","lastSlashIndex","calendarPath","objectFileName","reject","importEventsIntoCalendar","IMPORT_STAGE_IMPORTING","files","importFiles","totalCount","file","getItemCount","importCalendarRelation","getName","filename","getColor","containsVEvents","containsVJournals","containsVTodos","fileId","limit","pLimit","requests","item","ics","davObject","all","IMPORT_STAGE_PROCESSING","updateCalendarListOrder","calendarsToUpdate","appendContact","contact","contacts","emails","contactByEMail","removeContact","loadDavRestrictionsFromServer","minimumDate","maximumDate","addTimeRange","fetchedTimeRange","fetchedTimeRangesById","removeTimeRange","appendCalendarObjectIdsToTimeFrame","appendCalendarObjectIdToTimeRange","removeCalendarObjectIdFromTimeRange","removeCalendarObjectIdFromAnyTimeRange","updateTimestampOfLastFetched","addCalendarObjectIdToAllTimeRangesOfCalendar","timerange","removeCalendarObjectIdFromAllTimeRangesOfCalendar","clearFetchedTimeRanges","getAllTimeRangesForCalendar","f","requestedFrom","requestedTo","getAllTimeRangesOlderThan","olderThan","getCalendarObjectsByTimeRangeId","addFile","contents","lastModified","size","lastFileInsertId","importFilesById","setCalendarForFileId","removeAllFiles","incrementAccepted","accepted","incrementDenied","denied","setTotal","total","changeStage","stage","resetState","IMPORT_STAGE_DEFAULT","use","Vuex","modules","davRestrictions","importState","principals","addPrincipal","principal","principalsById","setCurrentUserPrincipal","changePrincipalScheduleDefaultCalendarUrl","getPrincipalByUrl","getPrincipalById","getCurrentUserPrincipalEmail","_state$principalsById","fetchPrincipalByUrl","findPrincipalByUrl","fetchCurrentUserPrincipal","toggleEventLimitEnabled","eventLimit","togglePopoverEnabled","skipPopover","toggleTasksEnabled","toggleWeekendsEnabled","showWeekends","toggleWeekNumberEnabled","showWeekNumbers","setSlotDuration","slotDuration","setDefaultReminder","setTimezone","setAttachmentsFolder","attachmentsFolder","attachmentsFolderCreated","setAttachmentsFolderCreated","loadSettingsFromServer","appVersion","firstRun","talkEnabled","tasksEnabled","hideEventExport","forceEventAlarmType","disableAppointments","canSubscribeLink","showResources","publicCalendars","logInfo","setMomentLocale","locale","momentLocale","isTalkEnabled","detectTimezone","getResolvedTimezoneObject","toggleBirthdayCalendarEnabled","enableBirthdayCalendar","setInitialView","initialView","createAttachmentsFolder","AttachmentService","initializeCalendarJsConfig","setCalendarJsConfig","getFactorForAlarmUnit","Math","abs","isBefore","dayFactor","hourFactor","minuteFactor","dayPart","floor","hourPart","minutePart","invertedHours","invertedMinutes","summaryProperty","defaultSummary","defaultDescription","dayOfMonth","getDay","TypeError","linkTo"],"sourceRoot":""}