/*! For license information please see notifications-node_modules_moment_locale_sync_recursive_-src_NotificationsApp_vue.js.LICENSE.txt */
(self.webpackChunknotifications=self.webpackChunknotifications||[]).push([["node_modules_moment_locale_sync_recursive_-src_NotificationsApp_vue"],{6700:(t,e,n)=>{var i={"./af":2786,"./af.js":2786,"./ar":867,"./ar-dz":4130,"./ar-dz.js":4130,"./ar-kw":6135,"./ar-kw.js":6135,"./ar-ly":6440,"./ar-ly.js":6440,"./ar-ma":7702,"./ar-ma.js":7702,"./ar-sa":6040,"./ar-sa.js":6040,"./ar-tn":7100,"./ar-tn.js":7100,"./ar.js":867,"./az":1083,"./az.js":1083,"./be":9808,"./be.js":9808,"./bg":8338,"./bg.js":8338,"./bm":7438,"./bm.js":7438,"./bn":8905,"./bn-bd":6225,"./bn-bd.js":6225,"./bn.js":8905,"./bo":1560,"./bo.js":1560,"./br":1278,"./br.js":1278,"./bs":622,"./bs.js":622,"./ca":2468,"./ca.js":2468,"./cs":5822,"./cs.js":5822,"./cv":877,"./cv.js":877,"./cy":7373,"./cy.js":7373,"./da":4780,"./da.js":4780,"./de":9740,"./de-at":217,"./de-at.js":217,"./de-ch":894,"./de-ch.js":894,"./de.js":9740,"./dv":5300,"./dv.js":5300,"./el":837,"./el.js":837,"./en-au":8348,"./en-au.js":8348,"./en-ca":7925,"./en-ca.js":7925,"./en-gb":2243,"./en-gb.js":2243,"./en-ie":6436,"./en-ie.js":6436,"./en-il":7207,"./en-il.js":7207,"./en-in":4175,"./en-in.js":4175,"./en-nz":6319,"./en-nz.js":6319,"./en-sg":1662,"./en-sg.js":1662,"./eo":2915,"./eo.js":2915,"./es":5655,"./es-do":5251,"./es-do.js":5251,"./es-mx":6112,"./es-mx.js":6112,"./es-us":1146,"./es-us.js":1146,"./es.js":5655,"./et":5603,"./et.js":5603,"./eu":7763,"./eu.js":7763,"./fa":6959,"./fa.js":6959,"./fi":1897,"./fi.js":1897,"./fil":2549,"./fil.js":2549,"./fo":4694,"./fo.js":4694,"./fr":4470,"./fr-ca":3049,"./fr-ca.js":3049,"./fr-ch":2330,"./fr-ch.js":2330,"./fr.js":4470,"./fy":5044,"./fy.js":5044,"./ga":9295,"./ga.js":9295,"./gd":2101,"./gd.js":2101,"./gl":8794,"./gl.js":8794,"./gom-deva":7884,"./gom-deva.js":7884,"./gom-latn":3168,"./gom-latn.js":3168,"./gu":5349,"./gu.js":5349,"./he":4206,"./he.js":4206,"./hi":94,"./hi.js":94,"./hr":316,"./hr.js":316,"./hu":2138,"./hu.js":2138,"./hy-am":1423,"./hy-am.js":1423,"./id":9218,"./id.js":9218,"./is":135,"./is.js":135,"./it":626,"./it-ch":150,"./it-ch.js":150,"./it.js":626,"./ja":9183,"./ja.js":9183,"./jv":4286,"./jv.js":4286,"./ka":2105,"./ka.js":2105,"./kk":7772,"./kk.js":7772,"./km":8758,"./km.js":8758,"./kn":3926,"./kn.js":3926,"./ko":3730,"./ko.js":3730,"./ku":1408,"./ku.js":1408,"./ky":3291,"./ky.js":3291,"./lb":6841,"./lb.js":6841,"./lo":5466,"./lo.js":5466,"./lt":7010,"./lt.js":7010,"./lv":7595,"./lv.js":7595,"./me":9861,"./me.js":9861,"./mi":5493,"./mi.js":5493,"./mk":5966,"./mk.js":5966,"./ml":7341,"./ml.js":7341,"./mn":5115,"./mn.js":5115,"./mr":370,"./mr.js":370,"./ms":9847,"./ms-my":1237,"./ms-my.js":1237,"./ms.js":9847,"./mt":2126,"./mt.js":2126,"./my":6165,"./my.js":6165,"./nb":4924,"./nb.js":4924,"./ne":6744,"./ne.js":6744,"./nl":3901,"./nl-be":9814,"./nl-be.js":9814,"./nl.js":3901,"./nn":3877,"./nn.js":3877,"./oc-lnc":2135,"./oc-lnc.js":2135,"./pa-in":5858,"./pa-in.js":5858,"./pl":4495,"./pl.js":4495,"./pt":9520,"./pt-br":7971,"./pt-br.js":7971,"./pt.js":9520,"./ro":6459,"./ro.js":6459,"./ru":238,"./ru.js":238,"./sd":950,"./sd.js":950,"./se":7930,"./se.js":7930,"./si":124,"./si.js":124,"./sk":4249,"./sk.js":4249,"./sl":4985,"./sl.js":4985,"./sq":1104,"./sq.js":1104,"./sr":9131,"./sr-cyrl":9915,"./sr-cyrl.js":9915,"./sr.js":9131,"./ss":5893,"./ss.js":5893,"./sv":8760,"./sv.js":8760,"./sw":1172,"./sw.js":1172,"./ta":7333,"./ta.js":7333,"./te":3110,"./te.js":3110,"./tet":2095,"./tet.js":2095,"./tg":7321,"./tg.js":7321,"./th":9041,"./th.js":9041,"./tk":9005,"./tk.js":9005,"./tl-ph":5768,"./tl-ph.js":5768,"./tlh":9444,"./tlh.js":9444,"./tr":2397,"./tr.js":2397,"./tzl":8254,"./tzl.js":8254,"./tzm":1106,"./tzm-latn":699,"./tzm-latn.js":699,"./tzm.js":1106,"./ug-cn":9288,"./ug-cn.js":9288,"./uk":7691,"./uk.js":7691,"./ur":3795,"./ur.js":3795,"./uz":6791,"./uz-latn":588,"./uz-latn.js":588,"./uz.js":6791,"./vi":5666,"./vi.js":5666,"./x-pseudo":4378,"./x-pseudo.js":4378,"./yo":5805,"./yo.js":5805,"./zh-cn":3839,"./zh-cn.js":3839,"./zh-hk":5726,"./zh-hk.js":5726,"./zh-mo":9807,"./zh-mo.js":9807,"./zh-tw":4152,"./zh-tw.js":4152};function s(t){var e=a(t);return n(e)}function a(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}s.keys=function(){return Object.keys(i)},s.resolve=a,t.exports=s,s.id=6700},4994:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(272),s=n.n(i),a=n(2609),o=n.n(a)()(s());o.push([t.id,".notification[data-v-c92968fc]{background-color:var(--color-main-background)}.notification[data-v-c92968fc] img.notification-icon{display:flex;width:32px;height:32px;filter:var(--background-invert-if-dark)}.notification[data-v-c92968fc] .rich-text--wrapper{white-space:pre-wrap;word-break:break-word}.notification .notification-subject[data-v-c92968fc]{padding:4px}.notification a.notification-subject[data-v-c92968fc]:focus-visible{box-shadow:inset 0 0 0 2px var(--color-main-text) !important}","",{version:3,sources:["webpack://./src/Components/Notification.vue"],names:[],mappings:"AACA,+BACC,6CAAA,CAGC,qDACC,YAAA,CACA,UAAA,CACA,WAAA,CACA,uCAAA,CAED,mDACC,oBAAA,CACA,qBAAA,CAIF,qDACC,WAAA,CAGD,oEACC,4DAAA",sourcesContent:["\n.notification {\n\tbackground-color: var(--color-main-background);\n\n\t&::v-deep {\n\t\timg.notification-icon {\n\t\t\tdisplay: flex;\n\t\t\twidth: 32px;\n\t\t\theight: 32px;\n\t\t\tfilter: var(--background-invert-if-dark);\n\t\t}\n\t\t.rich-text--wrapper {\n\t\t\twhite-space: pre-wrap;\n\t\t\tword-break: break-word;\n\t\t}\n\t}\n\n\t.notification-subject {\n\t\tpadding: 4px;\n\t}\n\n\ta.notification-subject:focus-visible {\n\t\tbox-shadow: inset 0 0 0 2px var(--color-main-text) !important; // override rule in core/css/headers.scss #header a:focus-visible\n\t}\n}\n\n"],sourceRoot:""}]);const r=o},5723:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(272),s=n.n(i),a=n(2609),o=n.n(a)()(s());o.push([t.id,'.external[data-v-39222bd6]:after{content:" ↗"}',"",{version:3,sources:["webpack://./DefaultParameter.vue","webpack://./src/Components/Parameters/DefaultParameter.vue"],names:[],mappings:"AAAA,iCCCA,YACC",sourcesContent:['.external:after{content:" ↗"}',"\n.external:after {\n\tcontent: ' ↗';\n}\n"],sourceRoot:""}]);const r=o},7296:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(272),s=n.n(i),a=n(2609),o=n.n(a)()(s());o.push([t.id,".mention[data-v-b064c4b8]{display:contents;white-space:nowrap}","",{version:3,sources:["webpack://./src/Components/Parameters/User.vue"],names:[],mappings:"AACA,0BACC,gBAAA,CACA,kBAAA",sourcesContent:["\n.mention {\n\tdisplay: contents;\n\twhite-space: nowrap;\n}\n"],sourceRoot:""}]);const r=o},9908:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(272),s=n.n(i),a=n(2609),o=n.n(a)()(s());o.push([t.id,".notification-container[data-v-1096702e]{overflow:hidden}.notification-wrapper[data-v-1096702e]{max-height:calc(100vh - 200px);overflow:auto}[data-v-1096702e] .empty-content{margin:12vh 10px}[data-v-1096702e] .empty-content p{color:var(--color-text-maxcontrast)}.icon-alert-outline[data-v-1096702e]{background-size:64px;width:64px;height:64px}.fade-enter-active[data-v-1096702e],.fade-leave-active[data-v-1096702e]{transition:opacity var(--animation-quick) ease}.fade-enter-from[data-v-1096702e],.fade-leave-to[data-v-1096702e]{opacity:0}.list-move[data-v-1096702e],.list-enter-active[data-v-1096702e],.list-leave-active[data-v-1096702e]{transition:all var(--animation-quick) ease}.list-enter-from[data-v-1096702e],.list-leave-to[data-v-1096702e]{opacity:0;transform:translateX(30px)}.list-leave-active[data-v-1096702e]{width:100%}","",{version:3,sources:["webpack://./src/NotificationsApp.vue"],names:[],mappings:"AACA,yCAEC,eAAA,CAGD,uCACC,8BAAA,CACA,aAAA,CAGD,iCACC,gBAAA,CAEA,mCACC,mCAAA,CAIF,qCACC,oBAAA,CACA,UAAA,CACA,WAAA,CAGD,wEAEC,8CAAA,CAGD,kEAEC,SAAA,CAGD,oGAGC,0CAAA,CAGD,kEAEC,SAAA,CACA,0BAAA,CAGD,oCACC,UAAA",sourcesContent:["\n.notification-container {\n\t/* Prevent slide animation to go out of the div */\n\toverflow: hidden;\n}\n\n.notification-wrapper {\n\tmax-height: calc(100vh - 50px * 4);\n\toverflow: auto;\n}\n\n::v-deep .empty-content {\n\tmargin: 12vh 10px;\n\n\tp {\n\t\tcolor: var(--color-text-maxcontrast);\n\t}\n}\n\n.icon-alert-outline {\n\tbackground-size: 64px;\n\twidth: 64px;\n\theight: 64px;\n}\n\n.fade-enter-active,\n.fade-leave-active {\n\ttransition: opacity var(--animation-quick) ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n\topacity: 0;\n}\n\n.list-move,\n.list-enter-active,\n.list-leave-active {\n\ttransition: all var(--animation-quick) ease;\n}\n\n.list-enter-from,\n.list-leave-to {\n\topacity: 0;\n\ttransform: translateX(30px);\n}\n\n.list-leave-active {\n\twidth: 100%;\n}\n"],sourceRoot:""}]);const r=o},2670:(e,n,i)=>{"use strict";i.r(n),i.d(n,{default:()=>yt});var s=i(6937),a=i(861),o=i.n(a),r=i(2490),c=i(2167),l=i(4024),u=i(9954),f=i(1766),d=i(1654),p=i(5108);function h(t,e,n,i,s,a,o){try{var r=t[a](o),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(i,s)}function m(t){return function(){var e=this,n=arguments;return new Promise((function(i,s){var a=t.apply(e,n);function o(t){h(a,i,s,o,r,"next",t)}function r(t){h(a,i,s,o,r,"throw",t)}o(void 0)}))}}const v={name:"Action",components:{NcButton:o()},props:{label:{type:String,default:"",required:!0},link:{type:String,default:"",required:!0},type:{type:String,default:"",required:!0},primary:{type:Boolean,default:!1,required:!0}},data:function(){return{tabbed:!1}},computed:{isWebLink:function(){return"WEB"===this.typeWithDefault},typeWithDefault:function(){return this.type||"GET"},buttonType:function(){return this.primary?"primary":"secondary"}},methods:{onClickActionButtonWeb:function(e){var n=this;return m(regeneratorRuntime.mark((function i(){var s;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,s={cancelAction:!1,notification:n.$parent.$props,action:{url:n.link,type:n.typeWithDefault}},i.next=4,(0,d.j8)("notifications:action:execute",s);case 4:s.cancelAction&&e.preventDefault(),i.next=11;break;case 7:i.prev=7,i.t0=i.catch(0),p.error("Failed to perform action",i.t0),(0,l.x2)(t("notifications","Failed to perform action"));case 11:case"end":return i.stop()}}),i,null,[[0,7]])})))()},onClickActionButton:function(){var e=this;return m(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,i={cancelAction:!1,notification:e.$parent.$props,action:{url:e.link,type:e.typeWithDefault}},n.next=4,(0,d.j8)("notifications:action:execute",i);case 4:if(!i.cancelAction){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,(0,s.Z)({method:e.typeWithDefault,url:e.link});case 8:e.$parent._$el.fadeOut(OC.menuSpeed),e.$parent.$emit("remove"),(0,d.j8)("notifications:action:executed",i);try{$("body").trigger(new $.Event("OCA.Notification.Action",{notification:e.$parent,action:{url:e.link,type:e.typeWithDefault}}))}catch(t){p.error(t)}n.next=18;break;case 14:n.prev=14,n.t0=n.catch(0),p.error("Failed to perform action",n.t0),(0,l.x2)(t("notifications","Failed to perform action"));case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))()}}};var g=i(5440);const b=(0,g.Z)(v,(function(){var t=this,e=t._self._c;return t.isWebLink?e("NcButton",{staticClass:"action-button pull-right",attrs:{type:"primary",href:t.link},on:{click:t.onClickActionButtonWeb}},[t._v("\n\t"+t._s(t.label)+"\n")]):t.isWebLink?t._e():e("NcButton",{staticClass:"action-button pull-right",attrs:{type:t.buttonType},on:{click:t.onClickActionButton}},[t._v("\n\t"+t._s(t.label)+"\n")])}),[],!1,null,null,null).exports;var y=i(9753),j=i(351),w=i.n(j),k=i(6697);const A={name:"DefaultParameter",props:{type:{type:String,required:!0},id:{type:[Number,String],required:!0},name:{type:String,required:!0},link:{type:String,default:""}},computed:{hasInternalLink:function(){return this.link&&("deck-board"===this.type||"deck-card"===this.type)}}};var C=i(6062),_=i.n(C),x=i(4036),N=i.n(x),I=i(6793),P=i.n(I),S=i(7892),B=i.n(S),T=i(1173),D=i.n(T),R=i(2464),O=i.n(R),Z=i(5723),z={};z.styleTagTransform=O(),z.setAttributes=B(),z.insert=P().bind(null,"head"),z.domAPI=N(),z.insertStyleElement=D();_()(Z.Z,z);Z.Z&&Z.Z.locals&&Z.Z.locals;const q=(0,g.Z)(A,(function(){var t=this,e=t._self._c;return t.hasInternalLink?e("a",{attrs:{href:t.link}},[e("strong",[t._v(t._s(t.name))])]):t.link?e("a",{staticClass:"external",attrs:{href:t.link,target:"_blank",rel:"noopener noreferrer"}},[e("strong",[t._v(t._s(t.name))])]):e("strong",[t._v(t._s(t.name))])}),[],!1,null,"39222bd6",null).exports;const F={name:"File",props:{type:{type:String,required:!0},id:{type:[Number,String],required:!0},name:{type:String,required:!0},path:{type:String,default:""},link:{type:String,default:""}},computed:{title:function(){var e=this.path.lastIndexOf("/"),n=this.path.indexOf("/"),i=this.path.substring(0===n?1:0,e);return 0===i.length?"":t("notifications","in {path}",{path:i})}}};const M=(0,g.Z)(F,(function(){var t=this;return(0,t._self._c)("a",{staticClass:"filename",attrs:{title:t.title,href:t.link}},[t._v(t._s(t.name))])}),[],!1,null,null,null).exports;var E=i(6122);const G={name:"User",components:{NcUserBubble:i.n(E)()},props:{type:{type:String,required:!0},id:{type:String,required:!0},name:{type:String,required:!0},server:{type:String,default:""}},computed:{cloudId:function(){return this.server?this.id+"@"+this.server:""}}};var W=i(7296),L={};L.styleTagTransform=O(),L.setAttributes=B(),L.insert=P().bind(null,"head"),L.domAPI=N(),L.insertStyleElement=D();_()(W.Z,L);W.Z&&W.Z.locals&&W.Z.locals;const U=(0,g.Z)(G,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"mention"},[t.cloudId?e("strong",{attrs:{title:t.cloudId}},[t._v("\n\t\t"+t._s(t.name)+"\n\t")]):e("NcUserBubble",{attrs:{"display-name":t.name,user:t.id}})],1)}),[],!1,null,"b064c4b8",null).exports;var H=i(5108);function V(t,e,n,i,s,a,o){try{var r=t[a](o),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(i,s)}const J={name:"Notification",components:{Action:b,NcButton:o(),Close:r.Z,Message:c.Z,RichText:k.ZP},props:{notificationId:{type:Number,default:-1},datetime:{type:String,default:""},app:{type:String,default:""},icon:{type:String,default:""},link:{type:String,default:""},externalLink:{type:String,default:""},user:{type:String,default:""},message:{type:String,default:""},messageRich:{type:String,default:""},messageRichParameters:{type:[Object,Array],default:function(){return{}}},subject:{type:String,default:""},subjectRich:{type:String,default:""},subjectRichParameters:{type:[Object,Array],default:function(){return{}}},objectType:{type:String,default:""},objectId:{type:String,default:""},shouldNotify:{type:Boolean,default:!0},actions:{type:Array,default:function(){return[]}},index:{type:Number,default:-1}},data:function(){return{showFullMessage:!1}},_$el:null,computed:{timestamp:function(){return"warning"===this.datetime?0:new Date(this.datetime).valueOf()},absoluteDate:function(){return"warning"===this.datetime?"":w()(this.timestamp).format("LLL")},relativeDate:function(){if("warning"===this.datetime)return"";var e=w()().diff(w()(this.timestamp));return e>=0&&e<45e3?t("core","seconds ago"):w()(this.timestamp).fromNow()},useLink:function(){var t=this;if(!this.link)return!1;var e=!1;return Object.keys(this.subjectRichParameters).forEach((function(n){t.subjectRichParameters[n].link&&(e=!0)})),!e},preparedSubjectParameters:function(){return this.prepareParameters(this.subjectRichParameters)},preparedMessageParameters:function(){return this.prepareParameters(this.messageRichParameters)},isCollapsedMessage:function(){return this.message.length>200&&!this.showFullMessage}},mounted:function(){if(this._$el=$(this.$el),void 0===this.$parent.$parent.$parent.showBrowserNotifications&&H.error("Failed to read showBrowserNotifications property from App component"),this.$parent.$parent.$parent.backgroundFetching){var t={notification:this.$props};(0,d.j8)("notifications:notification:received",t)}if(this.shouldNotify&&this.$parent.$parent.$parent.showBrowserNotifications)if(this._createWebNotification(),"spreed"===this.app&&"call"===this.objectType)(0,u.j)("notifications","sound_talk")&&new f.Howl({src:[(0,y.generateFilePath)("notifications","img","talk.ogg")],volume:.5}).play();else if((0,u.j)("notifications","sound_notification")){new f.Howl({src:[(0,y.generateFilePath)("notifications","img","notification.ogg")],volume:.5}).play()}},methods:{prepareParameters:function(t){var e={};return Object.keys(t).forEach((function(n){var i=t[n].type;e[n]="user"===i?{component:U,props:t[n]}:"file"===i?{component:M,props:t[n]}:{component:q,props:t[n]}})),e},onClickMessage:function(t){(t.target.closest(".rich-text--wrapper")||!this.messageRich&&this.message)&&(this.showFullMessage=!this.showFullMessage)},onDismissNotification:function(){var e=this;s.Z.delete((0,y.generateOcsUrl)("apps/notifications/api/v2/notifications/{id}",{id:this.notificationId})).then((function(){e.$emit("remove",e.index)})).catch((function(){(0,l.x2)(t("notifications","Failed to dismiss notification"))}))},_createWebNotification:function(){var t=new Notification(this.subject,{title:this.subject,lang:OC.getLocale(),body:this.message,icon:this.icon,tag:this.notificationId});this.link&&(t.onclick=function(){var t,e=(t=regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={cancelAction:!1,notification:this.$props,action:{url:this.link,type:"WEB"}},t.next=3,(0,d.j8)("notifications:action:execute",n);case 3:n.cancelAction||(H.debug("Redirecting because of a click onto a notification",this.link),window.location.href=this.link),window.focus();case 5:case"end":return t.stop()}}),t,this)})),function(){var e=this,n=arguments;return new Promise((function(i,s){var a=t.apply(e,n);function o(t){V(a,i,s,o,r,"next",t)}function r(t){V(a,i,s,o,r,"throw",t)}o(void 0)}))});return function(t){return e.apply(this,arguments)}}().bind(this))}}};var X=i(4994),Y={};Y.styleTagTransform=O(),Y.setAttributes=B(),Y.insert=P().bind(null,"head"),Y.domAPI=N(),Y.insertStyleElement=D();_()(X.Z,Y);X.Z&&X.Z.locals&&X.Z.locals;const K=(0,g.Z)(J,(function(){var t=this,e=t._self._c;return e("li",{staticClass:"notification",attrs:{"data-id":t.notificationId,"data-timestamp":t.timestamp,"data-object-type":t.objectType,"data-app":t.app}},[e("div",{staticClass:"notification-heading"},[e("span",{staticClass:"hidden-visually"},[t._v(t._s(t.absoluteDate))]),t._v(" "),t.timestamp?e("span",{staticClass:"notification-time live-relative-timestamp",attrs:{title:t.absoluteDate,"data-timestamp":t.timestamp}},[t._v(t._s(t.relativeDate))]):t._e(),t._v(" "),t.timestamp?e("NcButton",{staticClass:"notification-dismiss-button",attrs:{type:"tertiary","aria-label":t.t("notifications","Dismiss")},on:{click:t.onDismissNotification},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Close",{attrs:{size:20}})]},proxy:!0}],null,!1,2121748766)}):t._e()],1),t._v(" "),t.externalLink?e("a",{staticClass:"notification-subject full-subject-link external",attrs:{href:t.externalLink,target:"_blank",rel:"noreferrer noopener"}},[e("span",{staticClass:"image"},[e("img",{staticClass:"notification-icon",attrs:{src:t.icon,alt:""}})]),t._v(" "),e("span",{staticClass:"subject"},[t._v(t._s(t.subject)+" ↗")])]):t.useLink?e("a",{staticClass:"notification-subject full-subject-link",attrs:{href:t.link}},[t.icon?e("span",{staticClass:"image"},[e("img",{staticClass:"notification-icon",attrs:{src:t.icon,alt:""}})]):t._e(),t._v(" "),t.subjectRich?e("RichText",{attrs:{text:t.subjectRich,arguments:t.preparedSubjectParameters}}):e("span",{staticClass:"subject"},[t._v(t._s(t.subject))])],1):e("div",{staticClass:"notification-subject"},[t.icon?e("span",{staticClass:"image"},[e("img",{staticClass:"notification-icon",attrs:{src:t.icon,alt:""}})]):t._e(),t._v(" "),t.subjectRich?e("RichText",{attrs:{text:t.subjectRich,arguments:t.preparedSubjectParameters}}):e("span",{staticClass:"subject"},[t._v(t._s(t.subject))])],1),t._v(" "),t.message?e("div",{staticClass:"notification-message",on:{click:t.onClickMessage}},[e("div",{staticClass:"message-container",class:{collapsed:t.isCollapsedMessage}},[t.messageRich?e("RichText",{attrs:{text:t.messageRich,arguments:t.preparedMessageParameters,autolink:!0}}):e("span",[t._v(t._s(t.message))])],1),t._v(" "),t.isCollapsedMessage?e("div",{staticClass:"notification-overflow"}):t._e()]):t._e(),t._v(" "),t.actions.length?e("div",{staticClass:"notification-actions"},t._l(t.actions,(function(n,i){return e("Action",t._b({key:i},"Action",n,!1))})),1):t.externalLink?e("div",{staticClass:"notification-actions"},[e("NcButton",{staticClass:"action-button pull-right",attrs:{type:"primary",href:"https://nextcloud.com/pushnotifications",target:"_blank",rel:"noreferrer noopener"},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Message",{attrs:{size:20}})]},proxy:!0}])},[t._v("\n\t\t\t"+t._s(t.t("notifications","Contact Nextcloud GmbH"))+" ↗\n\t\t")])],1):t._e()])}),[],!1,null,"c92968fc",null).exports;var Q=i(5994);const tt=(0,i(2556).getBuilder)("notifications").clearOnLogout().persist().build();function et(t,e,n,i,s,a,o){try{var r=t[a](o),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(i,s)}function nt(t){return function(){var e=this,n=arguments;return new Promise((function(i,s){var a=t.apply(e,n);function o(t){et(a,i,s,o,r,"next",t)}function r(t){et(a,i,s,o,r,"throw",t)}o(void 0)}))}}var it=function(){var t=nt(regeneratorRuntime.mark((function t(e,n,i,s){var a,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=parseInt(tt.getItem("lastUpdated"),10),o=tt.getItem("tabId"),r=w()().format("X"),!(i||o===e&&a+25<r||o===e&&s||a+35<r)){t.next=8;break}return tt.setItem("tabId",e),tt.setItem("lastUpdated",r),t.next=8,at(n);case 8:return t.abrupt("return",{status:parseInt(tt.getItem("status"),10),headers:JSON.parse(tt.getItem("headers")||"[]"),data:JSON.parse(tt.getItem("data")||"[]"),tabId:tt.getItem("tabId"),lastUpdated:parseInt(tt.getItem("lastUpdated"),10)});case 9:case"end":return t.stop()}}),t)})));return function(e,n,i,s){return t.apply(this,arguments)}}(),st=function(t){return t.notificationId=t.notification_id,t.objectId=t.object_id,t.objectType=t.object_type,delete t.notification_id,delete t.object_id,delete t.object_type,t},at=function(){var t=nt(regeneratorRuntime.mark((function t(e){var n,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},e&&(n={headers:{"If-None-Match":e}}),t.prev=2,t.next=5,s.Z.get((0,y.generateOcsUrl)("apps/notifications/api/v2/notifications"),n);case 5:i=t.sent,tt.setItem("status",""+i.status),204!==i.status&&(tt.setItem("headers",JSON.stringify(i.headers)),tt.setItem("data",JSON.stringify(i.data.ocs.data.map(st)))),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),null!==t.t0&&void 0!==t.t0&&null!==(a=t.t0.response)&&void 0!==a&&a.status?tt.setItem("status",""+t.t0.response.status):tt.setItem("status","500");case 13:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e){return t.apply(this,arguments)}}(),ot=i(2534),rt=i(9902),ct=i(3455),lt=i.n(ct),ut=i(2515),ft=i(5750),dt=i.n(ft),pt=i(5108);function ht(t,e,n,i,s,a,o){try{var r=t[a](o),c=r.value}catch(t){return void n(t)}r.done?e(c):Promise.resolve(c).then(i,s)}function mt(t){return function(){var e=this,n=arguments;return new Promise((function(i,s){var a=t.apply(e,n);function o(t){ht(a,i,s,o,r,"next",t)}function r(t){ht(a,i,s,o,r,"throw",t)}o(void 0)}))}}const vt={name:"NotificationsApp",components:{NcButton:o(),Close:r.Z,Bell:rt.Z,Message:c.Z,NcEmptyContent:lt(),NcHeaderMenu:dt(),Notification:K},data:function(){var t;return{webNotificationsGranted:!1,backgroundFetching:!1,hasNotifyPush:!1,shutdown:!1,theming:(null===(t=(0,ut.getCapabilities)())||void 0===t?void 0:t.theming)||{},hasThrottledPushNotifications:!1,notifications:[],lastETag:null,lastTabId:null,userStatus:null,tabId:null,pollIntervalBase:3e4,pollIntervalCurrent:3e4,interval:null,pushEndpoints:null,open:!1}},_$icon:null,computed:{isRedThemed:function(){var t;if(null!==(t=this.theming)&&void 0!==t&&t.color){var e=this.rgbToHsl(this.theming.color.substring(1,3),this.theming.color.substring(3,5),this.theming.color.substring(5,7)),n=360*e[0];return(n>=330||n<=15)&&e[1]>.4&&(e[2]>.1||e[2]<.6)}return!1},isOrangeThemed:function(){var t;if(null!==(t=this.theming)&&void 0!==t&&t.color){var e=this.rgbToHsl(this.theming.color.substring(1,3),this.theming.color.substring(3,5),this.theming.color.substring(5,7)),n=360*e[0];return(n>=305||n<=64)&&e[1]>.7&&(e[2]>.1||e[2]<.6)}return!1},showBrowserNotifications:function(){return this.backgroundFetching&&this.webNotificationsGranted&&"dnd"!==this.userStatus&&this.tabId===this.lastTabId},emptyContentMessage:function(){return null===this.webNotificationsGranted?t("notifications","Requesting browser permissions to show notifications"):this.hasThrottledPushNotifications?t("notifications","Push notifications might be unreliable"):t("notifications","No notifications")},emptyContentDescription:function(){return this.hasThrottledPushNotifications?t("notifications","Nextcloud GmbH sponsors a free push notification gateway for private users. To ensure good service, the gateway limits the number of push notifications per server. For enterprise users, a more scalable gateway is available. Contact Nextcloud GmbH for more information."):""},warningIcon:function(){return(0,y.imagePath)("core","actions/alert-outline.svg")}},mounted:function(){var t=this;this.tabId=OC.requestToken||""+Math.random(),this._$icon=$(this.$refs.icon),this._oldcount=0,pt.debug("Registering notifications container as a menu"),OC.registerMenu($(this.$refs.button),$(this.$refs.container),void 0,!0),this.checkWebNotificationPermissions(),this._fetch(),(0,ot.listen)("notify_notification",(function(){t._fetchAfterNotifyPush()}))&&(pt.debug("Has notify_push enabled, slowing polling to 15 minutes"),this.pollIntervalBase=9e5,this.hasNotifyPush=!0),this._setPollingInterval(this.pollIntervalBase),this._watchTabVisibility(),(0,d.Ld)("networkOffline",this.handleNetworkOffline),(0,d.Ld)("networkOnline",this.handleNetworkOnline),(0,d.Ld)("user_status:status.updated",this.userStatusUpdated)},beforeDestroy:function(){(0,d.r1)("user_status:status.updated",this.userStatusUpdated),(0,d.r1)("networkOffline",this.handleNetworkOffline),(0,d.r1)("networkOnline",this.handleNetworkOnline)},methods:{userStatusUpdated:function(t){(0,Q.ts)().uid===t.userId&&(this.userStatus=t.status)},onOpen:function(){this.requestWebNotificationPermissions()},handleNetworkOffline:function(){pt.debug("Network is offline, slowing down pollingInterval to "+10*this.pollIntervalBase),this._setPollingInterval(10*this.pollIntervalBase)},handleNetworkOnline:function(){this._fetch(),pt.debug("Network is online, reseting pollingInterval to "+this.pollIntervalBase),this._setPollingInterval(this.pollIntervalBase)},setupBackgroundFetcher:function(){OC.config.session_keepalive?(pt.debug("Started background fetcher as session_keepalive is enabled"),this.interval=window.setInterval(this._backgroundFetch.bind(this),this.pollIntervalCurrent)):pt.debug("Did not start background fetcher as session_keepalive is off")},onDismissAll:function(){var e=this;s.Z.delete((0,y.generateOcsUrl)("apps/notifications/api/v2/notifications")).then((function(){e.notifications=[]})).catch((function(){(0,l.x2)(t("notifications","Failed to dismiss all notifications"))}))},onRemove:function(t){this.notifications.splice(t,1)},rgbToHsl:function(t,e,n){t=parseInt(t,16)/255,e=parseInt(e,16)/255,n=parseInt(n,16)/255;var i,s,a=Math.max(t,e,n),o=Math.min(t,e,n),r=(a+o)/2;if(a===o)i=s=0;else{var c=a-o;switch(s=r>.5?c/(2-a-o):c/(a+o),a){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4}i/=6}return[i,s,r]},_updateDocTitleOnNewNotifications:function(t){t.length>this._oldcount&&(this._oldcount=t.length,this.backgroundFetching&&document.hidden&&(document.title.startsWith("* ")||(document.title="* "+document.title)))},_restoreTitle:function(){document.title.startsWith("* ")&&(document.title=document.title.substring(2))},_fetchAfterNotifyPush:function(){var t=this;this.backgroundFetching=!0,this.hasNotifyPush&&this.tabId!==this.lastTabId?(pt.debug("Deferring notification refresh from browser storage are notify_push event to give the last tab the chance to do it"),setTimeout((function(){t._fetch()}),5e3)):(pt.debug("Refreshing notifications are notify_push event"),this._fetch())},_fetch:function(){var t=this;return mt(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,it(t.tabId,t.lastETag,!t.backgroundFetching,t.hasNotifyPush);case 2:204===(n=e.sent).status?(pt.debug("Fetching notifications but no content, slowing down polling to "+10*t.pollIntervalBase),t._setPollingInterval(10*t.pollIntervalBase)):200===n.status?(t.userStatus=n.headers["x-nextcloud-user-status"],t.lastETag=n.headers.etag,t.lastTabId=n.tabId,t.notifications=n.data,pt.debug("Got notification data"),t._setPollingInterval(t.pollIntervalBase),t._updateDocTitleOnNewNotifications(t.notifications)):304===n.status?(pt.debug("No new notification data received"),t._setPollingInterval(t.pollIntervalBase)):503===n.status?(pt.info("Slowing down notifications: instance is in maintenance mode."),t._setPollingInterval(10*t.pollIntervalBase)):404===n.status?(pt.info("Slowing down notifications: app is disabled."),t._setPollingInterval(10*t.pollIntervalBase)):(pt.info("Slowing down notifications: Status "+n.status),t._setPollingInterval(10*t.pollIntervalBase));case 4:case"end":return e.stop()}}),e)})))()},_backgroundFetch:function(){this.backgroundFetching=!0,this._fetch()},_watchTabVisibility:function(){document.addEventListener("visibilitychange",this._visibilityChange,!1)},_visibilityChange:function(){document.hidden||this._restoreTitle()},_setPollingInterval:function(t){pt.debug("Polling interval updated to "+t),this.interval&&t===this.pollIntervalCurrent||(this.interval&&(window.clearInterval(this.interval),this.interval=null),this.pollIntervalCurrent=t,this.setupBackgroundFetcher())},_shutDownNotifications:function(t){pt.debug("Shutting down notifications "+(t?"temporary":"bye")),this.interval&&(window.clearInterval(this.interval),this.interval=null),this.shutdown=!t},checkWebNotificationPermissions:function(){return"Notification"in window?"granted"===window.Notification.permission?(pt.debug("Notifications permissions granted"),void(this.webNotificationsGranted=!0)):"denied"===window.Notification.permission?(pt.debug("Notifications permissions denied"),void(this.webNotificationsGranted=!1)):"http:"===window.location.protocol?(pt.debug("Notifications require HTTPS"),void(this.webNotificationsGranted=!1)):(pt.info("Notifications permissions not yet requested"),void(this.webNotificationsGranted=null)):(pt.info("Browser does not support notifications"),void(this.webNotificationsGranted=!1))},requestWebNotificationPermissions:function(){var t=this;return mt(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t.webNotificationsGranted){e.next=2;break}return e.abrupt("return");case 2:pt.info("Requesting notifications permissions"),window.Notification.requestPermission().then((function(e){t.webNotificationsGranted="granted"===e}));case 4:case"end":return e.stop()}}),e)})))()}}};var gt=i(9908),bt={};bt.styleTagTransform=O(),bt.setAttributes=B(),bt.insert=P().bind(null,"head"),bt.domAPI=N(),bt.insertStyleElement=D();_()(gt.Z,bt);gt.Z&&gt.Z.locals&&gt.Z.locals;const yt=(0,g.Z)(vt,(function(){var t=this,e=t._self._c;return t.shutdown?t._e():e("NcHeaderMenu",{staticClass:"notifications-button",attrs:{id:"notifications","exclude-click-outside-classes":"popover",open:t.open,"aria-label":t.t("notifications","Notifications")},on:{"update:open":function(e){t.open=e},open:t.onOpen},scopedSlots:t._u([{key:"trigger",fn:function(){return[0!==t.notifications.length||null===t.webNotificationsGranted||t.hasThrottledPushNotifications?e("svg",{staticClass:"notifications-button__icon",attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{d:"M 19,11.79 C 18.5,11.92 18,12 17.5,12 14.47,12 12,9.53 12,6.5 12,5.03 12.58,3.7 13.5,2.71 13.15,2.28 12.61,2 12,2 10.9,2 10,2.9 10,4 V 4.29 C 7.03,5.17 5,7.9 5,11 v 6 l -2,2 v 1 H 21 V 19 L 19,17 V 11.79 M 12,23 c 1.11,0 2,-0.89 2,-2 h -4 c 0,1.11 0.9,2 2,2 z"}}),t._v(" "),e("path",{staticClass:"notification__dot",class:t.isRedThemed?"notification__dot--white":"",attrs:{d:"M 21,6.5 C 21,8.43 19.43,10 17.5,10 15.57,10 14,8.43 14,6.5 14,4.57 15.57,3 17.5,3 19.43,3 21,4.57 21,6.5"}}),t._v(" "),t.hasThrottledPushNotifications?e("path",{staticClass:"notification__dot notification__dot--warning",class:t.isOrangeThemed?"notification__dot--white":"",attrs:{d:"M 21,6.5 C 21,8.43 19.43,10 17.5,10 15.57,10 14,8.43 14,6.5 14,4.57 15.57,3 17.5,3 19.43,3 21,4.57 21,6.5"}}):t._e()]):e("Bell",{staticClass:"notifications-button__icon",attrs:{size:20,title:t.t("notifications","Notifications")}})]},proxy:!0}],null,!1,760905135)},[t._v(" "),e("div",{ref:"container",staticClass:"notification-container"},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.notifications.length>0?e("div",[e("transition-group",{staticClass:"notification-wrapper",attrs:{name:"list",tag:"ul"}},[t.hasThrottledPushNotifications?e("Notification",{key:-2016,attrs:{datetime:"warning",app:"core",icon:t.warningIcon,"external-link":"https://nextcloud.com/pushnotifications",message:t.emptyContentDescription,subject:t.emptyContentMessage,index:2016}}):t._e(),t._v(" "),t._l(t.notifications,(function(n,i){return e("Notification",t._b({key:n.notificationId,attrs:{index:i},on:{remove:t.onRemove}},"Notification",n,!1))}))],2),t._v(" "),t.notifications.length>0?e("span",{staticClass:"dismiss-all",on:{click:t.onDismissAll}},[e("NcButton",{attrs:{type:"tertiary"},on:{click:t.onDismissAll},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Close",{attrs:{size:20}})]},proxy:!0}],null,!1,2121748766)},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("notifications","Dismiss all notifications"))+"\n\t\t\t\t\t")])],1):t._e()],1):e("NcEmptyContent",{attrs:{title:t.emptyContentMessage,description:t.emptyContentDescription},scopedSlots:t._u([{key:"icon",fn:function(){return[t.hasThrottledPushNotifications?e("span",{staticClass:"icon icon-alert-outline"}):e("Bell")]},proxy:!0},t.hasThrottledPushNotifications?{key:"action",fn:function(){return[e("NcButton",{attrs:{type:"primary",href:"https://nextcloud.com/pushnotifications",target:"_blank",rel:"noreferrer noopener"},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Message",{attrs:{size:20}})]},proxy:!0}],null,!1,1386745923)},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("notifications","Contact Nextcloud GmbH"))+" ↗\n\t\t\t\t\t")])]},proxy:!0}:null],null,!0)})],1)],1)])}),[],!1,null,"1096702e",null).exports}}]);
//# sourceMappingURL=notifications-node_modules_moment_locale_sync_recursive_-src_NotificationsApp_vue.js.map?v=44492fc5c0605abb0628