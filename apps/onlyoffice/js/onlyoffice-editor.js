!function(e,o){o.Onlyoffice=_.extend({AppName:"onlyoffice",inframe:!1,inviewer:!1,fileId:null,shareToken:null,insertImageType:null},o.Onlyoffice),o.Onlyoffice.InitEditor=function(){o.Onlyoffice.fileId=e("#iframeEditor").data("id"),o.Onlyoffice.shareToken=e("#iframeEditor").data("sharetoken");const n=e("#iframeEditor").data("directtoken");o.Onlyoffice.template=e("#iframeEditor").data("template"),o.Onlyoffice.inframe=!!e("#iframeEditor").data("inframe"),o.Onlyoffice.inviewer=!!e("#iframeEditor").data("inviewer"),o.Onlyoffice.filePath=e("#iframeEditor").data("path"),o.Onlyoffice.anchor=e("#iframeEditor").attr("data-anchor");const i=localStorage.getItem("nick");if(o.Onlyoffice.currentWindow=window,o.Onlyoffice.currentUser=OC.getCurrentUser(),o.Onlyoffice.inframe&&(o.Onlyoffice.currentWindow=window.parent,o.Onlyoffice.currentUser=o.Onlyoffice.currentWindow.OC.getCurrentUser()),!o.Onlyoffice.fileId&&!o.Onlyoffice.shareToken&&!n)return void o.Onlyoffice.showMessage(t(o.Onlyoffice.AppName,"FileId is empty"),"error",{timeout:-1});let f=OC.linkToOCS("apps/"+o.Onlyoffice.AppName+"/api/v1/config",2)+(o.Onlyoffice.fileId||0);const r=[],a=e("#iframeEditor").data("path");a&&r.push("filePath="+encodeURIComponent(a)),o.Onlyoffice.shareToken&&r.push("shareToken="+encodeURIComponent(o.Onlyoffice.shareToken)),n&&(e("html").addClass("onlyoffice-full-page"),r.push("directToken="+encodeURIComponent(n))),o.Onlyoffice.template&&r.push("template=true"),i&&"null"!==i&&r.push("guestName="+encodeURIComponent(i)),o.Onlyoffice.anchor&&r.push("anchor="+encodeURIComponent(o.Onlyoffice.anchor)),(o.Onlyoffice.inframe||n)&&r.push("inframe=true"),o.Onlyoffice.inviewer&&r.push("inviewer=true"),o.Onlyoffice.Desktop&&r.push("desktop=true"),r.length&&(f+="?"+r.join("&")),e.ajax({url:f,success:function(n){if(n){if(o.Onlyoffice.device=n.type,"mobile"===o.Onlyoffice.device&&o.Onlyoffice.resizeEvents(),n.redirectUrl)return void(location.href=n.redirectUrl);if(null!=n.error)return void o.Onlyoffice.showMessage(n.error,"error",{timeout:-1});if(!n.documentServerUrl)return void o.Onlyoffice.showMessage("ONLYOFFICE cannot be reached. Please contact admin","error",{timeout:-1});const i=document.createElement("script");i.src=n.documentServerUrl+"web-apps/apps/api/documents/api.js?shardKey="+n.document.key,i.setAttribute("nonce",btoa(OC.requestToken)),i.onerror=function(){o.Onlyoffice.showMessage(t(o.Onlyoffice.AppName,"ONLYOFFICE cannot be reached. Please contact admin"),"error",{timeout:-1})},i.onload=function(){if("undefined"==typeof DocsAPI)return void o.Onlyoffice.showMessage(t(o.Onlyoffice.AppName,"ONLYOFFICE cannot be reached. Please contact admin"),"error",{timeout:-1});const i=DocsAPI.DocEditor.version().split(".");if(i[0]<6||6===parseInt(i[0])&&0===parseInt(i[1]))return void o.Onlyoffice.showMessage(t(o.Onlyoffice.AppName,"Not supported version"),"error",{timeout:-1});let f=null,r=null;const a=function(e){if(clearTimeout(r),f!==e.data){const t=function(){o.Onlyoffice.currentWindow.document.title=n.document.title+(e.data?" *":"")+" - "+oc_defaults.title,f=e.data};!1===e||e.data?t():r=setTimeout(t,500)}};a(!1),o.Onlyoffice.documentType=n.documentType,n.events={onDocumentStateChange:a,onDocumentReady:o.Onlyoffice.onDocumentReady,onMakeActionLink:o.Onlyoffice.onMakeActionLink},n.editorConfig.tenant&&(n.events.onAppReady=function(){o.Onlyoffice.docEditor.showMessage(t(o.Onlyoffice.AppName,"You are using public demo ONLYOFFICE Docs server. Please do not store private sensitive data."))}),(o.Onlyoffice.inframe&&!o.Onlyoffice.shareToken||o.Onlyoffice.currentUser.uid)&&(n.events.onRequestSaveAs=o.Onlyoffice.onRequestSaveAs,n.events.onRequestInsertImage=o.Onlyoffice.onRequestInsertImage,n.events.onRequestMailMergeRecipients=o.Onlyoffice.onRequestMailMergeRecipients,n.events.onRequestCompareFile=o.Onlyoffice.onRequestSelectDocument,n.events.onRequestSelectDocument=o.Onlyoffice.onRequestSelectDocument,n.events.onRequestSendNotify=o.Onlyoffice.onRequestSendNotify,n.events.onRequestReferenceData=o.Onlyoffice.onRequestReferenceData,n.events.onRequestOpen=o.Onlyoffice.onRequestOpen,n.events.onRequestReferenceSource=o.Onlyoffice.onRequestReferenceSource,n.events.onMetaChange=o.Onlyoffice.onMetaChange,o.Onlyoffice.currentUser.uid&&(n.events.onRequestUsers=o.Onlyoffice.onRequestUsers),o.Onlyoffice.filePath||(o.Onlyoffice.filePath=n._file_path),o.Onlyoffice.template||(n.events.onRequestHistory=o.Onlyoffice.onRequestHistory,n.events.onRequestHistoryData=o.Onlyoffice.onRequestHistoryData,n.events.onRequestRestore=o.Onlyoffice.onRequestRestore,n.events.onRequestHistoryClose=o.Onlyoffice.onRequestHistoryClose)),(o.Onlyoffice.directEditor||o.Onlyoffice.inframe)&&(n.events.onRequestClose=o.Onlyoffice.onRequestClose),o.Onlyoffice.inframe&&n._files_sharing&&!o.Onlyoffice.shareToken&&window.parent.OCA.Onlyoffice.context&&(n.events.onRequestSharingSettings=o.Onlyoffice.onRequestSharingSettings),o.Onlyoffice.docEditor=new DocsAPI.DocEditor("iframeEditor",n),o.Onlyoffice.directEditor&&o.Onlyoffice.directEditor.loaded(),o.Onlyoffice.directEditor||"mobile"!==n.type||"fixed"!==e("#app > iframe").css("position")||e("#app > iframe").css("height","calc(100% - 50px)");const c=OC.filePath(o.Onlyoffice.AppName,"img",o.Onlyoffice.documentType+".ico");o.Onlyoffice.inframe?window.parent.postMessage({method:"changeFavicon",param:c},"*"):e('link[rel="icon"]').attr("href",c)},document.head.appendChild(i)}}})},o.Onlyoffice.onRequestHistory=function(n){e.get(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/history?fileId={fileId}",{fileId:o.Onlyoffice.fileId||0}),(function(e){o.Onlyoffice.refreshHistory(e,n)}))},o.Onlyoffice.onRequestHistoryData=function(n){const t=n.data;e.get(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/version?fileId={fileId}&version={version}",{fileId:o.Onlyoffice.fileId||0,version:t}),(function(e){e.error&&(e={error:e.error,version:t}),o.Onlyoffice.docEditor.setHistoryData(e)}))},o.Onlyoffice.onRequestRestore=function(n){const t=n.data.version;e.ajax({method:"PUT",url:OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/restore"),data:{fileId:o.Onlyoffice.fileId||0,version:t},success:function(e){o.Onlyoffice.refreshHistory(e,t),o.Onlyoffice.inframe&&window.parent.postMessage({method:"onRefreshVersionsDialog"},"*")}})},o.Onlyoffice.onRequestHistoryClose=function(){location.reload(!0)},o.Onlyoffice.onDocumentReady=function(){o.Onlyoffice.inframe&&window.parent.postMessage({method:"onDocumentReady",param:{}},"*"),o.Onlyoffice.resize(),o.Onlyoffice.setViewport()},o.Onlyoffice.onRequestSaveAs=function(e){const n={name:e.data.title,url:e.data.url};if(o.Onlyoffice.filePath){const e=o.Onlyoffice.filePath.split("/");e.pop(),e.shift(),n.dir="/"+e.join("/")}o.Onlyoffice.inframe?window.parent.postMessage({method:"editorRequestSaveAs",param:n},"*"):OC.dialogs.filepicker(t(o.Onlyoffice.AppName,"Save as"),(function(e){n.dir=e,o.Onlyoffice.editorSaveAs(n)}),!1,"httpd/unix-directory",!0,OC.dialogs.FILEPICKER_TYPE_CHOOSE,n.dir)},o.Onlyoffice.editorSaveAs=function(n){e.post(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/save"),n,(function(e){e.error?o.Onlyoffice.showMessage(e.error,"error"):o.Onlyoffice.showMessage(t(o.Onlyoffice.AppName,"File saved")+" ("+e.name+")")}))},o.Onlyoffice.onRequestInsertImage=function(e){const n=["image/bmp","image/x-bmp","image/x-bitmap","application/bmp","image/gif","image/tiff","image/jpeg","image/jpg","application/jpg","application/x-jpg","image/png","image/x-png","application/png","application/x-png"];e.data&&(o.Onlyoffice.insertImageType=e.data.c),o.Onlyoffice.inframe?window.parent.postMessage({method:"editorRequestInsertImage",param:n},"*"):OC.dialogs.filepicker(t(o.Onlyoffice.AppName,"Insert image"),o.Onlyoffice.editorInsertImage,!1,n,!0)},o.Onlyoffice.editorInsertImage=function(n){e.get(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/url?filePath={filePath}",{filePath:n}),(function(e){e.error?o.Onlyoffice.showMessage(e.error,"error"):(o.Onlyoffice.insertImageType&&(e.c=o.Onlyoffice.insertImageType),o.Onlyoffice.docEditor.insertImage(e))}))},o.Onlyoffice.onRequestMailMergeRecipients=function(){const e=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];o.Onlyoffice.inframe?window.parent.postMessage({method:"editorRequestMailMergeRecipients",param:e},"*"):OC.dialogs.filepicker(t(o.Onlyoffice.AppName,"Select recipients"),o.Onlyoffice.editorSetRecipient,!1,e,!0)},o.Onlyoffice.editorSetRecipient=function(n){e.get(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/url?filePath={filePath}",{filePath:n}),(function(e){e.error?o.Onlyoffice.showMessage(e.error,"error"):o.Onlyoffice.docEditor.setMailMergeRecipients(e)}))},o.Onlyoffice.editorReferenceSource=function(n){n!==o.Onlyoffice.filePath?e.post(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/reference"),{path:n},(function(e){e.error?o.Onlyoffice.showMessage(e.error,"error"):o.Onlyoffice.docEditor.setReferenceSource(e)})):o.Onlyoffice.showMessage(t(o.Onlyoffice.AppName,"The data source must not be the current document"),"error")},o.Onlyoffice.onRequestClose=function(){o.Onlyoffice.directEditor?o.Onlyoffice.directEditor.close():(o.Onlyoffice.docEditor.destroyEditor(),window.parent.postMessage({method:"editorRequestClose"},"*"))},o.Onlyoffice.onRequestSharingSettings=function(){window.parent.postMessage({method:"editorRequestSharingSettings"},"*")},o.Onlyoffice.onRequestSelectDocument=function(e){const n=["application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(o.Onlyoffice.inframe)window.parent.postMessage({method:"editorRequestSelectDocument",param:n,documentSelectionType:e.data.c},"*");else{let i;switch(e.data.c){case"combine":i=t(o.Onlyoffice.AppName,"Select file to combine");break;case"compare":i=t(o.Onlyoffice.AppName,"Select file to compare");break;case"insert-text":i=t(o.Onlyoffice.AppName,"Select file to insert text");break;default:i=t(o.Onlyoffice.AppName,"Select file")}OC.dialogs.filepicker(i,o.Onlyoffice.editorSetRequested.bind({documentSelectionType:e.data.c}),!1,n,!0)}},o.Onlyoffice.editorSetRequested=function(n){const t=this.documentSelectionType;e.get(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/url?filePath={filePath}",{filePath:n}),(function(e){e.error?OCP.Toast.error(e.error):(e.c=t,o.Onlyoffice.docEditor.setRequestedDocument(e))}))},o.Onlyoffice.onMakeActionLink=function(e){let n=location.href;if(e&&e.data){const o=n.indexOf("#");-1!==parseInt(o)&&(n=n.substring(0,o));let t=JSON.stringify(e.data);t="anchor="+encodeURIComponent(t);const i=/inframe=([^&]*&?)/g;i.test(n)&&(n=n.replace(i,t));const f=/anchor=([^&]*)/g;f.test(n)?n=n.replace(f,t):(n+=-1===n.indexOf("?")?"?":"&",n+=t)}o.Onlyoffice.docEditor.setActionLink(n)},o.Onlyoffice.onRequestUsers=function(n){const t=void 0!==n.data.c?n.data.c:null;"info"===t?e.get(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/userInfo?userIds={userIds}",{userIds:JSON.stringify(n.data.id)}),(function(e){o.Onlyoffice.docEditor.setUsers({c:t,users:e})})):e.get(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/users?fileId={fileId}&operationType="+t,{fileId:o.Onlyoffice.fileId||0}),(function(e){o.Onlyoffice.docEditor.setUsers({c:t,users:e})}))},o.Onlyoffice.onRequestSendNotify=function(n){const t=n.data.actionLink,i=n.data.message,f=n.data.emails,r=o.Onlyoffice.fileId;e.post(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/mention"),{fileId:r,anchor:JSON.stringify(t),comment:i,emails:f},(function(e){e.error?o.Onlyoffice.showMessage(e.error,"error"):o.Onlyoffice.showMessage(e.message)}))},o.Onlyoffice.onRequestReferenceData=function(n){const t=n.data.link,i=n.data.referenceData,f=n.data.path;e.post(OC.generateUrl("apps/"+o.Onlyoffice.AppName+"/ajax/reference"),{referenceData:i,path:f,link:t},(function(e){e.error?o.Onlyoffice.showMessage(e.error,"error"):o.Onlyoffice.docEditor.setReferenceData(e)}))},o.Onlyoffice.onRequestOpen=function(e){const n=e.data.path,t=e.data.referenceData.fileKey,i=e.data.windowName,f=OC.generateUrl(`apps/${o.Onlyoffice.AppName}/${t}?filePath=${OC.encodePath(n)}`);window.open(f,i)},o.Onlyoffice.onRequestReferenceSource=function(e){const n=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];o.Onlyoffice.inframe?window.parent.postMessage({method:"editorRequestReferenceSource",param:n},"*"):OC.dialogs.filepicker(t(o.Onlyoffice.AppName,"Select data source"),o.Onlyoffice.editorReferenceSource,!1,n,!0)},o.Onlyoffice.onMetaChange=function(n){void 0!==n.data.favorite&&e.ajax({url:OC.generateUrl("apps/files/api/v1/files"+OC.encodePath(o.Onlyoffice.filePath)),type:"post",data:JSON.stringify({tags:n.data.favorite?[OC.TAG_FAVORITE]:[]}),contentType:"application/json",dataType:"json",success(){o.Onlyoffice.docEditor.setFavorite(n.data.favorite)}})},o.Onlyoffice.showMessage=function(e,n="success",t=null){if(o.Onlyoffice.directEditor&&o.Onlyoffice.directEditor.loaded(),o.Onlyoffice.inframe)window.parent.postMessage({method:"onShowMessage",param:{message:e,type:n,props:t}},"*");else switch(n){case"success":OCP.Toast.success(e,t);break;case"error":OCP.Toast.error(e,t)}},o.Onlyoffice.refreshHistory=function(n,t){let i={};if(n.error)i={error:n.error};else{let o=0;e.each(n,(function(n,t){t.version>=o&&(o=t.version),t.created=moment(1e3*t.created).format("L LTS"),t.changes&&e.each(t.changes,(function(e,o){o.created=moment(o.created+"+00:00").format("L LTS")}))})),t&&(o=Math.min(o,t)),i={currentVersion:o,history:n}}o.Onlyoffice.docEditor.refreshHistory(i)},o.Onlyoffice.resize=function(){if("mobile"!==o.Onlyoffice.device)return;const n=e("#header").length>0?e("#header").height():50,t=e("#escoDiv").length>0?e("#escoDiv").height():38;console.log({headerHeight:n,headerEscoHeight:t});const i=e("#app>iframe");i.length>0&&(i[0].style.height=screen.availHeight-(n+t)+"px",window.scrollTo(0,-1),i[0].style.height=window.top.innerHeight-(n+t)+"px")},o.Onlyoffice.resizeEvents=function(){window.addEventListener&&(/Android/i.test(navigator.userAgent)&&window.addEventListener("resize",o.Onlyoffice.resize),/iPhone|iPad|iPod/i.test(navigator.userAgent)&&window.addEventListener("orientationchange",o.Onlyoffice.resize))},o.Onlyoffice.setViewport=function(){document.querySelector('meta[name="viewport"]').setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")},o.Onlyoffice.InitEditor()}(jQuery,OCA);
//# sourceMappingURL=onlyoffice-editor.js.map?v=a4be999105b387b5ba40